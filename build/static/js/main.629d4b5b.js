/*! For license information please see main.629d4b5b.js.LICENSE.txt */
(()=>{var e={43:(e,t,n)=>{"use strict";e.exports=n(202)},153:(e,t,n)=>{"use strict";var i=n(43),o=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,r={},l=null,u=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!c.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:o,type:e,key:l,ref:u,props:r,_owner:s.current}}t.Fragment=r,t.jsx=l,t.jsxs=l},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var _=b.prototype=new y;_.constructor=b,f(_,v.prototype),_.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,i){var o,r={},a=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,o)&&!T.hasOwnProperty(o)&&(r[o]=t[o]);var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===r[o]&&(r[o]=c[o]);return{$$typeof:n,type:e,key:a,ref:s,props:r,_owner:S.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var x=/\/+/g;function P(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function R(e,t,o,r,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return a=a(c=e),e=""===r?"."+P(c,0):r,k(a)?(o="",null!=e&&(o=e.replace(x,"$&/")+"/"),R(a,t,o,"",function(e){return e})):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,o+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(x,"$&/")+"/")+e)),t.push(a)),1;if(c=0,r=""===r?".":r+":",k(e))for(var l=0;l<e.length;l++){var u=r+P(s=e[l],l);c+=R(s,t,o,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=R(s=s.value,t,o,u=r+P(s,l++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var i=[],o=0;return R(e,i,"","",function(e){return t.call(n,e,o++)}),i}function M(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},L={transition:null},N={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=o,t.Profiler=a,t.PureComponent=b,t.StrictMode=r,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=D,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=f({},e.props),r=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=S.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)w.call(t,l)&&!T.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}return{$$typeof:n,type:e.type,key:r,ref:a,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return O.current.useTransition()},t.version="18.3.1"},228:function(e,t){!function(e){"use strict";var t="1.9.4";function n(e){var t,n,i,o;for(n=1,i=arguments.length;n<i;n++)for(t in o=arguments[n])e[t]=o[t];return e}var i=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function o(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var i=n.call(arguments,2);return function(){return e.apply(t,i.length?i.concat(n.call(arguments)):arguments)}}var r=0;function a(e){return"_leaflet_id"in e||(e._leaflet_id=++r),e._leaflet_id}function s(e,t,n){var i,o,r,a;return a=function(){i=!1,o&&(r.apply(n,o),o=!1)},r=function(){i?o=arguments:(e.apply(n,arguments),setTimeout(a,t),i=!0)},r}function c(e,t,n){var i=t[1],o=t[0],r=i-o;return e===i&&n?e:((e-o)%r+r)%r+o}function l(){return!1}function u(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h(e){return d(e).split(/\s+/)}function p(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?i(e.options):{}),t)e.options[n]=t[n];return e.options}function m(e,t,n){var i=[];for(var o in e)i.push(encodeURIComponent(n?o.toUpperCase():o)+"="+encodeURIComponent(e[o]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}var f=/\{ *([\w_ -]+) *\}/g;function g(e,t){return e.replace(f,function(e,n){var i=t[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"===typeof i&&(i=i(t)),i})}var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function y(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var b="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var k=0;function w(e){var t=+new Date,n=Math.max(0,16-(t-k));return k=t+n,window.setTimeout(e,n)}var S=window.requestAnimationFrame||_("RequestAnimationFrame")||w,T=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function C(e,t,n){if(!n||S!==w)return S.call(window,o(e,t));e.call(t)}function E(e){e&&T.call(window,e)}var x={__proto__:null,extend:n,create:i,bind:o,get lastId(){return r},stamp:a,throttle:s,wrapNum:c,falseFn:l,formatNum:u,trim:d,splitWords:h,setOptions:p,getParamString:m,template:g,isArray:v,indexOf:y,emptyImageUrl:b,requestFn:S,cancelFn:T,requestAnimFrame:C,cancelAnimFrame:E};function P(){}function R(e){if("undefined"!==typeof L&&L&&L.Mixin){e=v(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}P.extend=function(e){var t=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=t.__super__=this.prototype,r=i(o);for(var a in r.constructor=t,t.prototype=r,this)Object.prototype.hasOwnProperty.call(this,a)&&"prototype"!==a&&"__super__"!==a&&(t[a]=this[a]);return e.statics&&n(t,e.statics),e.includes&&(R(e.includes),n.apply(null,[r].concat(e.includes))),n(r,e),delete r.statics,delete r.includes,r.options&&(r.options=o.options?i(o.options):{},n(r.options,e.options)),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=r._initHooks.length;e<t;e++)r._initHooks[e].call(this)}},t},P.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},P.mergeOptions=function(e){return n(this.prototype.options,e),this},P.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var I={on:function(e,t,n){if("object"===typeof e)for(var i in e)this._on(i,e[i],t);else for(var o=0,r=(e=h(e)).length;o<r;o++)this._on(e[o],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var i in e)this._off(i,e[i],t);else{e=h(e);for(var o=1===arguments.length,r=0,a=e.length;r<a;r++)o?this._off(e[r]):this._off(e[r],t,n)}else delete this._events;return this},_on:function(e,t,n,i){if("function"===typeof t){if(!1===this._listens(e,t,n)){n===this&&(n=void 0);var o={fn:t,ctx:n};i&&(o.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(o)}}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var i,o,r;if(this._events&&(i=this._events[e]))if(1!==arguments.length)if("function"===typeof t){var a=this._listens(e,t,n);if(!1!==a){var s=i[a];this._firingCount&&(s.fn=l,this._events[e]=i=i.slice()),i.splice(a,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(o=0,r=i.length;o<r;o++)i[o].fn=l;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var o=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var r=this._events[e];if(r){this._firingCount=this._firingCount+1||1;for(var a=0,s=r.length;a<s;a++){var c=r[a],l=c.fn;c.once&&this.off(e,l,c.ctx),l.call(c.ctx||this,o)}this._firingCount--}}return i&&this._propagateEvent(o),this},listens:function(e,t,n,i){"string"!==typeof e&&console.warn('"string" type argument expected');var o=t;"function"!==typeof t&&(i=!!t,o=void 0,n=void 0);var r=this._events&&this._events[e];if(r&&r.length&&!1!==this._listens(e,o,n))return!0;if(i)for(var a in this._eventParents)if(this._eventParents[a].listens(e,t,n,i))return!0;return!1},_listens:function(e,t,n){if(!this._events)return!1;var i=this._events[e]||[];if(!t)return!!i.length;n===this&&(n=void 0);for(var o=0,r=i.length;o<r;o++)if(i[o].fn===t&&i[o].ctx===n)return o;return!1},once:function(e,t,n){if("object"===typeof e)for(var i in e)this._on(i,e[i],t,!0);else for(var o=0,r=(e=h(e)).length;o<r;o++)this._on(e[o],t,n,!0);return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[a(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[a(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};I.addEventListener=I.on,I.removeEventListener=I.clearAllEventListeners=I.off,I.addOneTimeEventListener=I.once,I.fireEvent=I.fire,I.hasEventListeners=I.listens;var M=P.extend(I);function O(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var N=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function D(e,t,n){return e instanceof O?e:v(e)?new O(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new O(e.x,e.y):new O(e,t,n)}function A(e,t){if(e)for(var n=t?[e,t]:e,i=0,o=n.length;i<o;i++)this.extend(n[i])}function j(e,t){return!e||e instanceof A?e:new A(e,t)}function U(e,t){if(e)for(var n=t?[e,t]:e,i=0,o=n.length;i<o;i++)this.extend(n[i])}function F(e,t){return e instanceof U?e:new U(e,t)}function B(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function z(e,t,n){return e instanceof B?e:v(e)&&"object"!==typeof e[0]?3===e.length?new B(e[0],e[1],e[2]):2===e.length?new B(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new B(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new B(e,t,n)}O.prototype={clone:function(){return new O(this.x,this.y)},add:function(e){return this.clone()._add(D(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(D(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new O(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new O(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=N(this.x),this.y=N(this.y),this},distanceTo:function(e){var t=(e=D(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=D(e)).x===this.x&&e.y===this.y},contains:function(e){return e=D(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},A.prototype={extend:function(e){var t,n;if(!e)return this;if(e instanceof O||"number"===typeof e[0]||"x"in e)t=n=D(e);else if(t=(e=j(e)).min,n=e.max,!t||!n)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=t.clone(),this.max=n.clone()),this},getCenter:function(e){return D((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return D(this.min.x,this.max.y)},getTopRight:function(){return D(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof O?D(e):j(e))instanceof A?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=j(e);var t=this.min,n=this.max,i=e.min,o=e.max,r=o.x>=t.x&&i.x<=n.x,a=o.y>=t.y&&i.y<=n.y;return r&&a},overlaps:function(e){e=j(e);var t=this.min,n=this.max,i=e.min,o=e.max,r=o.x>t.x&&i.x<n.x,a=o.y>t.y&&i.y<n.y;return r&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(e){var t=this.min,n=this.max,i=Math.abs(t.x-n.x)*e,o=Math.abs(t.y-n.y)*e;return j(D(t.x-i,t.y-o),D(n.x+i,n.y+o))},equals:function(e){return!!e&&(e=j(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight()))}},U.prototype={extend:function(e){var t,n,i=this._southWest,o=this._northEast;if(e instanceof B)t=e,n=e;else{if(!(e instanceof U))return e?this.extend(z(e)||F(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return i||o?(i.lat=Math.min(t.lat,i.lat),i.lng=Math.min(t.lng,i.lng),o.lat=Math.max(n.lat,o.lat),o.lng=Math.max(n.lng,o.lng)):(this._southWest=new B(t.lat,t.lng),this._northEast=new B(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,i=Math.abs(t.lat-n.lat)*e,o=Math.abs(t.lng-n.lng)*e;return new U(new B(t.lat-i,t.lng-o),new B(n.lat+i,n.lng+o))},getCenter:function(){return new B((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new B(this.getNorth(),this.getWest())},getSouthEast:function(){return new B(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof B||"lat"in e?z(e):F(e);var t,n,i=this._southWest,o=this._northEast;return e instanceof U?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=i.lat&&n.lat<=o.lat&&t.lng>=i.lng&&n.lng<=o.lng},intersects:function(e){e=F(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),o=e.getNorthEast(),r=o.lat>=t.lat&&i.lat<=n.lat,a=o.lng>=t.lng&&i.lng<=n.lng;return r&&a},overlaps:function(e){e=F(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),o=e.getNorthEast(),r=o.lat>t.lat&&i.lat<n.lat,a=o.lng>t.lng&&i.lng<n.lng;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=F(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},B.prototype={equals:function(e,t){return!!e&&(e=z(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+u(this.lat,e)+", "+u(this.lng,e)+")"},distanceTo:function(e){return q.distance(this,z(e))},wrap:function(){return q.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return F([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new B(this.lat,this.lng,this.alt)}};var V={latLngToPoint:function(e,t){var n=this.projection.project(e),i=this.scale(t);return this.transformation._transform(n,i)},pointToLatLng:function(e,t){var n=this.scale(t),i=this.transformation.untransform(e,n);return this.projection.unproject(i)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new A(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?c(e.lng,this.wrapLng,!0):e.lng;return new B(this.wrapLat?c(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),i=t.lat-n.lat,o=t.lng-n.lng;if(0===i&&0===o)return e;var r=e.getSouthWest(),a=e.getNorthEast();return new U(new B(r.lat-i,r.lng-o),new B(a.lat-i,a.lng-o))}},q=n({},V,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,i=e.lat*n,o=t.lat*n,r=Math.sin((t.lat-e.lat)*n/2),a=Math.sin((t.lng-e.lng)*n/2),s=r*r+Math.cos(i)*Math.cos(o)*a*a,c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*c}}),W=6378137,H={R:W,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,e.lat),-n),o=Math.sin(i*t);return new O(this.R*e.lng*t,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(e){var t=180/Math.PI;return new B((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=W*Math.PI;return new A([-e,-e],[e,e])}()};function Z(e,t,n,i){if(v(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=i}function G(e,t,n,i){return new Z(e,t,n,i)}Z.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new O((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var K=n({},q,{code:"EPSG:3857",projection:H,transformation:function(){var e=.5/(Math.PI*H.R);return G(e,.5,-e,.5)}()}),J=n({},K,{code:"EPSG:900913"});function Q(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){var n,i,o,r,a,s,c="";for(n=0,o=e.length;n<o;n++){for(i=0,r=(a=e[n]).length;i<r;i++)c+=(i?"L":"M")+(s=a[i]).x+" "+s.y;c+=t?Ae.svg?"z":"x":""}return c||"M0 0"}var $=document.documentElement.style,X="ActiveXObject"in window,ee=X&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=De("webkit"),ie=De("android"),oe=De("android 2")||De("android 3"),re=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ae=ie&&De("Google")&&re<537&&!("AudioNode"in window),se=!!window.opera,ce=!te&&De("chrome"),le=De("gecko")&&!ne&&!se&&!X,ue=!ce&&De("safari"),de=De("phantom"),he="OTransition"in $,pe=0===navigator.platform.indexOf("Win"),me=X&&"transition"in $,fe="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!oe,ge="MozPerspective"in $,ve=!window.L_DISABLE_3D&&(me||fe||ge)&&!he&&!de,ye="undefined"!==typeof orientation||De("mobile"),be=ye&&ne,_e=ye&&fe,ke=!window.PointerEvent&&window.MSPointerEvent,we=!(!window.PointerEvent&&!ke),Se="ontouchstart"in window||!!window.TouchEvent,Te=!window.L_NO_TOUCH&&(Se||we),Ce=ye&&se,Ee=ye&&le,xe=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Pe=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",l,t),window.removeEventListener("testPassiveEventSupport",l,t)}catch(n){}return e}(),Re=!!document.createElement("canvas").getContext,Ie=!(!document.createElementNS||!Q("svg").createSVGRect),Me=!!Ie&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Oe=!Ie&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}(),Le=0===navigator.platform.indexOf("Mac"),Ne=0===navigator.platform.indexOf("Linux");function De(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Ae={ie:X,ielt9:ee,edge:te,webkit:ne,android:ie,android23:oe,androidStock:ae,opera:se,chrome:ce,gecko:le,safari:ue,phantom:de,opera12:he,win:pe,ie3d:me,webkit3d:fe,gecko3d:ge,any3d:ve,mobile:ye,mobileWebkit:be,mobileWebkit3d:_e,msPointer:ke,pointer:we,touch:Te,touchNative:Se,mobileOpera:Ce,mobileGecko:Ee,retina:xe,passiveEvents:Pe,canvas:Re,svg:Ie,vml:Oe,inlineSvg:Me,mac:Le,linux:Ne},je=Ae.msPointer?"MSPointerDown":"pointerdown",Ue=Ae.msPointer?"MSPointerMove":"pointermove",Fe=Ae.msPointer?"MSPointerUp":"pointerup",Be=Ae.msPointer?"MSPointerCancel":"pointercancel",ze={touchstart:je,touchmove:Ue,touchend:Fe,touchcancel:Be},Ve={touchstart:$e,touchmove:Ye,touchend:Ye,touchcancel:Ye},qe={},We=!1;function He(e,t,n){return"touchstart"===t&&Qe(),Ve[t]?(n=Ve[t].bind(this,n),e.addEventListener(ze[t],n,!1),n):(console.warn("wrong event specified:",t),l)}function Ze(e,t,n){ze[t]?e.removeEventListener(ze[t],n,!1):console.warn("wrong event specified:",t)}function Ge(e){qe[e.pointerId]=e}function Ke(e){qe[e.pointerId]&&(qe[e.pointerId]=e)}function Je(e){delete qe[e.pointerId]}function Qe(){We||(document.addEventListener(je,Ge,!0),document.addEventListener(Ue,Ke,!0),document.addEventListener(Fe,Je,!0),document.addEventListener(Be,Je,!0),We=!0)}function Ye(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],qe)t.touches.push(qe[n]);t.changedTouches=[t],e(t)}}function $e(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Gt(t),Ye(e,t)}function Xe(e){var t,n,i={};for(n in e)t=e[n],i[n]=t&&t.bind?t.bind(e):t;return e=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var et=200;function tt(e,t){e.addEventListener("dblclick",t);var n,i=0;function o(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var o=Jt(e);if(!o.some(function(e){return e instanceof HTMLLabelElement&&e.attributes.for})||o.some(function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement})){var r=Date.now();r-i<=et?2===++n&&t(Xe(e)):n=1,i=r}}}else n=e.detail}return e.addEventListener("click",o),{dblclick:t,simDblclick:o}}function nt(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var it,ot,rt,at,st,ct=Ct(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),lt=Ct(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===lt||"OTransition"===lt?lt+"End":"transitionend";function dt(e){return"string"===typeof e?document.getElementById(e):e}function ht(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"auto"===n?null:n}function pt(e,t,n){var i=document.createElement(e);return i.className=t||"",n&&n.appendChild(i),i}function mt(e){var t=e.parentNode;t&&t.removeChild(e)}function ft(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function gt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function vt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function yt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=wt(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function bt(e,t){if(void 0!==e.classList)for(var n=h(t),i=0,o=n.length;i<o;i++)e.classList.add(n[i]);else if(!yt(e,t)){var r=wt(e);kt(e,(r?r+" ":"")+t)}}function _t(e,t){void 0!==e.classList?e.classList.remove(t):kt(e,d((" "+wt(e)+" ").replace(" "+t+" "," ")))}function kt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function wt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function St(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&Tt(e,t)}function Tt(e,t){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(i)}catch(o){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+i+"(opacity="+t+")"}function Ct(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function Et(e,t,n){var i=t||new O(0,0);e.style[ct]=(Ae.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function xt(e,t){e._leaflet_pos=t,Ae.any3d?Et(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Pt(e){return e._leaflet_pos||new O(0,0)}if("onselectstart"in document)it=function(){jt(window,"selectstart",Gt)},ot=function(){Ft(window,"selectstart",Gt)};else{var Rt=Ct(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);it=function(){if(Rt){var e=document.documentElement.style;rt=e[Rt],e[Rt]="none"}},ot=function(){Rt&&(document.documentElement.style[Rt]=rt,rt=void 0)}}function It(){jt(window,"dragstart",Gt)}function Mt(){Ft(window,"dragstart",Gt)}function Ot(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Lt(),at=e,st=e.style.outlineStyle,e.style.outlineStyle="none",jt(window,"keydown",Lt))}function Lt(){at&&(at.style.outlineStyle=st,at=void 0,st=void 0,Ft(window,"keydown",Lt))}function Nt(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Dt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var At={__proto__:null,TRANSFORM:ct,TRANSITION:lt,TRANSITION_END:ut,get:dt,getStyle:ht,create:pt,remove:mt,empty:ft,toFront:gt,toBack:vt,hasClass:yt,addClass:bt,removeClass:_t,setClass:kt,getClass:wt,setOpacity:St,testProp:Ct,setTransform:Et,setPosition:xt,getPosition:Pt,get disableTextSelection(){return it},get enableTextSelection(){return ot},disableImageDrag:It,enableImageDrag:Mt,preventOutline:Ot,restoreOutline:Lt,getSizedParentNode:Nt,getScale:Dt};function jt(e,t,n,i){if(t&&"object"===typeof t)for(var o in t)Vt(e,o,t[o],n);else for(var r=0,a=(t=h(t)).length;r<a;r++)Vt(e,t[r],n,i);return this}var Ut="_leaflet_events";function Ft(e,t,n,i){if(1===arguments.length)Bt(e),delete e[Ut];else if(t&&"object"===typeof t)for(var o in t)qt(e,o,t[o],n);else if(t=h(t),2===arguments.length)Bt(e,function(e){return-1!==y(t,e)});else for(var r=0,a=t.length;r<a;r++)qt(e,t[r],n,i);return this}function Bt(e,t){for(var n in e[Ut]){var i=n.split(/\d/)[0];t&&!t(i)||qt(e,i,null,null,n)}}var zt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Vt(e,t,n,i){var o=t+a(n)+(i?"_"+a(i):"");if(e[Ut]&&e[Ut][o])return this;var r=function(t){return n.call(i||e,t||window.event)},s=r;!Ae.touchNative&&Ae.pointer&&0===t.indexOf("touch")?r=He(e,t,r):Ae.touch&&"dblclick"===t?r=tt(e,r):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(zt[t]||t,r,!!Ae.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(r=function(t){t=t||window.event,Xt(e,t)&&s(t)},e.addEventListener(zt[t],r,!1)):e.addEventListener(t,s,!1):e.attachEvent("on"+t,r),e[Ut]=e[Ut]||{},e[Ut][o]=r}function qt(e,t,n,i,o){o=o||t+a(n)+(i?"_"+a(i):"");var r=e[Ut]&&e[Ut][o];if(!r)return this;!Ae.touchNative&&Ae.pointer&&0===t.indexOf("touch")?Ze(e,t,r):Ae.touch&&"dblclick"===t?nt(e,r):"removeEventListener"in e?e.removeEventListener(zt[t]||t,r,!1):e.detachEvent("on"+t,r),e[Ut][o]=null}function Wt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Ht(e){return Vt(e,"wheel",Wt),this}function Zt(e){return jt(e,"mousedown touchstart dblclick contextmenu",Wt),e._leaflet_disable_click=!0,this}function Gt(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Kt(e){return Gt(e),Wt(e),this}function Jt(e){if(e.composedPath)return e.composedPath();for(var t=[],n=e.target;n;)t.push(n),n=n.parentNode;return t}function Qt(e,t){if(!t)return new O(e.clientX,e.clientY);var n=Dt(t),i=n.boundingClientRect;return new O((e.clientX-i.left)/n.x-t.clientLeft,(e.clientY-i.top)/n.y-t.clientTop)}var Yt=Ae.linux&&Ae.chrome?window.devicePixelRatio:Ae.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function $t(e){return Ae.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Yt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function Xt(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(i){return!1}return n!==e}var en={__proto__:null,on:jt,off:Ft,stopPropagation:Wt,disableScrollPropagation:Ht,disableClickPropagation:Zt,preventDefault:Gt,stop:Kt,getPropagationPath:Jt,getMousePosition:Qt,getWheelDelta:$t,isExternalTarget:Xt,addListener:jt,removeListener:Ft},tn=M.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=Pt(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=C(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),xt(this._el,n),this.fire("step")},_complete:function(){E(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),nn=M.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(z(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=lt&&Ae.any3d&&!Ae.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),jt(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,i){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(z(e),t,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=n({animate:i.animate},i.zoom),i.pan=n({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,i.pan&&i.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Ae.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Ae.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var i=this.getZoomScale(t),o=this.getSize().divideBy(2),r=(e instanceof O?e:this.latLngToContainerPoint(e)).subtract(o).multiplyBy(1-1/i),a=this.containerPointToLatLng(o.add(r));return this.setView(a,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():F(e);var n=D(t.paddingTopLeft||t.padding||[0,0]),i=D(t.paddingBottomRight||t.padding||[0,0]),o=this.getBoundsZoom(e,!1,n.add(i));if((o="number"===typeof t.maxZoom?Math.min(t.maxZoom,o):o)===1/0)return{center:e.getCenter(),zoom:o};var r=i.subtract(n).divideBy(2),a=this.project(e.getSouthWest(),o),s=this.project(e.getNorthEast(),o);return{center:this.unproject(a.add(s).divideBy(2).add(r),o),zoom:o}},fitBounds:function(e,t){if(!(e=F(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=D(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new tn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){bt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!Ae.any3d)return this.setView(e,t,n);this._stop();var i=this.project(this.getCenter()),o=this.project(e),r=this.getSize(),a=this._zoom;e=z(e),t=void 0===t?a:t;var s=Math.max(r.x,r.y),c=s*this.getZoomScale(a,t),l=o.distanceTo(i)||1,u=1.42,d=u*u;function h(e){var t=(c*c-s*s+(e?-1:1)*d*d*l*l)/(2*(e?c:s)*d*l),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function p(e){return(Math.exp(e)-Math.exp(-e))/2}function m(e){return(Math.exp(e)+Math.exp(-e))/2}function f(e){return p(e)/m(e)}var g=h(0);function v(e){return s*(m(g)/m(g+u*e))}function y(e){return s*(m(g)*f(g+u*e)-p(g))/d}function b(e){return 1-Math.pow(1-e,1.5)}var _=Date.now(),k=(h(1)-g)/u,w=n.duration?1e3*n.duration:1e3*k*.8;function S(){var n=(Date.now()-_)/w,r=b(n)*k;n<=1?(this._flyToFrame=C(S,this),this._move(this.unproject(i.add(o.subtract(i).multiplyBy(y(r)/l)),a),this.getScaleZoom(s/v(r),a),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),S.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return e=F(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,F(e));return n.equals(i)||this.panTo(i,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=D((t=t||{}).paddingTopLeft||t.padding||[0,0]),i=D(t.paddingBottomRight||t.padding||[0,0]),o=this.project(this.getCenter()),r=this.project(e),a=this.getPixelBounds(),s=j([a.min.add(n),a.max.subtract(i)]),c=s.getSize();if(!s.contains(r)){this._enforcingBounds=!0;var l=r.subtract(s.getCenter()),u=s.extend(r).getSize().subtract(c);o.x+=l.x<0?-u.x:u.x,o.y+=l.y<0?-u.y:u.y,this.panTo(this.unproject(o),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),r=t.divideBy(2).round(),a=i.divideBy(2).round(),s=r.subtract(a);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=o(this._handleGeolocationResponse,this),i=o(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,i,e):navigator.geolocation.getCurrentPosition(t,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new B(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),i=this._locateOptions;if(i.setView){var o=this.getBoundsZoom(n);this.setView(t,i.maxZoom?Math.min(o,i.maxZoom):o)}var r={latlng:t,bounds:n,timestamp:e.timestamp};for(var a in e.coords)"number"===typeof e.coords[a]&&(r[a]=e.coords[a]);this.fire("locationfound",r)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),mt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(E(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)mt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=pt("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new U(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=F(e),n=D(n||[0,0]);var i=this.getZoom()||0,o=this.getMinZoom(),r=this.getMaxZoom(),a=e.getNorthWest(),s=e.getSouthEast(),c=this.getSize().subtract(n),l=j(this.project(s,i),this.project(a,i)).getSize(),u=Ae.any3d?this.options.zoomSnap:1,d=c.x/l.x,h=c.y/l.y,p=t?Math.max(d,h):Math.min(d,h);return i=this.getScaleZoom(p,i),u&&(i=Math.round(i/(u/100))*(u/100),i=t?Math.ceil(i/u)*u:Math.floor(i/u)*u),Math.max(o,Math.min(r,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new A(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var i=n.zoom(e*n.scale(t));return isNaN(i)?1/0:i},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(z(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(D(e),t)},layerPointToLatLng:function(e){var t=D(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(z(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(z(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(F(e))},distance:function(e,t){return this.options.crs.distance(z(e),z(t))},containerPointToLayerPoint:function(e){return D(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return D(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(D(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(z(e)))},mouseEventToContainerPoint:function(e){return Qt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=dt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");jt(t,"scroll",this._onScroll,this),this._containerId=a(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ae.any3d,bt(e,"leaflet-container"+(Ae.touch?" leaflet-touch":"")+(Ae.retina?" leaflet-retina":"")+(Ae.ielt9?" leaflet-oldie":"")+(Ae.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ht(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),xt(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(bt(e.markerPane,"leaflet-zoom-hide"),bt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,n){xt(this._mapPane,new O(0,0));var i=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var o=this._zoom!==t;this._moveStart(o,n)._move(e,t)._moveEnd(o),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,i){void 0===t&&(t=this._zoom);var o=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),i?n&&n.pinch&&this.fire("zoom",n):((o||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return E(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){xt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[a(this._container)]=this;var t=e?Ft:jt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Ae.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){E(this._resizeRequest),this._resizeRequest=C(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,i=[],o="mouseout"===t||"mouseover"===t,r=e.target||e.srcElement,s=!1;r;){if((n=this._targets[a(r)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(o&&!Xt(r,e))break;if(i.push(n),o)break}if(r===this._container)break;r=r.parentNode}return i.length||s||o||!this.listens(t,!0)||(i=[this]),i},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&Ot(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,i){if("click"===e.type){var o=n({},e);o.type="preclick",this._fireDOMEvent(o,o.type,i)}var r=this._findEventTargets(e,t);if(i){for(var a=[],s=0;s<i.length;s++)i[s].listens(t,!0)&&a.push(i[s]);r=a.concat(r)}if(r.length){"contextmenu"===t&&Gt(e);var c=r[0],l={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var u=c.getLatLng&&(!c._radius||c._radius<=10);l.containerPoint=u?this.latLngToContainerPoint(c.getLatLng()):this.mouseEventToContainerPoint(e),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=u?c.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(s=0;s<r.length;s++)if(r[s].fire(t,l,!0),l.originalEvent._stopped||!1===r[s].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Pt(this._mapPane)||new O(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(i)},_latLngBoundsToNewLayerBounds:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return j([this.project(e.getSouthWest(),t)._subtract(i),this.project(e.getNorthWest(),t)._subtract(i),this.project(e.getSouthEast(),t)._subtract(i),this.project(e.getNorthEast(),t)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var i=this.project(e,t),o=this.getSize().divideBy(2),r=new A(i.subtract(o),i.add(o)),a=this._getBoundsOffset(r,n,t);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?e:this.unproject(i.add(a),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),i=new A(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,n){var i=j(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),o=i.min.subtract(e.min),r=i.max.subtract(e.max);return new O(this._rebound(o.x,-r.x),this._rebound(o.y,-r.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),i=Ae.any3d?this.options.zoomSnap:1;return i&&(e=Math.round(e/i)*i),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_t(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=pt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(e){var t=ct,n=this._proxy.style[t];Et(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){mt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Et(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(t),o=this._getCenterOffset(e)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(o))&&(C(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n,i){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,bt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_t(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function on(e,t){return new nn(e,t)}var rn=P.extend({options:{position:"topright"},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),i=e._controlCorners[n];return bt(t,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(t,i.firstChild):i.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(mt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),an=function(e){return new rn(e)};nn.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=pt("div",t+"control-container",this._container);function i(i,o){var r=t+i+" "+t+o;e[i+o]=pt("div",r,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)mt(this._controlCorners[e]);mt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var sn=rn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,i){return n<i?-1:i<n?1:0}},initialize:function(e,t,n){for(var i in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return rn.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(a(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){bt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(bt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):_t(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _t(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=pt("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Zt(t),Ht(t);var i=this._section=pt("section",e+"-list");n&&(this._map.on("click",this.collapse,this),jt(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var o=this._layersLink=pt("a",e+"-toggle",t);o.href="#",o.title="Layers",o.setAttribute("role","button"),jt(o,{keydown:function(e){13===e.keyCode&&this._expandSafely()},click:function(e){Gt(e),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=pt("div",e+"-base",i),this._separator=pt("div",e+"-separator",i),this._overlaysList=pt("div",e+"-overlays",i),t.appendChild(i)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&a(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(o(function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ft(this._baseLayersList),ft(this._overlaysList),this._layerControlInputs=[];var e,t,n,i,o=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),t=t||i.overlay,e=e||!i.overlay,o+=i.overlay?0:1;return this.options.hideSingleBase&&(e=e&&o>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(a(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(e){var t,n=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=i):t=this._createRadioElement("leaflet-base-layers_"+a(this),i),this._layerControlInputs.push(t),t.layerId=a(e.layer),jt(t,"click",this._onInputClick,this);var o=document.createElement("span");o.innerHTML=" "+e.name;var r=document.createElement("span");return n.appendChild(r),r.appendChild(t),r.appendChild(o),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var e,t,n=this._layerControlInputs,i=[],o=[];this._handlingClick=!0;for(var r=n.length-1;r>=0;r--)e=n[r],t=this._getLayer(e.layerId).layer,e.checked?i.push(t):e.checked||o.push(t);for(r=0;r<o.length;r++)this._map.hasLayer(o[r])&&this._map.removeLayer(o[r]);for(r=0;r<i.length;r++)this._map.hasLayer(i[r])||this._map.addLayer(i[r]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,i=this._map.getZoom(),o=n.length-1;o>=0;o--)e=n[o],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&i<t.options.minZoom||void 0!==t.options.maxZoom&&i>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,jt(e,"click",Gt),this.expand();var t=this;setTimeout(function(){Ft(e,"click",Gt),t._preventClick=!1})}}),cn=function(e,t,n){return new sn(e,t,n)},ln=rn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=pt("div",t+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,i,o){var r=pt("a",n,i);return r.innerHTML=e,r.href="#",r.title=t,r.setAttribute("role","button"),r.setAttribute("aria-label",t),Zt(r),jt(r,"click",Kt),jt(r,"click",o,this),jt(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";_t(this._zoomInButton,t),_t(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(bt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(bt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});nn.mergeOptions({zoomControl:!0}),nn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ln,this.addControl(this.zoomControl))});var un=function(e){return new ln(e)},dn=rn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=pt("div",t),i=this.options;return this._addScales(i,t+"-line",n),e.on(i.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=pt("div",t,n)),e.imperial&&(this._iScale=pt("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,i,o=3.2808399*e;o>5280?(t=o/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(i=this._getRoundNum(o),this._updateScale(this._iScale,i+" ft",i/o))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),hn=function(e){return new dn(e)},pn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',mn=rn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ae.inlineSvg?pn+" ":"")+"Leaflet</a>"},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=pt("div","leaflet-control-attribution"),Zt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});nn.mergeOptions({attributionControl:!0}),nn.addInitHook(function(){this.options.attributionControl&&(new mn).addTo(this)});var fn=function(e){return new mn(e)};rn.Layers=sn,rn.Zoom=ln,rn.Scale=dn,rn.Attribution=mn,an.layers=cn,an.zoom=un,an.scale=hn,an.attribution=fn;var gn=P.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gn.addTo=function(e,t){return e.addHandler(t,this),this};var vn={Events:I},yn=Ae.touch?"touchstart mousedown":"mousedown",bn=M.extend({options:{clickTolerance:3},initialize:function(e,t,n,i){p(this,i),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(jt(this._dragStartTarget,yn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(bn._dragging===this&&this.finishDrag(!0),Ft(this._dragStartTarget,yn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!yt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)bn._dragging===this&&this.finishDrag();else if(!(bn._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(bn._dragging=this,this._preventOutline&&Ot(this._element),It(),it(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=Nt(this._element);this._startPoint=new O(t.clientX,t.clientY),this._startPos=Pt(this._element),this._parentScale=Dt(n);var i="mousedown"===e.type;jt(document,i?"mousemove":"touchmove",this._onMove,this),jt(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new O(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Gt(e),this._moved||(this.fire("dragstart"),this._moved=!0,bt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),bt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),xt(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){_t(document.body,"leaflet-dragging"),this._lastTarget&&(_t(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ft(document,"mousemove touchmove",this._onMove,this),Ft(document,"mouseup touchend touchcancel",this._onUp,this),Mt(),ot();var t=this._moved&&this._moving;this._moving=!1,bn._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function _n(e,t,n){var i,o,r,a,s,c,l,u,d,h=[1,4,2,8];for(o=0,l=e.length;o<l;o++)e[o]._code=Ln(e[o],t);for(a=0;a<4;a++){for(u=h[a],i=[],o=0,r=(l=e.length)-1;o<l;r=o++)s=e[o],c=e[r],s._code&u?c._code&u||((d=On(c,s,u,t,n))._code=Ln(d,t),i.push(d)):(c._code&u&&((d=On(c,s,u,t,n))._code=Ln(d,t),i.push(d)),i.push(s));e=i}return e}function kn(e,t){var n,i,o,r,a,s,c,l,u;if(!e||0===e.length)throw new Error("latlngs not passed");An(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var d=z([0,0]),h=F(e);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(d=wn(e));var p=e.length,m=[];for(n=0;n<p;n++){var f=z(e[n]);m.push(t.project(z([f.lat-d.lat,f.lng-d.lng])))}for(s=c=l=0,n=0,i=p-1;n<p;i=n++)o=m[n],r=m[i],a=o.y*r.x-r.y*o.x,c+=(o.x+r.x)*a,l+=(o.y+r.y)*a,s+=3*a;u=0===s?m[0]:[c/s,l/s];var g=t.unproject(D(u));return z([g.lat+d.lat,g.lng+d.lng])}function wn(e){for(var t=0,n=0,i=0,o=0;o<e.length;o++){var r=z(e[o]);t+=r.lat,n+=r.lng,i++}return z([t/i,n/i])}var Sn,Tn={__proto__:null,clipPolygon:_n,polygonCenter:kn,centroid:wn};function Cn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=Pn(e=In(e,n),n)}function En(e,t,n){return Math.sqrt(Dn(e,t,n,!0))}function xn(e,t,n){return Dn(e,t,n)}function Pn(e,t){var n=e.length,i=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,Rn(e,i,t,0,n-1);var o,r=[];for(o=0;o<n;o++)i[o]&&r.push(e[o]);return r}function Rn(e,t,n,i,o){var r,a,s,c=0;for(a=i+1;a<=o-1;a++)(s=Dn(e[a],e[i],e[o],!0))>c&&(r=a,c=s);c>n&&(t[r]=1,Rn(e,t,n,i,r),Rn(e,t,n,r,o))}function In(e,t){for(var n=[e[0]],i=1,o=0,r=e.length;i<r;i++)Nn(e[i],e[o])>t&&(n.push(e[i]),o=i);return o<r-1&&n.push(e[r-1]),n}function Mn(e,t,n,i,o){var r,a,s,c=i?Sn:Ln(e,n),l=Ln(t,n);for(Sn=l;;){if(!(c|l))return[e,t];if(c&l)return!1;s=Ln(a=On(e,t,r=c||l,n,o),n),r===c?(e=a,c=s):(t=a,l=s)}}function On(e,t,n,i,o){var r,a,s=t.x-e.x,c=t.y-e.y,l=i.min,u=i.max;return 8&n?(r=e.x+s*(u.y-e.y)/c,a=u.y):4&n?(r=e.x+s*(l.y-e.y)/c,a=l.y):2&n?(r=u.x,a=e.y+c*(u.x-e.x)/s):1&n&&(r=l.x,a=e.y+c*(l.x-e.x)/s),new O(r,a,o)}function Ln(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function Nn(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}function Dn(e,t,n,i){var o,r=t.x,a=t.y,s=n.x-r,c=n.y-a,l=s*s+c*c;return l>0&&((o=((e.x-r)*s+(e.y-a)*c)/l)>1?(r=n.x,a=n.y):o>0&&(r+=s*o,a+=c*o)),s=e.x-r,c=e.y-a,i?s*s+c*c:new O(r,a)}function An(e){return!v(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function jn(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),An(e)}function Un(e,t){var n,i,o,r,a,s,c,l;if(!e||0===e.length)throw new Error("latlngs not passed");An(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var u=z([0,0]),d=F(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=wn(e));var h=e.length,p=[];for(n=0;n<h;n++){var m=z(e[n]);p.push(t.project(z([m.lat-u.lat,m.lng-u.lng])))}for(n=0,i=0;n<h-1;n++)i+=p[n].distanceTo(p[n+1])/2;if(0===i)l=p[0];else for(n=0,r=0;n<h-1;n++)if(a=p[n],s=p[n+1],(r+=o=a.distanceTo(s))>i){c=(r-i)/o,l=[s.x-c*(s.x-a.x),s.y-c*(s.y-a.y)];break}var f=t.unproject(D(l));return z([f.lat+u.lat,f.lng+u.lng])}var Fn={__proto__:null,simplify:Cn,pointToSegmentDistance:En,closestPointOnSegment:xn,clipSegment:Mn,_getEdgeIntersection:On,_getBitCode:Ln,_sqClosestPointOnSegment:Dn,isFlat:An,_flat:jn,polylineCenter:Un},Bn={project:function(e){return new O(e.lng,e.lat)},unproject:function(e){return new B(e.y,e.x)},bounds:new A([-180,-90],[180,90])},zn={R:6378137,R_MINOR:6356752.314245179,bounds:new A([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,i=e.lat*t,o=this.R_MINOR/n,r=Math.sqrt(1-o*o),a=r*Math.sin(i),s=Math.tan(Math.PI/4-i/2)/Math.pow((1-a)/(1+a),r/2);return i=-n*Math.log(Math.max(s,1e-10)),new O(e.lng*t*n,i)},unproject:function(e){for(var t,n=180/Math.PI,i=this.R,o=this.R_MINOR/i,r=Math.sqrt(1-o*o),a=Math.exp(-e.y/i),s=Math.PI/2-2*Math.atan(a),c=0,l=.1;c<15&&Math.abs(l)>1e-7;c++)t=r*Math.sin(s),t=Math.pow((1-t)/(1+t),r/2),s+=l=Math.PI/2-2*Math.atan(a*t)-s;return new B(s*n,e.x*n/i)}},Vn={__proto__:null,LonLat:Bn,Mercator:zn,SphericalMercator:H},qn=n({},q,{code:"EPSG:3395",projection:zn,transformation:function(){var e=.5/(Math.PI*zn.R);return G(e,.5,-e,.5)}()}),Wn=n({},q,{code:"EPSG:4326",projection:Bn,transformation:G(1/180,1,-1/180,.5)}),Hn=n({},V,{projection:Bn,transformation:G(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,i=t.lat-e.lat;return Math.sqrt(n*n+i*i)},infinite:!0});V.Earth=q,V.EPSG3395=qn,V.EPSG3857=K,V.EPSG900913=J,V.EPSG4326=Wn,V.Simple=Hn;var Zn=M.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[a(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[a(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",function(){t.off(n,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});nn.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=a(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=a(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return a(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?v(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[a(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=a(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var o=this._zoomBoundLayers[i].options;e=void 0===o.minZoom?e:Math.min(e,o.minZoom),t=void 0===o.maxZoom?t:Math.max(t,o.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Gn=Zn.extend({initialize:function(e,t){var n,i;if(p(this,t),this._layers={},e)for(n=0,i=e.length;n<i;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,i=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,i);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return a(e)}}),Kn=function(e,t){return new Gn(e,t)},Jn=Gn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Gn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Gn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new U;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Qn=function(e,t){return new Jn(e,t)},Yn=P.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(i,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(e,t){var n=this.options,i=n[t+"Size"];"number"===typeof i&&(i=[i,i]);var o=D(i),r=D("shadow"===t&&n.shadowAnchor||n.iconAnchor||o&&o.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),r&&(e.style.marginLeft=-r.x+"px",e.style.marginTop=-r.y+"px"),o&&(e.style.width=o.x+"px",e.style.height=o.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Ae.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function $n(e){return new Yn(e)}var Xn=Yn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof Xn.imagePath&&(Xn.imagePath=this._detectIconPath()),(this.options.imagePath||Xn.imagePath)+Yn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var i=t.exec(e);return i&&i[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=pt("div","leaflet-default-icon-path",document.body),t=ht(e,"background-image")||ht(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),ei=gn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new bn(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),bt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_t(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,i=this._marker.options.autoPanSpeed,o=this._marker.options.autoPanPadding,r=Pt(t._icon),a=n.getPixelBounds(),s=n.getPixelOrigin(),c=j(a.min._subtract(s).add(o),a.max._subtract(s).subtract(o));if(!c.contains(r)){var l=D((Math.max(c.max.x,r.x)-c.max.x)/(a.max.x-c.max.x)-(Math.min(c.min.x,r.x)-c.min.x)/(a.min.x-c.min.x),(Math.max(c.max.y,r.y)-c.max.y)/(a.max.y-c.max.y)-(Math.min(c.min.y,r.y)-c.min.y)/(a.min.y-c.min.y)).multiplyBy(i);n.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),xt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=C(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(E(this._panRequest),this._panRequest=C(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,i=Pt(t._icon),o=t._map.layerPointToLatLng(i);n&&xt(n,i),t._latlng=o,e.latlng=o,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){E(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),ti=Zn.extend({options:{icon:new Xn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=z(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=z(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),bt(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&jt(n,"focus",this._panOnFocus,this);var o=e.icon.createShadow(this._shadow),r=!1;o!==this._shadow&&(this._removeShadow(),r=!0),o&&(bt(o,t),o.alt=""),this._shadow=o,e.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&r&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ft(this._icon,"focus",this._panOnFocus,this),mt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&mt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&xt(this._icon,e),this._shadow&&xt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(bt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ei)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ei(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&St(this._icon,e),this._shadow&&St(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?D(t.iconSize):D(0,0),i=t.iconAnchor?D(t.iconAnchor):D(0,0);e.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ni(e,t){return new ti(e,t)}var ii=Zn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),oi=ii.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=z(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=z(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return ii.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),i=[e+n,t+n];this._pxBounds=new A(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ri(e,t){return new oi(e,t)}var ai=oi.extend({initialize:function(e,t,i){if("number"===typeof t&&(t=n({},i,{radius:t})),p(this,t),this._latlng=z(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new U(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:ii.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===q.distance){var o=Math.PI/180,r=this._mRadius/q.R/o,a=n.project([t+r,e]),s=n.project([t-r,e]),c=a.add(s).divideBy(2),l=n.unproject(c).lat,u=Math.acos((Math.cos(r*o)-Math.sin(t*o)*Math.sin(l*o))/(Math.cos(t*o)*Math.cos(l*o)))/o;(isNaN(u)||0===u)&&(u=r/Math.cos(Math.PI/180*t)),this._point=c.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:c.x-n.project([l,e-u]).x,this._radiusY=c.y-a.y}else{var d=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}});function si(e,t,n){return new ai(e,t,n)}var ci=ii.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,i=1/0,o=null,r=Dn,a=0,s=this._parts.length;a<s;a++)for(var c=this._parts[a],l=1,u=c.length;l<u;l++){var d=r(e,t=c[l-1],n=c[l],!0);d<i&&(i=d,o=r(e,t,n))}return o&&(o.distance=Math.sqrt(i)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Un(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=z(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new U,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return An(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=An(e),i=0,o=e.length;i<o;i++)n?(t[i]=z(e[i]),this._bounds.extend(t[i])):t[i]=this._convertLatLngs(e[i]);return t},_project:function(){var e=new A;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new O(e,e);this._rawPxBounds&&(this._pxBounds=new A([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var i,o,r=e[0]instanceof B,a=e.length;if(r){for(o=[],i=0;i<a;i++)o[i]=this._map.latLngToLayerPoint(e[i]),n.extend(o[i]);t.push(o)}else for(i=0;i<a;i++)this._projectLatlngs(e[i],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,i,o,r,a,s,c=this._parts;for(t=0,i=0,o=this._rings.length;t<o;t++)for(n=0,r=(s=this._rings[t]).length;n<r-1;n++)(a=Mn(s[n],s[n+1],e,n,!0))&&(c[i]=c[i]||[],c[i].push(a[0]),a[1]===s[n+1]&&n!==r-2||(c[i].push(a[1]),i++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,i=e.length;n<i;n++)e[n]=Cn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,i,o,r,a,s,c=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,r=this._parts.length;n<r;n++)for(i=0,o=(a=(s=this._parts[n]).length)-1;i<a;o=i++)if((t||0!==i)&&En(e,s[o],s[i])<=c)return!0;return!1}});function li(e,t){return new ci(e,t)}ci._flat=jn;var ui=ci.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return kn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=ci.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof B&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){ci.prototype._setLatLngs.call(this,e),An(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return An(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new O(t,t);if(e=new A(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var i,o=0,r=this._rings.length;o<r;o++)(i=_n(this._rings[o],e,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,i,o,r,a,s,c,l=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(o=0,s=this._parts.length;o<s;o++)for(r=0,a=(c=(t=this._parts[o]).length)-1;r<c;a=r++)n=t[r],i=t[a],n.y>e.y!==i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(l=!l);return l||ci.prototype._containsPoint.call(this,e,!0)}});function di(e,t){return new ui(e,t)}var hi=Jn.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,i,o=v(e)?e:e.features;if(o){for(t=0,n=o.length;t<n;t++)((i=o[t]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var r=this.options;if(r.filter&&!r.filter(e))return this;var a=pi(e,r);return a?(a.feature=_i(e),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(e,a),this.addLayer(a)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function pi(e,t){var n,i,o,r,a="Feature"===e.type?e.geometry:e,s=a?a.coordinates:null,c=[],l=t&&t.pointToLayer,u=t&&t.coordsToLatLng||fi;if(!s&&!a)return null;switch(a.type){case"Point":return mi(l,e,n=u(s),t);case"MultiPoint":for(o=0,r=s.length;o<r;o++)n=u(s[o]),c.push(mi(l,e,n,t));return new Jn(c);case"LineString":case"MultiLineString":return i=gi(s,"LineString"===a.type?0:1,u),new ci(i,t);case"Polygon":case"MultiPolygon":return i=gi(s,"Polygon"===a.type?1:2,u),new ui(i,t);case"GeometryCollection":for(o=0,r=a.geometries.length;o<r;o++){var d=pi({geometry:a.geometries[o],type:"Feature",properties:e.properties},t);d&&c.push(d)}return new Jn(c);case"FeatureCollection":for(o=0,r=a.features.length;o<r;o++){var h=pi(a.features[o],t);h&&c.push(h)}return new Jn(c);default:throw new Error("Invalid GeoJSON object.")}}function mi(e,t,n,i){return e?e(t,n):new ti(n,i&&i.markersInheritOptions&&i)}function fi(e){return new B(e[1],e[0],e[2])}function gi(e,t,n){for(var i,o=[],r=0,a=e.length;r<a;r++)i=t?gi(e[r],t-1,n):(n||fi)(e[r]),o.push(i);return o}function vi(e,t){return void 0!==(e=z(e)).alt?[u(e.lng,t),u(e.lat,t),u(e.alt,t)]:[u(e.lng,t),u(e.lat,t)]}function yi(e,t,n,i){for(var o=[],r=0,a=e.length;r<a;r++)o.push(t?yi(e[r],An(e[r])?0:t-1,n,i):vi(e[r],i));return!t&&n&&o.length>0&&o.push(o[0].slice()),o}function bi(e,t){return e.feature?n({},e.feature,{geometry:t}):_i(t)}function _i(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var ki={toGeoJSON:function(e){return bi(this,{type:"Point",coordinates:vi(this.getLatLng(),e)})}};function wi(e,t){return new hi(e,t)}ti.include(ki),ai.include(ki),oi.include(ki),ci.include({toGeoJSON:function(e){var t=!An(this._latlngs);return bi(this,{type:(t?"Multi":"")+"LineString",coordinates:yi(this._latlngs,t?1:0,!1,e)})}}),ui.include({toGeoJSON:function(e){var t=!An(this._latlngs),n=t&&!An(this._latlngs[0]),i=yi(this._latlngs,n?2:t?1:0,!0,e);return t||(i=[i]),bi(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),Gn.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(n){t.push(n.toGeoJSON(e).geometry.coordinates)}),bi(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var o=t.toGeoJSON(e);if(n)i.push(o.geometry);else{var r=_i(o);"FeatureCollection"===r.type?i.push.apply(i,r.features):i.push(r)}}}),n?bi(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Si=wi,Ti=Zn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=F(t),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(bt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){mt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&gt(this._image),this},bringToBack:function(){return this._map&&vt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=F(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:pt("img");bt(t,"leaflet-image-layer"),this._zoomAnimated&&bt(t,"leaflet-zoom-animated"),this.options.className&&bt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onload=o(this.fire,this,"load"),t.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Et(this._image,n,t)},_reset:function(){var e=this._image,t=new A(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();xt(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){St(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Ci=function(e,t,n){return new Ti(e,t,n)},Ei=Ti.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:pt("video");if(bt(t,"leaflet-image-layer"),this._zoomAnimated&&bt(t,"leaflet-zoom-animated"),this.options.className&&bt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onloadeddata=o(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),i=[],r=0;r<n.length;r++)i.push(n[r].src);this._url=n.length>0?i:[t.src]}else{v(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var s=pt("source");s.src=this._url[a],t.appendChild(s)}}}});function xi(e,t,n){return new Ei(e,t,n)}var Pi=Ti.extend({_initImage:function(){var e=this._image=this._url;bt(e,"leaflet-image-layer"),this._zoomAnimated&&bt(e,"leaflet-zoom-animated"),this.options.className&&bt(e,this.options.className),e.onselectstart=l,e.onmousemove=l}});function Ri(e,t,n){return new Pi(e,t,n)}var Ii=Zn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof B||v(e))?(this._latlng=z(e),p(this,t)):(p(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&St(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&St(this._container,1),this.bringToFront(),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(St(this._container,0),this._removeTimeout=setTimeout(o(mt,void 0,this._container),200)):mt(this._container),this.options.interactive&&(_t(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=z(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&gt(this._container),this},bringToBack:function(){return this._map&&vt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Jn){t=null;var n=this._source._layers;for(var i in n)if(n[i]._map){t=n[i];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=D(this.options.offset),n=this._getAnchor();this._zoomAnimated?xt(this._container,e.add(n)):t=t.add(e).add(n);var i=this._containerBottom=-t.y,o=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=i+"px",this._container.style.left=o+"px"}},_getAnchor:function(){return[0,0]}});nn.include({_initOverlay:function(e,t,n,i){var o=t;return o instanceof e||(o=new e(i).setContent(t)),n&&o.setLatLng(n),o}}),Zn.include({_initOverlay:function(e,t,n,i){var o=n;return o instanceof e?(p(o,i),o._source=this):(o=t&&!i?t:new e(i,this)).setContent(n),o}});var Mi=Ii.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Ii.prototype.openOn.call(this,e)},onAdd:function(e){Ii.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ii||this._source.on("preclick",Wt))},onRemove:function(e){Ii.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ii||this._source.off("preclick",Wt))},getEvents:function(){var e=Ii.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=pt("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=pt("div",e+"-content-wrapper",t);if(this._contentNode=pt("div",e+"-content",n),Zt(t),Ht(this._contentNode),jt(t,"contextmenu",Wt),this._tipContainer=pt("div",e+"-tip-container",t),this._tip=pt("div",e+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=pt("a",e+"-close-button",t);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',jt(i,"click",function(e){Gt(e),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,o=this.options.maxHeight,r="leaflet-popup-scrolled";o&&i>o?(t.height=o+"px",bt(e,r)):_t(e,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();xt(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var e=this._map,t=parseInt(ht(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+t,i=this._containerWidth,o=new O(this._containerLeft,-n-this._containerBottom);o._add(Pt(this._container));var r=e.layerPointToContainerPoint(o),a=D(this.options.autoPanPadding),s=D(this.options.autoPanPaddingTopLeft||a),c=D(this.options.autoPanPaddingBottomRight||a),l=e.getSize(),u=0,d=0;r.x+i+c.x>l.x&&(u=r.x+i-l.x+c.x),r.x-u-s.x<0&&(u=r.x-s.x),r.y+n+c.y>l.y&&(d=r.y+n-l.y+c.y),r.y-d-s.y<0&&(d=r.y-s.y),(u||d)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([u,d]))}},_getAnchor:function(){return D(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Oi=function(e,t){return new Mi(e,t)};nn.mergeOptions({closePopupOnClick:!0}),nn.include({openPopup:function(e,t,n){return this._initOverlay(Mi,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Zn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Mi,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Jn||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Kt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof ii?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Li=Ii.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Ii.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Ii.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Ii.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=pt("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+a(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,i=this._map,o=this._container,r=i.latLngToContainerPoint(i.getCenter()),a=i.layerPointToContainerPoint(e),s=this.options.direction,c=o.offsetWidth,l=o.offsetHeight,u=D(this.options.offset),d=this._getAnchor();"top"===s?(t=c/2,n=l):"bottom"===s?(t=c/2,n=0):"center"===s?(t=c/2,n=l/2):"right"===s?(t=0,n=l/2):"left"===s?(t=c,n=l/2):a.x<r.x?(s="right",t=0,n=l/2):(s="left",t=c+2*(u.x+d.x),n=l/2),e=e.subtract(D(t,n,!0)).add(u).add(d),_t(o,"leaflet-tooltip-right"),_t(o,"leaflet-tooltip-left"),_t(o,"leaflet-tooltip-top"),_t(o,"leaflet-tooltip-bottom"),bt(o,"leaflet-tooltip-"+s),xt(o,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&St(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return D(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Ni=function(e,t){return new Li(e,t)};nn.include({openTooltip:function(e,t,n){return this._initOverlay(Li,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Zn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Li,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Jn||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&(jt(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),jt(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)})}else this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,n,i=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var Di=Yn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ft(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=D(n.bgPos);t.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Ai(e){return new Di(e)}Yn.Default=Xn;var ji=Zn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ae.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),mt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(gt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof O?e:new O(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,i=-e(-1/0,1/0),o=0,r=n.length;o<r;o++)t=n[o].style.zIndex,n[o]!==this._container&&t&&(i=e(i,+t));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ae.ielt9){St(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var i in this._tiles){var o=this._tiles[i];if(o.current&&o.loaded){var r=Math.min(1,(e-o.loaded)/200);St(o.el,r),r<1?t=!0:(o.active?n=!0:this._onOpaqueTile(o),o.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(E(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=pt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(mt(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[e],o=this._map;return i||((i=this._levels[e]={}).el=pt("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=t,i.origin=o.project(o.unproject(o.getPixelOrigin()),e).round(),i.zoom=e,this._setZoomTransform(i,o.getCenter(),o.getZoom()),l(i.el.offsetWidth),this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var i=t.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)mt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,i){var o=Math.floor(e/2),r=Math.floor(t/2),a=n-1,s=new O(+o,+r);s.z=+a;var c=this._tileCoordsToKey(s),l=this._tiles[c];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),a>i&&this._retainParent(o,r,a,i))},_retainChildren:function(e,t,n,i){for(var o=2*e;o<2*e+2;o++)for(var r=2*t;r<2*t+2;r++){var a=new O(o,r);a.z=n+1;var s=this._tileCoordsToKey(a),c=this._tiles[s];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),n+1<i&&this._retainChildren(o,r,n+1,i))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,i){var o=Math.round(t);o=void 0!==this.options.maxZoom&&o>this.options.maxZoom||void 0!==this.options.minZoom&&o<this.options.minZoom?void 0:this._clampZoom(o);var r=this.options.updateWhenZooming&&o!==this._tileZoom;i&&!r||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==o&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var i=this._map.getZoomScale(n,e.zoom),o=e.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,n)).round();Ae.any3d?Et(e.el,o,i):xt(e.el,o)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],i).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],i).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],i).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),i=t.getZoomScale(n,this._tileZoom),o=t.project(e,this._tileZoom).floor(),r=t.getSize().divideBy(2*i);return new A(o.subtract(r),o.add(r))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(e),o=this._pxBoundsToTileRange(i),r=o.getCenter(),a=[],s=this.options.keepBuffer,c=new A(o.getBottomLeft().subtract([s,-s]),o.getTopRight().add([s,-s]));if(!(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.max.x)&&isFinite(o.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var l in this._tiles){var u=this._tiles[l].coords;u.z===this._tileZoom&&c.contains(new O(u.x,u.y))||(this._tiles[l].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var d=o.min.y;d<=o.max.y;d++)for(var h=o.min.x;h<=o.max.x;h++){var p=new O(h,d);if(p.z=this._tileZoom,this._isValidTile(p)){var m=this._tiles[this._tileCoordsToKey(p)];m?m.current=!0:a.push(p)}}if(a.sort(function(e,t){return e.distanceTo(r)-t.distanceTo(r)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var f=document.createDocumentFragment();for(h=0;h<a.length;h++)this._addTile(a[h],f);this._level.el.appendChild(f)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(e);return F(this.options.bounds).overlaps(i)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),i=e.scaleBy(n),o=i.add(n);return[t.unproject(i,e.z),t.unproject(o,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new U(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new O(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(mt(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){bt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=l,e.onmousemove=l,Ae.ielt9&&this.options.opacity<1&&St(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),i=this._tileCoordsToKey(e),r=this.createTile(this._wrapCoords(e),o(this._tileReady,this,e));this._initTile(r),this.createTile.length<2&&C(o(this._tileReady,this,e,null,r)),xt(r,n),this._tiles[i]={el:r,coords:e,current:!0},t.appendChild(r),this.fire("tileloadstart",{tile:r,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var i=this._tileCoordsToKey(e);(n=this._tiles[i])&&(n.loaded=+new Date,this._map._fadeAnimated?(St(n.el,0),E(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(bt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ae.ielt9||!this._map._fadeAnimated?C(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new O(this._wrapX?c(e.x,this._wrapX):e.x,this._wrapY?c(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new A(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ui(e){return new ji(e)}var Fi=ji.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=p(this,t)).detectRetina&&Ae.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return jt(n,"load",o(this._tileOnLoad,this,t,n)),jt(n,"error",o(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Ae.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=i),t["-y"]=i}return g(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Ae.ielt9?setTimeout(o(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var i=this.options.errorTileUrl;i&&t.getAttribute("src")!==i&&(t.src=i),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=l,t.onerror=l,!t.complete)){t.src=b;var n=this._tiles[e].coords;mt(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",b),ji.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==b))return ji.prototype._tileReady.call(this,e,t,n)}});function Bi(e,t){return new Fi(e,t)}var zi=Fi.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var i=n({},this.defaultWmsParams);for(var o in t)o in this.options||(i[o]=t[o]);var r=(t=p(this,t)).detectRetina&&Ae.retina?2:1,a=this.getTileSize();i.width=a.x*r,i.height=a.y*r,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Fi.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,i=j(n.project(t[0]),n.project(t[1])),o=i.min,r=i.max,a=(this._wmsVersion>=1.3&&this._crs===Wn?[o.y,o.x,r.y,r.x]:[o.x,o.y,r.x,r.y]).join(","),s=Fi.prototype.getTileUrl.call(this,e);return s+m(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Vi(e,t){return new zi(e,t)}Fi.WMS=zi,Bi.wms=Vi;var qi=Zn.extend({options:{padding:.1},initialize:function(e){p(this,e),a(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),bt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,t),r=i.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(e,t));Ae.any3d?Et(this._container,r,n):xt(this._container,r)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new A(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Wi=qi.extend({options:{tolerance:0},getEvents:function(){var e=qi.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){qi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");jt(e,"mousemove",this._onMouseMove,this),jt(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),jt(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){E(this._redrawRequest),delete this._ctx,mt(this._container),Ft(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){qi.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),i=Ae.retina?2:1;xt(t,e.min),t.width=i*n.x,t.height=i*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",Ae.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){qi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[a(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,i=t.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete e._order,delete this._layers[a(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,i=e.options.dashArray.split(/[, ]+/),o=[];for(n=0;n<i.length;n++){if(t=Number(i[n]),isNaN(t))return;o.push(t)}e.options._dashArray=o}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||C(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new A,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)e=i.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,i,o,r,a=e._parts,s=a.length,c=this._ctx;if(s){for(c.beginPath(),n=0;n<s;n++){for(i=0,o=a[n].length;i<o;i++)r=a[n][i],c[i?"lineTo":"moveTo"](r.x,r.y);t&&c.closePath()}this._fillStroke(c,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,i=Math.max(Math.round(e._radius),1),o=(Math.max(Math.round(e._radiusY),1)||i)/i;1!==o&&(n.save(),n.scale(1,o)),n.beginPath(),n.arc(t.x,t.y/o,i,0,2*Math.PI,!1),1!==o&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,i=this._map.mouseEventToLayerPoint(e),o=this._drawFirst;o;o=o.next)(t=o.layer).options.interactive&&t._containsPoint(i)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(_t(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,i,r=this._drawFirst;r;r=r.next)(n=r.layer).options.interactive&&n._containsPoint(t)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(e),i&&(bt(this._container,"leaflet-interactive"),this._fireEvent([i],e,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Hi(e){return Ae.canvas?new Wi(e):null}var Zi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Gi={_initContainer:function(){this._container=pt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(qi.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Zi("shape");bt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Zi("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;mt(t),e.removeInteractiveTarget(t),delete this._layers[a(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,i=e.options,o=e._container;o.stroked=!!i.stroke,o.filled=!!i.fill,i.stroke?(t||(t=e._stroke=Zi("stroke")),o.appendChild(t),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=v(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=i.lineCap.replace("butt","flat"),t.joinstyle=i.lineJoin):t&&(o.removeChild(t),e._stroke=null),i.fill?(n||(n=e._fill=Zi("fill")),o.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(o.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),i=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+i+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){gt(e._container)},_bringToBack:function(e){vt(e._container)}},Ki=Ae.vml?Zi:Q,Ji=qi.extend({_initContainer:function(){this._container=Ki("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ki("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){mt(this._container),Ft(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){qi.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),xt(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Ki("path");e.options.className&&bt(t,e.options.className),e.options.interactive&&bt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){mt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[a(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Y(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),i="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",o=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(e,o)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){gt(e._path)},_bringToBack:function(e){vt(e._path)}});function Qi(e){return Ae.svg||Ae.vml?new Ji(e):null}Ae.vml&&Ji.include(Gi),nn.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Hi(e)||Qi(e)}});var Yi=ui.extend({initialize:function(e,t){ui.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=F(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function $i(e,t){return new Yi(e,t)}Ji.create=Ki,Ji.pointsToPath=Y,hi.geometryToLayer=pi,hi.coordsToLatLng=fi,hi.coordsToLatLngs=gi,hi.latLngToCoords=vi,hi.latLngsToCoords=yi,hi.getFeature=bi,hi.asFeature=_i,nn.mergeOptions({boxZoom:!0});var Xi=gn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){jt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ft(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){mt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),it(),It(),this._startPoint=this._map.mouseEventToContainerPoint(e),jt(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=pt("div","leaflet-zoom-box",this._container),bt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new A(this._point,this._startPoint),n=t.getSize();xt(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(mt(this._box),_t(this._container,"leaflet-crosshair")),ot(),Mt(),Ft(document,{contextmenu:Kt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var t=new U(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nn.addInitHook("addHandler","boxZoom",Xi),nn.mergeOptions({doubleClickZoom:!0});var eo=gn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),i=t.options.zoomDelta,o=e.originalEvent.shiftKey?n-i:n+i;"center"===t.options.doubleClickZoom?t.setZoom(o):t.setZoomAround(e.containerPoint,o)}});nn.addInitHook("addHandler","doubleClickZoom",eo),nn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var to=gn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new bn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}bt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_t(this._map._container,"leaflet-grab"),_t(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=F(this._map.options.maxBounds);this._offsetLimit=j(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,o=(i-t+n)%e+t-n,r=(i+t+n)%e-t-n,a=Math.abs(o+n)<Math.abs(r+n)?o:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(e){var t=this._map,n=t.options,i=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),i)t.fire("moveend");else{this._prunePositions(+new Date);var o=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,s=o.multiplyBy(a/r),c=s.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,c),u=s.multiplyBy(l/c),d=l/(n.inertiaDeceleration*a),h=u.multiplyBy(-d/2).round();h.x||h.y?(h=t._limitOffset(h,t.options.maxBounds),C(function(){t.panBy(h,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):t.fire("moveend")}}});nn.addInitHook("addHandler","dragging",to),nn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var no=gn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),jt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ft(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,i=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,i=this._panKeys={},o=this.keyCodes;for(t=0,n=o.left.length;t<n;t++)i[o.left[t]]=[-1*e,0];for(t=0,n=o.right.length;t<n;t++)i[o.right[t]]=[e,0];for(t=0,n=o.down.length;t<n;t++)i[o.down[t]]=[0,e];for(t=0,n=o.up.length;t<n;t++)i[o.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,i=this._zoomKeys={},o=this.keyCodes;for(t=0,n=o.zoomIn.length;t<n;t++)i[o.zoomIn[t]]=e;for(t=0,n=o.zoomOut.length;t<n;t++)i[o.zoomOut[t]]=-e},_addHooks:function(){jt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ft(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,i=this._map;if(n in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(t=this._panKeys[n],e.shiftKey&&(t=D(t).multiplyBy(3)),i.options.maxBounds&&(t=i._limitOffset(D(t),i.options.maxBounds)),i.options.worldCopyJump){var o=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(t)));i.panTo(o)}else i.panBy(t)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Kt(e)}}});nn.addInitHook("addHandler","keyboard",no),nn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var io=gn.extend({addHooks:function(){jt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ft(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=$t(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),i),Kt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,r=n?Math.ceil(o/n)*n:o,a=e._limitZoom(t+(this._delta>0?r:-r))-t;this._delta=0,this._startTime=null,a&&("center"===e.options.scrollWheelZoom?e.setZoom(t+a):e.setZoomAround(this._lastMousePos,t+a))}});nn.addInitHook("addHandler","scrollWheelZoom",io);var oo=600;nn.mergeOptions({tapHold:Ae.touchNative&&Ae.safari&&Ae.mobile,tapTolerance:15});var ro=gn.extend({addHooks:function(){jt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ft(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new O(t.clientX,t.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(jt(document,"touchend",Gt),jt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),oo),jt(document,"touchend touchcancel contextmenu",this._cancel,this),jt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Ft(document,"touchend",Gt),Ft(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Ft(document,"touchend touchcancel contextmenu",this._cancel,this),Ft(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new O(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});nn.addInitHook("addHandler","tapHold",ro),nn.mergeOptions({touchZoom:Ae.touch,bounceAtZoomLimits:!0});var ao=gn.extend({addHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),jt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_t(this._map._container,"leaflet-touch-zoom"),Ft(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),jt(document,"touchmove",this._onTouchMove,this),jt(document,"touchend touchcancel",this._onTouchEnd,this),Gt(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]),r=n.distanceTo(i)/this._startDist;if(this._zoom=t.getScaleZoom(r,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&r<1||this._zoom>t.getMaxZoom()&&r>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===r)return}else{var a=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===r&&0===a.x&&0===a.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),E(this._animRequest);var s=o(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=C(s,this,!0),Gt(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,E(this._animRequest),Ft(document,"touchmove",this._onTouchMove,this),Ft(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});nn.addInitHook("addHandler","touchZoom",ao),nn.BoxZoom=Xi,nn.DoubleClickZoom=eo,nn.Drag=to,nn.Keyboard=no,nn.ScrollWheelZoom=io,nn.TapHold=ro,nn.TouchZoom=ao,e.Bounds=A,e.Browser=Ae,e.CRS=V,e.Canvas=Wi,e.Circle=ai,e.CircleMarker=oi,e.Class=P,e.Control=rn,e.DivIcon=Di,e.DivOverlay=Ii,e.DomEvent=en,e.DomUtil=At,e.Draggable=bn,e.Evented=M,e.FeatureGroup=Jn,e.GeoJSON=hi,e.GridLayer=ji,e.Handler=gn,e.Icon=Yn,e.ImageOverlay=Ti,e.LatLng=B,e.LatLngBounds=U,e.Layer=Zn,e.LayerGroup=Gn,e.LineUtil=Fn,e.Map=nn,e.Marker=ti,e.Mixin=vn,e.Path=ii,e.Point=O,e.PolyUtil=Tn,e.Polygon=ui,e.Polyline=ci,e.Popup=Mi,e.PosAnimation=tn,e.Projection=Vn,e.Rectangle=Yi,e.Renderer=qi,e.SVG=Ji,e.SVGOverlay=Pi,e.TileLayer=Fi,e.Tooltip=Li,e.Transformation=Z,e.Util=x,e.VideoOverlay=Ei,e.bind=o,e.bounds=j,e.canvas=Hi,e.circle=si,e.circleMarker=ri,e.control=an,e.divIcon=Ai,e.extend=n,e.featureGroup=Qn,e.geoJSON=wi,e.geoJson=Si,e.gridLayer=Ui,e.icon=$n,e.imageOverlay=Ci,e.latLng=z,e.latLngBounds=F,e.layerGroup=Kn,e.map=on,e.marker=ni,e.point=D,e.polygon=di,e.polyline=li,e.popup=Oi,e.rectangle=$i,e.setOptions=p,e.stamp=a,e.svg=Qi,e.svgOverlay=Ri,e.tileLayer=Bi,e.tooltip=Ni,e.transformation=G,e.version=t,e.videoOverlay=xi;var so=window.L;e.noConflict=function(){return window.L=so,this},window.L=e}(t)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,o=e[i];if(!(0<r(o,t)))break e;e[i]=t,e[n]=o,n=i}}function i(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,o=e.length,a=o>>>1;i<a;){var s=2*(i+1)-1,c=e[s],l=s+1,u=e[l];if(0>r(c,n))l<o&&0>r(u,c)?(e[i]=u,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<o&&0>r(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],u=[],d=1,h=null,p=3,m=!1,f=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=i(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function k(e){if(g=!1,_(e),!f)if(null!==i(l))f=!0,L(w);else{var t=i(u);null!==t&&N(k,t.startTime-e)}}function w(e,n){f=!1,g&&(g=!1,y(E),E=-1),m=!0;var r=p;try{for(_(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!R());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===i(l)&&o(l),_(n)}else o(l);h=i(l)}if(null!==h)var c=!0;else{var d=i(u);null!==d&&N(k,d.startTime-n),c=!1}return c}finally{h=null,p=r,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,C=null,E=-1,x=5,P=-1;function R(){return!(t.unstable_now()-P<x)}function I(){if(null!==C){var e=t.unstable_now();P=e;var n=!0;try{n=C(!0,e)}finally{n?S():(T=!1,C=null)}}else T=!1}if("function"===typeof b)S=function(){b(I)};else if("undefined"!==typeof MessageChannel){var M=new MessageChannel,O=M.port2;M.port1.onmessage=I,S=function(){O.postMessage(null)}}else S=function(){v(I,0)};function L(e){C=e,T||(T=!0,S())}function N(e,n){E=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,L(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,r){var a=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?a+r:a:r=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:r,expirationTime:s=r+s,sortIndex:-1},r>a?(e.sortIndex=r,n(u,e),null===i(l)&&e===i(u)&&(g?(y(E),E=-1):g=!0,N(k,r-a))):(e.sortIndex=s,n(l,e),f||m||(f=!0,L(w))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},391:(e,t,n)=>{"use strict";var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},579:(e,t,n)=>{"use strict";e.exports=n(153)},730:(e,t,n)=>{"use strict";var i=n(43),o=n(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,i,o,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var o=g.hasOwnProperty(t)?g[t]:null;(null!==o?0!==o.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,i)&&(n=null),i||null===o?function(e){return!!d.call(m,e)||!d.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,i=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var _=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),x=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),O=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var N=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var A,j=Object.assign;function U(e){if(void 0===A)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);A=t&&t[1]||""}return"\n"+A+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var o=l.stack.split("\n"),r=i.stack.split("\n"),a=o.length-1,s=r.length-1;1<=a&&0<=s&&o[a]!==r[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==r[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==r[s]){var c="\n"+o[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function z(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case C:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case x:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case P:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case O:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Z(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=H(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function $(e,t){Y(e,t);var n=W(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function X(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&i&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(i&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function re(e,t){var n=W(t.value),i=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),o=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,o):e[n]=o}}Object.keys(pe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Te=null;function Ce(e){if(e=_o(e)){if("function"!==typeof we)throw Error(r(280));var t=e.stateNode;t&&(t=wo(t),we(e.stateNode,e.type,t))}}function Ee(e){Se?Te?Te.push(e):Te=[e]:Se=e}function xe(){if(Se){var e=Se,t=Te;if(Te=Se=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Pe(e,t){return e(t)}function Re(){}var Ie=!1;function Me(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Pe(e,t,n)}finally{Ie=!1,(null!==Se||null!==Te)&&(Re(),xe())}}function Oe(e,t){var n=e.stateNode;if(null===n)return null;var i=wo(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var Le=!1;if(u)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(ue){Le=!1}function De(e,t,n,i,o,r,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Ae=!1,je=null,Ue=!1,Fe=null,Be={onError:function(e){Ae=!0,je=e}};function ze(e,t,n,i,o,r,a,s,c){Ae=!1,je=null,De.apply(Be,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ve(e)!==e)throw Error(r(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(i=o.return)){n=i;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return We(o),e;if(a===i)return We(o),t;a=a.sibling}throw Error(r(188))}if(n.return!==i.return)n=o,i=a;else{for(var s=!1,c=o.child;c;){if(c===n){s=!0,n=o,i=a;break}if(c===i){s=!0,i=o,n=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===n){s=!0,n=a,i=o;break}if(c===i){s=!0,i=a,n=o;break}c=c.sibling}if(!s)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e))?Ze(e):null}function Ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ze(e);if(null!==t)return t;e=e.sibling}return null}var Ge=o.unstable_scheduleCallback,Ke=o.unstable_cancelCallback,Je=o.unstable_shouldYield,Qe=o.unstable_requestPaint,Ye=o.unstable_now,$e=o.unstable_getCurrentPriorityLevel,Xe=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,it=o.unstable_IdlePriority,ot=null,rt=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,o=e.suspendedLanes,r=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~o;0!==s?i=dt(s):0!==(r&=a)&&(i=dt(r))}else 0!==(a=n&~o)?i=dt(a):0!==r&&(i=dt(r));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&o)&&((o=i&-i)>=(r=t&-t)||16===o&&0!==(4194240&r)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)o=1<<(n=31-at(t)),i|=e[n],t&=~o;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),o=1<<i;o&t|e[i]&t&&(e[i]|=t),n&=~o}}var bt=0;function _t(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,wt,St,Tt,Ct,Et=!1,xt=[],Pt=null,Rt=null,It=null,Mt=new Map,Ot=new Map,Lt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Pt=null;break;case"dragenter":case"dragleave":Rt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Mt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function At(e,t,n,i,o,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[o]},null!==t&&(null!==(t=_o(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function jt(e){var t=bo(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void Ct(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_o(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);_e=i,n.target.dispatchEvent(i),_e=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function Bt(){Et=!1,null!==Pt&&Ut(Pt)&&(Pt=null),null!==Rt&&Ut(Rt)&&(Rt=null),null!==It&&Ut(It)&&(It=null),Mt.forEach(Ft),Ot.forEach(Ft)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return zt(t,e)}if(0<xt.length){zt(xt[0],e);for(var n=1;n<xt.length;n++){var i=xt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Pt&&zt(Pt,e),null!==Rt&&zt(Rt,e),null!==It&&zt(It,e),Mt.forEach(t),Ot.forEach(t),n=0;n<Lt.length;n++)(i=Lt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)jt(n),null===n.blockedOn&&Lt.shift()}var qt=_.ReactCurrentBatchConfig,Wt=!0;function Ht(e,t,n,i){var o=bt,r=qt.transition;qt.transition=null;try{bt=1,Gt(e,t,n,i)}finally{bt=o,qt.transition=r}}function Zt(e,t,n,i){var o=bt,r=qt.transition;qt.transition=null;try{bt=4,Gt(e,t,n,i)}finally{bt=o,qt.transition=r}}function Gt(e,t,n,i){if(Wt){var o=Jt(e,t,n,i);if(null===o)Wi(e,t,i,Kt,n),Dt(e,i);else if(function(e,t,n,i,o){switch(t){case"focusin":return Pt=At(Pt,e,t,n,i,o),!0;case"dragenter":return Rt=At(Rt,e,t,n,i,o),!0;case"mouseover":return It=At(It,e,t,n,i,o),!0;case"pointerover":var r=o.pointerId;return Mt.set(r,At(Mt.get(r)||null,e,t,n,i,o)),!0;case"gotpointercapture":return r=o.pointerId,Ot.set(r,At(Ot.get(r)||null,e,t,n,i,o)),!0}return!1}(o,e,t,n,i))i.stopPropagation();else if(Dt(e,i),4&t&&-1<Nt.indexOf(e)){for(;null!==o;){var r=_o(o);if(null!==r&&kt(r),null===(r=Jt(e,t,n,i))&&Wi(e,t,i,Kt,n),r===o)break;o=r}null!==o&&i.stopPropagation()}else Wi(e,t,i,null,n)}}var Kt=null;function Jt(e,t,n,i){if(Kt=null,null!==(e=bo(e=ke(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($e()){case Xe:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,$t=null,Xt=null;function en(){if(Xt)return Xt;var e,t,n=$t,i=n.length,o="value"in Yt?Yt.value:Yt.textContent,r=o.length;for(e=0;e<i&&n[e]===o[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===o[r-t];t++);return Xt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function on(){return!1}function rn(e){function t(t,n,i,o,r){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:on,this.isPropagationStopped=on,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=rn(ln),dn=j({},ln,{view:0,detail:0}),hn=rn(dn),pn=j({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),mn=rn(pn),fn=rn(j({},pn,{dataTransfer:0})),gn=rn(j({},dn,{relatedTarget:0})),vn=rn(j({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=j({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=rn(yn),_n=rn(j({},ln,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Cn(){return Tn}var En=j({},dn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),xn=rn(En),Pn=rn(j({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=rn(j({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),In=rn(j({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=j({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),On=rn(Mn),Ln=[9,13,27,32],Nn=u&&"CompositionEvent"in window,Dn=null;u&&"documentMode"in document&&(Dn=document.documentMode);var An=u&&"TextEvent"in window&&!Dn,jn=u&&(!Nn||Dn&&8<Dn&&11>=Dn),Un=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Hn(e,t,n,i){Ee(i),0<(t=Zi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Zn=null,Gn=null;function Kn(e){Ui(e,0)}function Jn(e){if(G(ko(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(u){var $n;if(u){var Xn="oninput"in document;if(!Xn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Xn="function"===typeof ei.oninput}$n=Xn}else $n=!1;Yn=$n&&(!document.documentMode||9<document.documentMode)}function ti(){Zn&&(Zn.detachEvent("onpropertychange",ni),Gn=Zn=null)}function ni(e){if("value"===e.propertyName&&Jn(Gn)){var t=[];Hn(t,Gn,e,ke(e)),Me(Kn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Gn=n,(Zn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function oi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Gn)}function ri(e,t){if("click"===e)return Jn(t)}function ai(e,t){if("input"===e||"change"===e)return Jn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!d.call(t,o)||!si(e[o],t[o]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,r=Math.min(i.start,o);i=void 0===i.end?r:Math.min(i.end,o),!e.extend&&r>i&&(o=i,i=r,r=o),o=ui(n,r);var a=ui(n,i);o&&a&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),r>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,bi=!1;function _i(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==K(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=Zi(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function ki(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:ki("Animation","AnimationEnd"),animationiteration:ki("Animation","AnimationIteration"),animationstart:ki("Animation","AnimationStart"),transitionend:ki("Transition","TransitionEnd")},Si={},Ti={};function Ci(e){if(Si[e])return Si[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ti)return Si[e]=n[t];return e}u&&(Ti=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ei=Ci("animationend"),xi=Ci("animationiteration"),Pi=Ci("animationstart"),Ri=Ci("transitionend"),Ii=new Map,Mi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oi(e,t){Ii.set(e,t),c(t,[e])}for(var Li=0;Li<Mi.length;Li++){var Ni=Mi[Li];Oi(Ni.toLowerCase(),"on"+(Ni[0].toUpperCase()+Ni.slice(1)))}Oi(Ei,"onAnimationEnd"),Oi(xi,"onAnimationIteration"),Oi(Pi,"onAnimationStart"),Oi("dblclick","onDoubleClick"),Oi("focusin","onFocus"),Oi("focusout","onBlur"),Oi(Ri,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Di="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ai=new Set("cancel close invalid load scroll toggle".split(" ").concat(Di));function ji(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,o,a,s,c,l){if(ze.apply(this,arguments),Ae){if(!Ae)throw Error(r(198));var u=je;Ae=!1,je=null,Ue||(Ue=!0,Fe=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],o=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==r&&o.isPropagationStopped())break e;ji(o,s,l),r=c}else for(a=0;a<i.length;a++){if(c=(s=i[a]).instance,l=s.currentTarget,s=s.listener,c!==r&&o.isPropagationStopped())break e;ji(o,s,l),r=c}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fi(e,t){var n=t[go];void 0===n&&(n=t[go]=new Set);var i=e+"__bubble";n.has(i)||(qi(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),qi(n,e,i,t)}var zi="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[zi]){e[zi]=!0,a.forEach(function(t){"selectionchange"!==t&&(Ai.has(t)||Bi(t,!1,e),Bi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zi]||(t[zi]=!0,Bi("selectionchange",!1,t))}}function qi(e,t,n,i){switch(Qt(t)){case 1:var o=Ht;break;case 4:o=Zt;break;default:o=Gt}n=o.bind(null,t,n,e),o=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),i?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Wi(e,t,n,i,o){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===o||8===c.nodeType&&c.parentNode===o))return;a=a.return}for(;null!==s;){if(null===(a=bo(s)))return;if(5===(c=a.tag)||6===c){i=r=a;continue e}s=s.parentNode}}i=i.return}Me(function(){var i=r,o=ke(n),a=[];e:{var s=Ii.get(e);if(void 0!==s){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=xn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Rn;break;case Ei:case xi:case Pi:c=vn;break;case Ri:c=In;break;case"scroll":c=hn;break;case"wheel":c=On;break;case"copy":case"cut":case"paste":c=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Pn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,m=i;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Oe(m,h))&&u.push(Hi(m,f,p)))),d)break;m=m.return}0<u.length&&(s=new c(s,l,null,n,o),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===_e||!(l=n.relatedTarget||n.fromElement)||!bo(l)&&!l[fo])&&(c||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?bo(l):null)&&(l!==(d=Ve(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(u=mn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=Pn,f="onPointerLeave",h="onPointerEnter",m="pointer"),d=null==c?s:ko(c),p=null==l?s:ko(l),(s=new u(f,m+"leave",c,n,o)).target=d,s.relatedTarget=p,f=null,bo(o)===i&&((u=new u(h,m+"enter",l,n,o)).target=p,u.relatedTarget=d,f=u),d=f,c&&l)e:{for(h=l,m=0,p=u=c;p;p=Gi(p))m++;for(p=0,f=h;f;f=Gi(f))p++;for(;0<m-p;)u=Gi(u),m--;for(;0<p-m;)h=Gi(h),p--;for(;m--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gi(u),h=Gi(h)}u=null}else u=null;null!==c&&Ki(a,s,c,u,!1),null!==l&&null!==d&&Ki(a,d,l,u,!0)}if("select"===(c=(s=i?ko(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Qn;else if(Wn(s))if(Yn)g=ai;else{g=oi;var v=ii}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ri);switch(g&&(g=g(e,i))?Hn(a,g,n,o):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=i?ko(i):window,e){case"focusin":(Wn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,_i(a,n,o);break;case"selectionchange":if(fi)break;case"keydown":case"keyup":_i(a,n,o)}var y;if(Nn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(jn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):($t="value"in(Yt=o)?Yt.value:Yt.textContent,Vn=!0)),0<(v=Zi(i,b)).length&&(b=new _n(b,e,null,n,o),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=zn(n))&&(b.data=y))),(y=An?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Nn&&Bn(e,t)?(e=en(),Xt=$t=Yt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Zi(i,"onBeforeInput")).length&&(o=new _n("onBeforeInput","beforeinput",null,n,o),a.push({event:o,listeners:i}),o.data=y))}Ui(a,t)})}function Hi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Zi(e,t){for(var n=t+"Capture",i=[];null!==e;){var o=e,r=o.stateNode;5===o.tag&&null!==r&&(o=r,null!=(r=Oe(e,n))&&i.unshift(Hi(e,r,o)),null!=(r=Oe(e,t))&&i.push(Hi(e,r,o))),e=e.return}return i}function Gi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,o){for(var r=t._reactName,a=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===i)break;5===s.tag&&null!==l&&(s=l,o?null!=(c=Oe(n,r))&&a.unshift(Hi(n,c,s)):o||null!=(c=Oe(n,r))&&a.push(Hi(n,c,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Ji=/\r\n?/g,Qi=/\u0000|\uFFFD/g;function Yi(e){return("string"===typeof e?e:""+e).replace(Ji,"\n").replace(Qi,"")}function $i(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(r(425))}function Xi(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var io="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,ro="function"===typeof Promise?Promise:void 0,ao="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ro?function(e){return ro.resolve(null).then(e).catch(so)}:io;function so(e){setTimeout(function(){throw e})}function co(e,t){var n=t,i=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===i)return e.removeChild(o),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=o}while(n);Vt(t)}function lo(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function uo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ho=Math.random().toString(36).slice(2),po="__reactFiber$"+ho,mo="__reactProps$"+ho,fo="__reactContainer$"+ho,go="__reactEvents$"+ho,vo="__reactListeners$"+ho,yo="__reactHandles$"+ho;function bo(e){var t=e[po];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fo]||n[po]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=uo(e);null!==e;){if(n=e[po])return n;e=uo(e)}return t}n=(e=n).parentNode}return null}function _o(e){return!(e=e[po]||e[fo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ko(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function wo(e){return e[mo]||null}var So=[],To=-1;function Co(e){return{current:e}}function Eo(e){0>To||(e.current=So[To],So[To]=null,To--)}function xo(e,t){To++,So[To]=e.current,e.current=t}var Po={},Ro=Co(Po),Io=Co(!1),Mo=Po;function Oo(e,t){var n=e.type.contextTypes;if(!n)return Po;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var o,r={};for(o in n)r[o]=t[o];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Lo(e){return null!==(e=e.childContextTypes)&&void 0!==e}function No(){Eo(Io),Eo(Ro)}function Do(e,t,n){if(Ro.current!==Po)throw Error(r(168));xo(Ro,t),xo(Io,n)}function Ao(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var o in i=i.getChildContext())if(!(o in t))throw Error(r(108,q(e)||"Unknown",o));return j({},n,i)}function jo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Po,Mo=Ro.current,xo(Ro,e),xo(Io,Io.current),!0}function Uo(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=Ao(e,t,Mo),i.__reactInternalMemoizedMergedChildContext=e,Eo(Io),Eo(Ro),xo(Ro,e)):Eo(Io),xo(Io,n)}var Fo=null,Bo=!1,zo=!1;function Vo(e){null===Fo?Fo=[e]:Fo.push(e)}function qo(){if(!zo&&null!==Fo){zo=!0;var e=0,t=bt;try{var n=Fo;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fo=null,Bo=!1}catch(o){throw null!==Fo&&(Fo=Fo.slice(e+1)),Ge(Xe,qo),o}finally{bt=t,zo=!1}}return null}var Wo=[],Ho=0,Zo=null,Go=0,Ko=[],Jo=0,Qo=null,Yo=1,$o="";function Xo(e,t){Wo[Ho++]=Go,Wo[Ho++]=Zo,Zo=e,Go=t}function er(e,t,n){Ko[Jo++]=Yo,Ko[Jo++]=$o,Ko[Jo++]=Qo,Qo=e;var i=Yo;e=$o;var o=32-at(i)-1;i&=~(1<<o),n+=1;var r=32-at(t)+o;if(30<r){var a=o-o%5;r=(i&(1<<a)-1).toString(32),i>>=a,o-=a,Yo=1<<32-at(t)+o|n<<o|i,$o=r+e}else Yo=1<<r|n<<o|i,$o=e}function tr(e){null!==e.return&&(Xo(e,1),er(e,1,0))}function nr(e){for(;e===Zo;)Zo=Wo[--Ho],Wo[Ho]=null,Go=Wo[--Ho],Wo[Ho]=null;for(;e===Qo;)Qo=Ko[--Jo],Ko[Jo]=null,$o=Ko[--Jo],Ko[Jo]=null,Yo=Ko[--Jo],Ko[Jo]=null}var ir=null,or=null,rr=!1,ar=null;function sr(e,t){var n=Ml(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function cr(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ir=e,or=lo(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ir=e,or=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qo?{id:Yo,overflow:$o}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ml(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ir=e,or=null,!0);default:return!1}}function lr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ur(e){if(rr){var t=or;if(t){var n=t;if(!cr(e,t)){if(lr(e))throw Error(r(418));t=lo(n.nextSibling);var i=ir;t&&cr(e,t)?sr(i,n):(e.flags=-4097&e.flags|2,rr=!1,ir=e)}}else{if(lr(e))throw Error(r(418));e.flags=-4097&e.flags|2,rr=!1,ir=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ir=e}function hr(e){if(e!==ir)return!1;if(!rr)return dr(e),rr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=or)){if(lr(e))throw pr(),Error(r(418));for(;t;)sr(e,t),t=lo(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){or=lo(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}or=null}}else or=ir?lo(e.stateNode.nextSibling):null;return!0}function pr(){for(var e=or;e;)e=lo(e.nextSibling)}function mr(){or=ir=null,rr=!1}function fr(e){null===ar?ar=[e]:ar.push(e)}var gr=_.ReactCurrentBatchConfig;function vr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var o=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=o.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function yr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function br(e){return(0,e._init)(e._payload)}function _r(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Ll(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=jl(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,i){var r=n.type;return r===S?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===O&&br(r)===t.type)?((i=o(t,n.props)).ref=vr(e,t,n),i.return=e,i):((i=Nl(n.type,n.key,n.props,null,e.mode,i)).ref=vr(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ul(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=Dl(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=jl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Nl(t.type,t.key,t.props,null,e.mode,n)).ref=vr(e,null,t),n.return=e,n;case w:return(t=Ul(t,e.mode,n)).return=e,t;case O:return h(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Dl(t,e.mode,n,null)).return=e,t;yr(e,t)}return null}function p(e,t,n,i){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===o?l(e,t,n,i):null;case w:return n.key===o?u(e,t,n,i):null;case O:return p(e,t,(o=n._init)(n._payload),i)}if(te(n)||D(n))return null!==o?null:d(e,t,n,i,null);yr(e,n)}return null}function m(e,t,n,i,o){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,o);if("object"===typeof i&&null!==i){switch(i.$$typeof){case k:return l(t,e=e.get(null===i.key?n:i.key)||null,i,o);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,o);case O:return m(e,t,n,(0,i._init)(i._payload),o)}if(te(i)||D(i))return d(t,e=e.get(n)||null,i,o,null);yr(t,i)}return null}function f(o,r,s,c){for(var l=null,u=null,d=r,f=r=0,g=null;null!==d&&f<s.length;f++){d.index>f?(g=d,d=null):g=d.sibling;var v=p(o,d,s[f],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(o,d),r=a(v,r,f),null===u?l=v:u.sibling=v,u=v,d=g}if(f===s.length)return n(o,d),rr&&Xo(o,f),l;if(null===d){for(;f<s.length;f++)null!==(d=h(o,s[f],c))&&(r=a(d,r,f),null===u?l=d:u.sibling=d,u=d);return rr&&Xo(o,f),l}for(d=i(o,d);f<s.length;f++)null!==(g=m(d,o,f,s[f],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?f:g.key),r=a(g,r,f),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(o,e)}),rr&&Xo(o,f),l}function g(o,s,c,l){var u=D(c);if("function"!==typeof u)throw Error(r(150));if(null==(c=u.call(c)))throw Error(r(151));for(var d=u=null,f=s,g=s=0,v=null,y=c.next();null!==f&&!y.done;g++,y=c.next()){f.index>g?(v=f,f=null):v=f.sibling;var b=p(o,f,y.value,l);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(o,f),s=a(b,s,g),null===d?u=b:d.sibling=b,d=b,f=v}if(y.done)return n(o,f),rr&&Xo(o,g),u;if(null===f){for(;!y.done;g++,y=c.next())null!==(y=h(o,y.value,l))&&(s=a(y,s,g),null===d?u=y:d.sibling=y,d=y);return rr&&Xo(o,g),u}for(f=i(o,f);!y.done;g++,y=c.next())null!==(y=m(f,o,g,y.value,l))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),s=a(y,s,g),null===d?u=y:d.sibling=y,d=y);return e&&f.forEach(function(e){return t(o,e)}),rr&&Xo(o,g),u}return function e(i,r,a,c){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case k:e:{for(var l=a.key,u=r;null!==u;){if(u.key===l){if((l=a.type)===S){if(7===u.tag){n(i,u.sibling),(r=o(u,a.props.children)).return=i,i=r;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===O&&br(l)===u.type){n(i,u.sibling),(r=o(u,a.props)).ref=vr(i,u,a),r.return=i,i=r;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===S?((r=Dl(a.props.children,i.mode,c,a.key)).return=i,i=r):((c=Nl(a.type,a.key,a.props,null,i.mode,c)).ref=vr(i,r,a),c.return=i,i=c)}return s(i);case w:e:{for(u=a.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(i,r.sibling),(r=o(r,a.children||[])).return=i,i=r;break e}n(i,r);break}t(i,r),r=r.sibling}(r=Ul(a,i.mode,c)).return=i,i=r}return s(i);case O:return e(i,r,(u=a._init)(a._payload),c)}if(te(a))return f(i,r,a,c);if(D(a))return g(i,r,a,c);yr(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==r&&6===r.tag?(n(i,r.sibling),(r=o(r,a)).return=i,i=r):(n(i,r),(r=jl(a,i.mode,c)).return=i,i=r),s(i)):n(i,r)}}var kr=_r(!0),wr=_r(!1),Sr=Co(null),Tr=null,Cr=null,Er=null;function xr(){Er=Cr=Tr=null}function Pr(e){var t=Sr.current;Eo(Sr),e._currentValue=t}function Rr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ir(e,t){Tr=e,Er=Cr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Mr(e){var t=e._currentValue;if(Er!==e)if(e={context:e,memoizedValue:t,next:null},null===Cr){if(null===Tr)throw Error(r(308));Cr=e,Tr.dependencies={lanes:0,firstContext:e}}else Cr=Cr.next=e;return t}var Or=null;function Lr(e){null===Or?Or=[e]:Or.push(e)}function Nr(e,t,n,i){var o=t.interleaved;return null===o?(n.next=n,Lr(t)):(n.next=o.next,o.next=n),t.interleaved=n,Dr(e,i)}function Dr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ar=!1;function jr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ur(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Br(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Pc)){var o=i.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),i.pending=t,Dr(e,n)}return null===(o=i.interleaved)?(t.next=t,Lr(i)):(t.next=o.next,o.next=t),i.interleaved=t,Dr(e,n)}function zr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Vr(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var o=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?o=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?o=r=t:r=r.next=t}else o=r=t;return n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qr(e,t,n,i){var o=e.updateQueue;Ar=!1;var r=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?r=l:a.next=l,a=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==r){var d=o.baseState;for(a=0,u=l=c=null,s=r;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){d=m.call(p,d,h);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,d,h):m)||void 0===h)break e;d=j({},d,h);break e;case 2:Ar=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=o.effects)?o.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=p,c=d):u=u.next=p,a|=h;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(h=s).next,h.next=null,o.lastBaseUpdate=h,o.shared.pending=null}}if(null===u&&(c=d),o.baseState=c,o.firstBaseUpdate=l,o.lastBaseUpdate=u,null!==(t=o.shared.interleaved)){o=t;do{a|=o.lane,o=o.next}while(o!==t)}else null===r&&(o.shared.lanes=0);Ac|=a,e.lanes=a,e.memoizedState=d}}function Wr(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],o=i.callback;if(null!==o){if(i.callback=null,i=n,"function"!==typeof o)throw Error(r(191,o));o.call(i)}}}var Hr={},Zr=Co(Hr),Gr=Co(Hr),Kr=Co(Hr);function Jr(e){if(e===Hr)throw Error(r(174));return e}function Qr(e,t){switch(xo(Kr,t),xo(Gr,e),xo(Zr,Hr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Eo(Zr),xo(Zr,t)}function Yr(){Eo(Zr),Eo(Gr),Eo(Kr)}function $r(e){Jr(Kr.current);var t=Jr(Zr.current),n=ce(t,e.type);t!==n&&(xo(Gr,e),xo(Zr,n))}function Xr(e){Gr.current===e&&(Eo(Zr),Eo(Gr))}var ea=Co(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ia(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var oa=_.ReactCurrentDispatcher,ra=_.ReactCurrentBatchConfig,aa=0,sa=null,ca=null,la=null,ua=!1,da=!1,ha=0,pa=0;function ma(){throw Error(r(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function ga(e,t,n,i,o,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oa.current=null===e||null===e.memoizedState?Xa:es,e=n(i,o),da){a=0;do{if(da=!1,ha=0,25<=a)throw Error(r(301));a+=1,la=ca=null,t.updateQueue=null,oa.current=ts,e=n(i,o)}while(da)}if(oa.current=$a,t=null!==ca&&null!==ca.next,aa=0,la=ca=sa=null,ua=!1,t)throw Error(r(300));return e}function va(){var e=0!==ha;return ha=0,e}function ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?sa.memoizedState=la=e:la=la.next=e,la}function ba(){if(null===ca){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=ca.next;var t=null===la?sa.memoizedState:la.next;if(null!==t)la=t,ca=e;else{if(null===e)throw Error(r(310));e={memoizedState:(ca=e).memoizedState,baseState:ca.baseState,baseQueue:ca.baseQueue,queue:ca.queue,next:null},null===la?sa.memoizedState=la=e:la=la.next=e}return la}function _a(e,t){return"function"===typeof t?t(e):t}function ka(e){var t=ba(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=ca,o=i.baseQueue,a=n.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}i.baseQueue=o=a,n.pending=null}if(null!==o){a=o.next,i=i.baseState;var c=s=null,l=null,u=a;do{var d=u.lane;if((aa&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,s=i):l=l.next=h,sa.lanes|=d,Ac|=d}u=u.next}while(null!==u&&u!==a);null===l?s=i:l.next=c,si(i,t.memoizedState)||(bs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){o=e;do{a=o.lane,sa.lanes|=a,Ac|=a,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wa(e){var t=ba(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);si(a,t.memoizedState)||(bs=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Sa(){}function Ta(e,t){var n=sa,i=ba(),o=t(),a=!si(i.memoizedState,o);if(a&&(i.memoizedState=o,bs=!0),i=i.queue,Aa(xa.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Ma(9,Ea.bind(null,n,i,o,t),void 0,null),null===Rc)throw Error(r(349));0!==(30&aa)||Ca(n,t,o)}return o}function Ca(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ea(e,t,n,i){t.value=n,t.getSnapshot=i,Pa(t)&&Ra(e)}function xa(e,t,n){return n(function(){Pa(t)&&Ra(e)})}function Pa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Ra(e){var t=Dr(e,1);null!==t&&nl(t,e,1,-1)}function Ia(e){var t=ya();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:e},t.queue=e,e=e.dispatch=Ka.bind(null,sa,e),[t.memoizedState,e]}function Ma(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Oa(){return ba().memoizedState}function La(e,t,n,i){var o=ya();sa.flags|=e,o.memoizedState=Ma(1|t,n,void 0,void 0===i?null:i)}function Na(e,t,n,i){var o=ba();i=void 0===i?null:i;var r=void 0;if(null!==ca){var a=ca.memoizedState;if(r=a.destroy,null!==i&&fa(i,a.deps))return void(o.memoizedState=Ma(t,n,r,i))}sa.flags|=e,o.memoizedState=Ma(1|t,n,r,i)}function Da(e,t){return La(8390656,8,e,t)}function Aa(e,t){return Na(2048,8,e,t)}function ja(e,t){return Na(4,2,e,t)}function Ua(e,t){return Na(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Na(4,4,Fa.bind(null,t,e),n)}function za(){}function Va(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function qa(e,t){var n=ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&fa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Wa(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(si(n,t)||(n=ft(),sa.lanes|=n,Ac|=n,e.baseState=!0),t)}function Ha(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=n,ra.transition=i}}function Za(){return ba().memoizedState}function Ga(e,t,n){var i=tl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ja(e))Qa(t,n);else if(null!==(n=Nr(e,t,n,i))){nl(n,e,i,el()),Ya(n,t,i)}}function Ka(e,t,n){var i=tl(e),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ja(e))Qa(t,o);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=r(a,n);if(o.hasEagerState=!0,o.eagerState=s,si(s,a)){var c=t.interleaved;return null===c?(o.next=o,Lr(t)):(o.next=c.next,c.next=o),void(t.interleaved=o)}}catch(l){}null!==(n=Nr(e,t,o,i))&&(nl(n,e,i,o=el()),Ya(n,t,i))}}function Ja(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function Qa(e,t){da=ua=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ya(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var $a={readContext:Mr,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},Xa={readContext:Mr,useCallback:function(e,t){return ya().memoizedState=[e,void 0===t?null:t],e},useContext:Mr,useEffect:Da,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,La(4194308,4,Fa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return La(4194308,4,e,t)},useInsertionEffect:function(e,t){return La(4,2,e,t)},useMemo:function(e,t){var n=ya();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ya();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ga.bind(null,sa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ya().memoizedState=e},useState:Ia,useDebugValue:za,useDeferredValue:function(e){return ya().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=Ha.bind(null,e[1]),ya().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=sa,o=ya();if(rr){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Rc)throw Error(r(349));0!==(30&aa)||Ca(i,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,Da(xa.bind(null,i,a,e),[e]),i.flags|=2048,Ma(9,Ea.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=ya(),t=Rc.identifierPrefix;if(rr){var n=$o;t=":"+t+"R"+(n=(Yo&~(1<<32-at(Yo)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=pa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Mr,useCallback:Va,useContext:Mr,useEffect:Aa,useImperativeHandle:Ba,useInsertionEffect:ja,useLayoutEffect:Ua,useMemo:qa,useReducer:ka,useRef:Oa,useState:function(){return ka(_a)},useDebugValue:za,useDeferredValue:function(e){return Wa(ba(),ca.memoizedState,e)},useTransition:function(){return[ka(_a)[0],ba().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ta,useId:Za,unstable_isNewReconciler:!1},ts={readContext:Mr,useCallback:Va,useContext:Mr,useEffect:Aa,useImperativeHandle:Ba,useInsertionEffect:ja,useLayoutEffect:Ua,useMemo:qa,useReducer:wa,useRef:Oa,useState:function(){return wa(_a)},useDebugValue:za,useDeferredValue:function(e){var t=ba();return null===ca?t.memoizedState=e:Wa(t,ca.memoizedState,e)},useTransition:function(){return[wa(_a)[0],ba().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ta,useId:Za,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function is(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=el(),o=tl(e),r=Fr(i,o);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Br(e,r,o))&&(nl(t,e,o,i),zr(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=el(),o=tl(e),r=Fr(i,o);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Br(e,r,o))&&(nl(t,e,o,i),zr(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),i=tl(e),o=Fr(n,i);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=Br(e,o,i))&&(nl(t,e,i,n),zr(t,e,i))}};function rs(e,t,n,i,o,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(o,r))}function as(e,t,n){var i=!1,o=Po,r=t.contextType;return"object"===typeof r&&null!==r?r=Mr(r):(o=Lo(t)?Mo:Ro.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?Oo(e,o):Po),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=r),t}function ss(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,i){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},jr(e);var r=t.contextType;"object"===typeof r&&null!==r?o.context=Mr(r):(r=Lo(t)?Mo:Ro.current,o.context=Oo(e,r)),o.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(is(e,t,r,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&os.enqueueReplaceState(o,o.state,null),qr(e,n,o,i),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",i=t;do{n+=z(i),i=i.return}while(i);var o=n}catch(r){o="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:o,digest:null}}function us(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var hs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Fr(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Wc||(Wc=!0,Hc=i),ds(0,t)},n}function ms(e,t,n){(n=Fr(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var o=t.value;n.payload=function(){return i(o)},n.callback=function(){ds(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof i&&(null===Zc?Zc=new Set([this]):Zc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new hs;var o=new Set;i.set(t,o)}else void 0===(o=i.get(t))&&(o=new Set,i.set(t,o));o.has(n)||(o.add(n),e=Cl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,i,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fr(-1,1)).tag=2,Br(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var ys=_.ReactCurrentOwner,bs=!1;function _s(e,t,n,i){t.child=null===e?wr(t,null,n,i):kr(t,e.child,n,i)}function ks(e,t,n,i,o){n=n.render;var r=t.ref;return Ir(t,o),i=ga(e,t,n,i,r,o),n=va(),null===e||bs?(rr&&n&&tr(t),t.flags|=1,_s(e,t,i,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ws(e,t,o))}function ws(e,t,n,i,o){if(null===e){var r=n.type;return"function"!==typeof r||Ol(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nl(n.type,null,i,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Ss(e,t,r,i,o))}if(r=e.child,0===(e.lanes&o)){var a=r.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(a,i)&&e.ref===t.ref)return Ws(e,t,o)}return t.flags|=1,(e=Ll(r,i)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,i,o){if(null!==e){var r=e.memoizedProps;if(ci(r,i)&&e.ref===t.ref){if(bs=!1,t.pendingProps=i=r,0===(e.lanes&o))return t.lanes=e.lanes,Ws(e,t,o);0!==(131072&e.flags)&&(bs=!0)}}return Es(e,t,n,i,o)}function Ts(e,t,n){var i=t.pendingProps,o=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xo(Lc,Oc),Oc|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xo(Lc,Oc),Oc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:n,xo(Lc,Oc),Oc|=i}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,xo(Lc,Oc),Oc|=i;return _s(e,t,o,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,i,o){var r=Lo(n)?Mo:Ro.current;return r=Oo(t,r),Ir(t,o),n=ga(e,t,n,i,r,o),i=va(),null===e||bs?(rr&&i&&tr(t),t.flags|=1,_s(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ws(e,t,o))}function xs(e,t,n,i,o){if(Lo(n)){var r=!0;jo(t)}else r=!1;if(Ir(t,o),null===t.stateNode)qs(e,t),as(t,n,i),cs(t,n,i,o),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=Mr(l):l=Oo(t,l=Lo(n)?Mo:Ro.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||c!==l)&&ss(t,a,i,l),Ar=!1;var h=t.memoizedState;a.state=h,qr(t,i,a,o),c=t.memoizedState,s!==i||h!==c||Io.current||Ar?("function"===typeof u&&(is(t,n,u,i),c=t.memoizedState),(s=Ar||rs(t,n,s,i,h,c,l))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Ur(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),a.props=l,d=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=Mr(c):c=Oo(t,c=Lo(n)?Mo:Ro.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||h!==c)&&ss(t,a,i,c),Ar=!1,h=t.memoizedState,a.state=h,qr(t,i,a,o);var m=t.memoizedState;s!==d||h!==m||Io.current||Ar?("function"===typeof p&&(is(t,n,p,i),m=t.memoizedState),(l=Ar||rs(t,n,l,i,h,m,c)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,m,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,m,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),a.props=i,a.state=m,a.context=c,i=l):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Ps(e,t,n,i,r,o)}function Ps(e,t,n,i,o,r){Cs(e,t);var a=0!==(128&t.flags);if(!i&&!a)return o&&Uo(t,n,!1),Ws(e,t,r);i=t.stateNode,ys.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=kr(t,e.child,null,r),t.child=kr(t,null,s,r)):_s(e,t,s,r),t.memoizedState=i.state,o&&Uo(t,n,!0),t.child}function Rs(e){var t=e.stateNode;t.pendingContext?Do(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Do(0,t.context,!1),Qr(e,t.containerInfo)}function Is(e,t,n,i,o){return mr(),fr(o),t.flags|=256,_s(e,t,n,i),t.child}var Ms,Os,Ls,Ns,Ds={dehydrated:null,treeContext:null,retryLane:0};function As(e){return{baseLanes:e,cachePool:null,transitions:null}}function js(e,t,n){var i,o=t.pendingProps,a=ea.current,s=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),xo(ea,1&a),null===e)return ur(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=o.children,e=o.fallback,s?(o=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Al(c,o,0,null),e=Dl(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=As(n),t.memoizedState=Ds,e):Us(t,c));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,o,a,s){if(n)return 256&t.flags?(t.flags&=-257,Fs(e,t,s,i=us(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,o=t.mode,i=Al({mode:"visible",children:i.children},o,0,null),(a=Dl(a,o,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&kr(t,e.child,null,s),t.child.memoizedState=As(s),t.memoizedState=Ds,a);if(0===(1&t.mode))return Fs(e,t,s,null);if("$!"===o.data){if(i=o.nextSibling&&o.nextSibling.dataset)var c=i.dgst;return i=c,Fs(e,t,s,i=us(a=Error(r(419)),i,void 0))}if(c=0!==(s&e.childLanes),bs||c){if(null!==(i=Rc)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(i.suspendedLanes|s))?0:o)&&o!==a.retryLane&&(a.retryLane=o,Dr(e,o),nl(i,e,o,-1))}return fl(),Fs(e,t,s,i=us(Error(r(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=xl.bind(null,e),o._reactRetry=t,null):(e=a.treeContext,or=lo(o.nextSibling),ir=t,rr=!0,ar=null,null!==e&&(Ko[Jo++]=Yo,Ko[Jo++]=$o,Ko[Jo++]=Qo,Yo=e.id,$o=e.overflow,Qo=t),t=Us(t,i.children),t.flags|=4096,t)}(e,t,c,o,i,a,n);if(s){s=o.fallback,c=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:o.children};return 0===(1&c)&&t.child!==a?((o=t.child).childLanes=0,o.pendingProps=l,t.deletions=null):(o=Ll(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==i?s=Ll(i,s):(s=Dl(s,c,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,c=null===(c=e.child.memoizedState)?As(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=Ds,o}return e=(s=e.child).sibling,o=Ll(s,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Us(e,t){return(t=Al({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fs(e,t,n,i){return null!==i&&fr(i),kr(t,e.child,null,n),(e=Us(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Rr(e.return,t,n)}function zs(e,t,n,i,o){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=o)}function Vs(e,t,n){var i=t.pendingProps,o=i.revealOrder,r=i.tail;if(_s(e,t,i.children,n),0!==(2&(i=ea.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(xo(ea,i),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),zs(t,!1,o,n,r);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ta(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}zs(t,!0,n,null,r);break;case"together":zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ws(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ac|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Ll(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ll(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!rr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Zs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,i|=14680064&o.subtreeFlags,i|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Gs(e,t,n){var i=t.pendingProps;switch(nr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zs(t),null;case 1:case 17:return Lo(t.type)&&No(),Zs(t),null;case 3:return i=t.stateNode,Yr(),Eo(Io),Eo(Ro),ia(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(hr(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ar&&(al(ar),ar=null))),Os(e,t),Zs(t),null;case 5:Xr(t);var o=Jr(Kr.current);if(n=t.type,null!==e&&null!=t.stateNode)Ls(e,t,n,i,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Zs(t),null}if(e=Jr(Zr.current),hr(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[po]=t,i[mo]=a,e=0!==(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(o=0;o<Di.length;o++)Fi(Di[o],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":Q(i,a),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Fi("invalid",i);break;case"textarea":oe(i,a),Fi("invalid",i)}for(var c in ye(n,a),o=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==a.suppressHydrationWarning&&$i(i.textContent,l,e),o=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&$i(i.textContent,l,e),o=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Fi("scroll",i)}switch(n){case"input":Z(i),X(i,a,!0);break;case"textarea":Z(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=Xi)}i=o,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[po]=t,e[mo]=i,Ms(e,t,!1,!1),t.stateNode=e;e:{switch(c=be(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),o=i;break;case"iframe":case"object":case"embed":Fi("load",e),o=i;break;case"video":case"audio":for(o=0;o<Di.length;o++)Fi(Di[o],e);o=i;break;case"source":Fi("error",e),o=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),o=i;break;case"details":Fi("toggle",e),o=i;break;case"input":Q(e,i),o=J(e,i),Fi("invalid",e);break;case"option":default:o=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},o=j({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":oe(e,i),o=ie(e,i),Fi("invalid",e)}for(a in ye(n,o),l=o)if(l.hasOwnProperty(a)){var u=l[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Fi("scroll",e):null!=u&&b(e,a,u,c))}switch(n){case"input":Z(e),X(e,i,!1);break;case"textarea":Z(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+W(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Xi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Zs(t),null;case 6:if(e&&null!=t.stateNode)Ns(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(r(166));if(n=Jr(Kr.current),Jr(Zr.current),hr(t)){if(i=t.stateNode,n=t.memoizedProps,i[po]=t,(a=i.nodeValue!==n)&&null!==(e=ir))switch(e.tag){case 3:$i(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&$i(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[po]=t,t.stateNode=i}return Zs(t),null;case 13:if(Eo(ea),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rr&&null!==or&&0!==(1&t.mode)&&0===(128&t.flags))pr(),mr(),t.flags|=98560,a=!1;else if(a=hr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[po]=t}else mr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Zs(t),a=!1}else null!==ar&&(al(ar),ar=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Nc&&(Nc=3):fl())),null!==t.updateQueue&&(t.flags|=4),Zs(t),null);case 4:return Yr(),Os(e,t),null===e&&Vi(t.stateNode.containerInfo),Zs(t),null;case 10:return Pr(t.type._context),Zs(t),null;case 19:if(Eo(ea),null===(a=t.memoizedState))return Zs(t),null;if(i=0!==(128&t.flags),null===(c=a.rendering))if(i)Hs(a,!1);else{if(0!==Nc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ta(e))){for(t.flags|=128,Hs(a,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return xo(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>Vc&&(t.flags|=128,i=!0,Hs(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ta(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!rr)return Zs(t),null}else 2*Ye()-a.renderingStartTime>Vc&&1073741824!==n&&(t.flags|=128,i=!0,Hs(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=ea.current,xo(ea,i?1&n|2:1&n),t):(Zs(t),null);case 22:case 23:return dl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Oc)&&(Zs(t),6&t.subtreeFlags&&(t.flags|=8192)):Zs(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Ks(e,t){switch(nr(t),t.tag){case 1:return Lo(t.type)&&No(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yr(),Eo(Io),Eo(Ro),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xr(t),null;case 13:if(Eo(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));mr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Eo(ea),null;case 4:return Yr(),null;case 10:return Pr(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}Ms=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Os=function(){},Ls=function(e,t,n,i){var o=e.memoizedProps;if(o!==i){e=t.stateNode,Jr(Zr.current);var r,a=null;switch(n){case"input":o=J(e,o),i=J(e,i),a=[];break;case"select":o=j({},o,{value:void 0}),i=j({},i,{value:void 0}),a=[];break;case"textarea":o=ie(e,o),i=ie(e,i),a=[];break;default:"function"!==typeof o.onClick&&"function"===typeof i.onClick&&(e.onclick=Xi)}for(u in ye(n,i),n=null,o)if(!i.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var c=o[u];for(r in c)c.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var l=i[u];if(c=null!=o?o[u]:void 0,i.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(r in c)!c.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in l)l.hasOwnProperty(r)&&c[r]!==l[r]&&(n||(n={}),n[r]=l[r])}else n||(a||(a=[]),a.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Fi("scroll",e),a||c===l||(a=[])):(a=a||[]).push(u,l))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Ns=function(e,t,n,i){n!==i&&(t.flags|=4)};var Js=!1,Qs=!1,Ys="function"===typeof WeakSet?WeakSet:Set,$s=null;function Xs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Tl(e,t,i)}else n.current=null}function ec(e,t,n){try{n()}catch(i){Tl(e,t,i)}}var tc=!1;function nc(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var o=i=i.next;do{if((o.tag&e)===e){var r=o.destroy;o.destroy=void 0,void 0!==r&&ec(t,n,r)}o=o.next}while(o!==i)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function oc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function rc(e){var t=e.alternate;null!==t&&(e.alternate=null,rc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[po],delete t[mo],delete t[go],delete t[vo],delete t[yo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Xi));else if(4!==i&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var uc=null,dc=!1;function hc(e,t,n){for(n=n.child;null!==n;)pc(e,t,n),n=n.sibling}function pc(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:Qs||Xs(n,t);case 6:var i=uc,o=dc;uc=null,hc(e,t,n),dc=o,null!==(uc=i)&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?co(e.parentNode,n):1===e.nodeType&&co(e,n),Vt(e)):co(uc,n.stateNode));break;case 4:i=uc,o=dc,uc=n.stateNode.containerInfo,dc=!0,hc(e,t,n),uc=i,dc=o;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){o=i=i.next;do{var r=o,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&ec(n,t,a),o=o.next}while(o!==i)}hc(e,t,n);break;case 1:if(!Qs&&(Xs(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Tl(n,t,s)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Qs=(i=Qs)||null!==n.memoizedState,hc(e,t,n),Qs=i):hc(e,t,n);break;default:hc(e,t,n)}}function mc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach(function(t){var i=Pl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function fc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var o=n[i];try{var a=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,dc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===uc)throw Error(r(160));pc(a,s,o),uc=null,dc=!1;var l=o.alternate;null!==l&&(l.return=null),o.return=null}catch(u){Tl(o,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fc(t,e),vc(e),4&i){try{nc(3,e,e.return),ic(3,e)}catch(g){Tl(e,e.return,g)}try{nc(5,e,e.return)}catch(g){Tl(e,e.return,g)}}break;case 1:fc(t,e),vc(e),512&i&&null!==n&&Xs(n,n.return);break;case 5:if(fc(t,e),vc(e),512&i&&null!==n&&Xs(n,n.return),32&e.flags){var o=e.stateNode;try{he(o,"")}catch(g){Tl(e,e.return,g)}}if(4&i&&null!=(o=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Y(o,a),be(c,s);var u=be(c,a);for(s=0;s<l.length;s+=2){var d=l[s],h=l[s+1];"style"===d?ge(o,h):"dangerouslySetInnerHTML"===d?de(o,h):"children"===d?he(o,h):b(o,d,h,u)}switch(c){case"input":$(o,a);break;case"textarea":re(o,a);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ne(o,!!a.multiple,m,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(o,!!a.multiple,a.defaultValue,!0):ne(o,!!a.multiple,a.multiple?[]:"",!1))}o[mo]=a}catch(g){Tl(e,e.return,g)}}break;case 6:if(fc(t,e),vc(e),4&i){if(null===e.stateNode)throw Error(r(162));o=e.stateNode,a=e.memoizedProps;try{o.nodeValue=a}catch(g){Tl(e,e.return,g)}}break;case 3:if(fc(t,e),vc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Tl(e,e.return,g)}break;case 4:default:fc(t,e),vc(e);break;case 13:fc(t,e),vc(e),8192&(o=e.child).flags&&(a=null!==o.memoizedState,o.stateNode.isHidden=a,!a||null!==o.alternate&&null!==o.alternate.memoizedState||(zc=Ye())),4&i&&mc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(u=Qs)||d,fc(t,e),Qs=u):fc(t,e),vc(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for($s=e,d=e.child;null!==d;){for(h=$s=d;null!==$s;){switch(m=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:nc(4,p,p.return);break;case 1:Xs(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){i=p,n=p.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Tl(i,n,g)}}break;case 5:Xs(p,p.return);break;case 22:if(null!==p.memoizedState){kc(h);continue}}null!==m?(m.return=p,$s=m):kc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{o=h.stateNode,u?"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",s))}catch(g){Tl(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Tl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fc(t,e),vc(e),4&i&&mc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var o=i.stateNode;32&i.flags&&(he(o,""),i.flags&=-33),lc(e,sc(e),o);break;case 3:case 4:var a=i.stateNode.containerInfo;cc(e,sc(e),a);break;default:throw Error(r(161))}}catch(s){Tl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yc(e,t,n){$s=e,bc(e,t,n)}function bc(e,t,n){for(var i=0!==(1&e.mode);null!==$s;){var o=$s,r=o.child;if(22===o.tag&&i){var a=null!==o.memoizedState||Js;if(!a){var s=o.alternate,c=null!==s&&null!==s.memoizedState||Qs;s=Js;var l=Qs;if(Js=a,(Qs=c)&&!l)for($s=o;null!==$s;)c=(a=$s).child,22===a.tag&&null!==a.memoizedState?wc(o):null!==c?(c.return=a,$s=c):wc(o);for(;null!==r;)$s=r,bc(r,t,n),r=r.sibling;$s=o,Js=s,Qs=l}_c(e)}else 0!==(8772&o.subtreeFlags)&&null!==r?(r.return=o,$s=r):_c(e)}}function _c(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||ic(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Qs)if(null===n)i.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Wr(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wr(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(r(163))}Qs||512&t.flags&&oc(t)}catch(p){Tl(t,t.return,p)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function kc(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function wc(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){Tl(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var o=t.return;try{i.componentDidMount()}catch(c){Tl(t,o,c)}}var r=t.return;try{oc(t)}catch(c){Tl(t,r,c)}break;case 5:var a=t.return;try{oc(t)}catch(c){Tl(t,a,c)}}}catch(c){Tl(t,t.return,c)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Sc,Tc=Math.ceil,Cc=_.ReactCurrentDispatcher,Ec=_.ReactCurrentOwner,xc=_.ReactCurrentBatchConfig,Pc=0,Rc=null,Ic=null,Mc=0,Oc=0,Lc=Co(0),Nc=0,Dc=null,Ac=0,jc=0,Uc=0,Fc=null,Bc=null,zc=0,Vc=1/0,qc=null,Wc=!1,Hc=null,Zc=null,Gc=!1,Kc=null,Jc=0,Qc=0,Yc=null,$c=-1,Xc=0;function el(){return 0!==(6&Pc)?Ye():-1!==$c?$c:$c=Ye()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Pc)&&0!==Mc?Mc&-Mc:null!==gr.transition?(0===Xc&&(Xc=ft()),Xc):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nl(e,t,n,i){if(50<Qc)throw Qc=0,Yc=null,Error(r(185));vt(e,n,i),0!==(2&Pc)&&e===Rc||(e===Rc&&(0===(2&Pc)&&(jc|=n),4===Nc&&sl(e,Mc)),il(e,i),1===n&&0===Pc&&0===(1&t.mode)&&(Vc=Ye()+500,Bo&&qo()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,r=e.pendingLanes;0<r;){var a=31-at(r),s=1<<a,c=o[a];-1===c?0!==(s&n)&&0===(s&i)||(o[a]=pt(s,t)):c<=t&&(e.expiredLanes|=s),r&=~s}}(e,t);var i=ht(e,e===Rc?Mc:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Bo=!0,Vo(e)}(cl.bind(null,e)):Vo(cl.bind(null,e)),ao(function(){0===(6&Pc)&&qo()}),n=null;else{switch(_t(i)){case 1:n=Xe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Rl(n,ol.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ol(e,t){if($c=-1,Xc=0,0!==(6&Pc))throw Error(r(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var i=ht(e,e===Rc?Mc:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gl(e,i);else{t=i;var o=Pc;Pc|=2;var a=ml();for(Rc===e&&Mc===t||(qc=null,Vc=Ye()+500,hl(e,t));;)try{yl();break}catch(c){pl(e,c)}xr(),Cc.current=a,Pc=o,null!==Ic?t=0:(Rc=null,Mc=0,t=Nc)}if(0!==t){if(2===t&&(0!==(o=mt(e))&&(i=o,t=rl(e,o))),1===t)throw n=Dc,hl(e,0),sl(e,i),il(e,Ye()),n;if(6===t)sl(e,i);else{if(o=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var o=n[i],r=o.getSnapshot;o=o.value;try{if(!si(r(),o))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=gl(e,i))&&(0!==(a=mt(e))&&(i=a,t=rl(e,a))),1===t))throw n=Dc,hl(e,0),sl(e,i),il(e,Ye()),n;switch(e.finishedWork=o,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:case 5:kl(e,Bc,qc);break;case 3:if(sl(e,i),(130023424&i)===i&&10<(t=zc+500-Ye())){if(0!==ht(e,0))break;if(((o=e.suspendedLanes)&i)!==i){el(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=io(kl.bind(null,e,Bc,qc),t);break}kl(e,Bc,qc);break;case 4:if(sl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,o=-1;0<i;){var s=31-at(i);a=1<<s,(s=t[s])>o&&(o=s),i&=~a}if(i=o,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Tc(i/1960))-i)){e.timeoutHandle=io(kl.bind(null,e,Bc,qc),i);break}kl(e,Bc,qc);break;default:throw Error(r(329))}}}return il(e,Ye()),e.callbackNode===n?ol.bind(null,e):null}function rl(e,t){var n=Fc;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Bc,Bc=n,null!==t&&al(t)),e}function al(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function sl(e,t){for(t&=~Uc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cl(e){if(0!==(6&Pc))throw Error(r(327));wl();var t=ht(e,0);if(0===(1&t))return il(e,Ye()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=rl(e,i))}if(1===n)throw n=Dc,hl(e,0),sl(e,t),il(e,Ye()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kl(e,Bc,qc),il(e,Ye()),null}function ll(e,t){var n=Pc;Pc|=1;try{return e(t)}finally{0===(Pc=n)&&(Vc=Ye()+500,Bo&&qo())}}function ul(e){null!==Kc&&0===Kc.tag&&0===(6&Pc)&&wl();var t=Pc;Pc|=1;var n=xc.transition,i=bt;try{if(xc.transition=null,bt=1,e)return e()}finally{bt=i,xc.transition=n,0===(6&(Pc=t))&&qo()}}function dl(){Oc=Lc.current,Eo(Lc)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Ic)for(n=Ic.return;null!==n;){var i=n;switch(nr(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&No();break;case 3:Yr(),Eo(Io),Eo(Ro),ia();break;case 5:Xr(i);break;case 4:Yr();break;case 13:case 19:Eo(ea);break;case 10:Pr(i.type._context);break;case 22:case 23:dl()}n=n.return}if(Rc=e,Ic=e=Ll(e.current,null),Mc=Oc=t,Nc=0,Dc=null,Uc=jc=Ac=0,Bc=Fc=null,null!==Or){for(t=0;t<Or.length;t++)if(null!==(i=(n=Or[t]).interleaved)){n.interleaved=null;var o=i.next,r=n.pending;if(null!==r){var a=r.next;r.next=o,i.next=a}n.pending=i}Or=null}return e}function pl(e,t){for(;;){var n=Ic;try{if(xr(),oa.current=$a,ua){for(var i=sa.memoizedState;null!==i;){var o=i.queue;null!==o&&(o.pending=null),i=i.next}ua=!1}if(aa=0,la=ca=sa=null,da=!1,ha=0,Ec.current=null,null===n||null===n.return){Nc=1,Dc=t,Ic=null;break}e:{var a=e,s=n.return,c=n,l=t;if(t=Mc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=gs(s);if(null!==m){m.flags&=-257,vs(m,s,c,0,t),1&m.mode&&fs(a,u,t),l=u;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}if(0===(1&t)){fs(a,u,t),fl();break e}l=Error(r(426))}else if(rr&&1&c.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,c,0,t),fr(ls(l,c));break e}}a=l=ls(l,c),4!==Nc&&(Nc=2),null===Fc?Fc=[a]:Fc.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vr(a,ps(0,l,t));break e;case 1:c=l;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Zc||!Zc.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Vr(a,ms(a,c,t));break e}}a=a.return}while(null!==a)}_l(n)}catch(_){t=_,Ic===n&&null!==n&&(Ic=n=n.return);continue}break}}function ml(){var e=Cc.current;return Cc.current=$a,null===e?$a:e}function fl(){0!==Nc&&3!==Nc&&2!==Nc||(Nc=4),null===Rc||0===(268435455&Ac)&&0===(268435455&jc)||sl(Rc,Mc)}function gl(e,t){var n=Pc;Pc|=2;var i=ml();for(Rc===e&&Mc===t||(qc=null,hl(e,t));;)try{vl();break}catch(o){pl(e,o)}if(xr(),Pc=n,Cc.current=i,null!==Ic)throw Error(r(261));return Rc=null,Mc=0,Nc}function vl(){for(;null!==Ic;)bl(Ic)}function yl(){for(;null!==Ic&&!Je();)bl(Ic)}function bl(e){var t=Sc(e.alternate,e,Oc);e.memoizedProps=e.pendingProps,null===t?_l(e):Ic=t,Ec.current=null}function _l(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Gs(n,t,Oc)))return void(Ic=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Ic=n);if(null===e)return Nc=6,void(Ic=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ic=t);Ic=t=e}while(null!==t);0===Nc&&(Nc=5)}function kl(e,t,n){var i=bt,o=xc.transition;try{xc.transition=null,bt=1,function(e,t,n,i){do{wl()}while(null!==Kc);if(0!==(6&Pc))throw Error(r(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-at(n),r=1<<o;t[o]=0,i[o]=-1,e[o]=-1,n&=~r}}(e,a),e===Rc&&(Ic=Rc=null,Mc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gc||(Gc=!0,Rl(tt,function(){return wl(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=xc.transition,xc.transition=null;var s=bt;bt=1;var c=Pc;Pc|=4,Ec.current=null,function(e,t){if(eo=Wt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var o=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(k){n=null;break e}var s=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==o&&3!==h.nodeType||(c=s+o),h!==a||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++u===o&&(c=s),p===a&&++d===i&&(l=s),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Wt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,v=f.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(r(163))}}catch(k){Tl(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}f=tc,tc=!1}(e,n),gc(n,e),mi(to),Wt=!!eo,to=eo=null,e.current=n,yc(n,e,o),Qe(),Pc=c,bt=s,xc.transition=a}else e.current=n;if(Gc&&(Gc=!1,Kc=e,Jc=o),a=e.pendingLanes,0===a&&(Zc=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(Wc)throw Wc=!1,e=Hc,Hc=null,e;0!==(1&Jc)&&0!==e.tag&&wl(),a=e.pendingLanes,0!==(1&a)?e===Yc?Qc++:(Qc=0,Yc=e):Qc=0,qo()}(e,t,n,i)}finally{xc.transition=o,bt=i}return null}function wl(){if(null!==Kc){var e=_t(Jc),t=xc.transition,n=bt;try{if(xc.transition=null,bt=16>e?16:e,null===Kc)var i=!1;else{if(e=Kc,Kc=null,Jc=0,0!==(6&Pc))throw Error(r(331));var o=Pc;for(Pc|=4,$s=e.current;null!==$s;){var a=$s,s=a.child;if(0!==(16&$s.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for($s=u;null!==$s;){var d=$s;switch(d.tag){case 0:case 11:case 15:nc(8,d,a)}var h=d.child;if(null!==h)h.return=d,$s=h;else for(;null!==$s;){var p=(d=$s).sibling,m=d.return;if(rc(d),d===u){$s=null;break}if(null!==p){p.return=m,$s=p;break}$s=m}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}$s=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,$s=s;else e:for(;null!==$s;){if(0!==(2048&(a=$s).flags))switch(a.tag){case 0:case 11:case 15:nc(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$s=y;break e}$s=a.return}}var b=e.current;for($s=b;null!==$s;){var _=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==_)_.return=s,$s=_;else e:for(s=b;null!==$s;){if(0!==(2048&(c=$s).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(w){Tl(c,c.return,w)}if(c===s){$s=null;break e}var k=c.sibling;if(null!==k){k.return=c.return,$s=k;break e}$s=c.return}}if(Pc=o,qo(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(ot,e)}catch(w){}i=!0}return i}finally{bt=n,xc.transition=t}}return!1}function Sl(e,t,n){e=Br(e,t=ps(0,t=ls(n,t),1),1),t=el(),null!==e&&(vt(e,1,t),il(e,t))}function Tl(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Zc||!Zc.has(i))){t=Br(t,e=ms(t,e=ls(n,e),1),1),e=el(),null!==t&&(vt(t,1,e),il(t,e));break}}t=t.return}}function Cl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Rc===e&&(Mc&n)===n&&(4===Nc||3===Nc&&(130023424&Mc)===Mc&&500>Ye()-zc?hl(e,0):Uc|=n),il(e,t)}function El(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=Dr(e,t))&&(vt(e,t,n),il(e,n))}function xl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),El(e,n)}function Pl(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(t),El(e,n)}function Rl(e,t){return Ge(e,t)}function Il(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ml(e,t,n,i){return new Il(e,t,n,i)}function Ol(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ll(e,t){var n=e.alternate;return null===n?((n=Ml(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nl(e,t,n,i,o,a){var s=2;if(i=e,"function"===typeof e)Ol(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Dl(n.children,o,a,t);case T:s=8,o|=8;break;case C:return(e=Ml(12,n,t,2|o)).elementType=C,e.lanes=a,e;case R:return(e=Ml(13,n,t,o)).elementType=R,e.lanes=a,e;case I:return(e=Ml(19,n,t,o)).elementType=I,e.lanes=a,e;case L:return Al(n,o,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case x:s=9;break e;case P:s=11;break e;case M:s=14;break e;case O:s=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Ml(s,n,t,o)).elementType=e,t.type=i,t.lanes=a,t}function Dl(e,t,n,i){return(e=Ml(7,e,i,t)).lanes=n,e}function Al(e,t,n,i){return(e=Ml(22,e,i,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function jl(e,t,n){return(e=Ml(6,e,null,t)).lanes=n,e}function Ul(e,t,n){return(t=Ml(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fl(e,t,n,i,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Bl(e,t,n,i,o,r,a,s,c){return e=new Fl(e,t,n,s,c),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Ml(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jr(r),e}function zl(e){if(!e)return Po;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Lo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(Lo(n))return Ao(e,n,t)}return t}function Vl(e,t,n,i,o,r,a,s,c){return(e=Bl(n,i,!0,e,0,r,0,s,c)).context=zl(null),n=e.current,(r=Fr(i=el(),o=tl(n))).callback=void 0!==t&&null!==t?t:null,Br(n,r,o),e.current.lanes=o,vt(e,o,i),il(e,i),e}function ql(e,t,n,i){var o=t.current,r=el(),a=tl(o);return n=zl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fr(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Br(o,t,a))&&(nl(e,o,a,r),zr(e,o,a)),a}function Wl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Zl(e,t){Hl(e,t),(e=e.alternate)&&Hl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Io.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Rs(t),mr();break;case 5:$r(t);break;case 1:Lo(t.type)&&jo(t);break;case 4:Qr(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,o=t.memoizedProps.value;xo(Sr,i._currentValue),i._currentValue=o;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(xo(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?js(e,t,n):(xo(ea,1&ea.current),null!==(e=Ws(e,t,n))?e.sibling:null);xo(ea,1&ea.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Vs(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),xo(ea,ea.current),i)break;return null;case 22:case 23:return t.lanes=0,Ts(e,t,n)}return Ws(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,rr&&0!==(1048576&t.flags)&&er(t,Go,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;qs(e,t),e=t.pendingProps;var o=Oo(t,Ro.current);Ir(t,n),o=ga(null,t,i,e,o,n);var a=va();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Lo(i)?(a=!0,jo(t)):a=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,jr(t),o.updater=os,t.stateNode=o,o._reactInternals=t,cs(t,i,e,n),t=Ps(null,t,i,!0,a,n)):(t.tag=0,rr&&a&&tr(t),_s(null,t,o,n),t=t.child),t;case 16:i=t.elementType;e:{switch(qs(e,t),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return Ol(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===P)return 11;if(e===M)return 14}return 2}(i),e=ns(i,e),o){case 0:t=Es(null,t,i,e,n);break e;case 1:t=xs(null,t,i,e,n);break e;case 11:t=ks(null,t,i,e,n);break e;case 14:t=ws(null,t,i,ns(i.type,e),n);break e}throw Error(r(306,i,""))}return t;case 0:return i=t.type,o=t.pendingProps,Es(e,t,i,o=t.elementType===i?o:ns(i,o),n);case 1:return i=t.type,o=t.pendingProps,xs(e,t,i,o=t.elementType===i?o:ns(i,o),n);case 3:e:{if(Rs(t),null===e)throw Error(r(387));i=t.pendingProps,o=(a=t.memoizedState).element,Ur(e,t),qr(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Is(e,t,i,n,o=ls(Error(r(423)),t));break e}if(i!==o){t=Is(e,t,i,n,o=ls(Error(r(424)),t));break e}for(or=lo(t.stateNode.containerInfo.firstChild),ir=t,rr=!0,ar=null,n=wr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(mr(),i===o){t=Ws(e,t,n);break e}_s(e,t,i,n)}t=t.child}return t;case 5:return $r(t),null===e&&ur(t),i=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,s=o.children,no(i,o)?s=null:null!==a&&no(i,a)&&(t.flags|=32),Cs(e,t),_s(e,t,s,n),t.child;case 6:return null===e&&ur(t),null;case 13:return js(e,t,n);case 4:return Qr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=kr(t,null,i,n):_s(e,t,i,n),t.child;case 11:return i=t.type,o=t.pendingProps,ks(e,t,i,o=t.elementType===i?o:ns(i,o),n);case 7:return _s(e,t,t.pendingProps,n),t.child;case 8:case 12:return _s(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,o=t.pendingProps,a=t.memoizedProps,s=o.value,xo(Sr,i._currentValue),i._currentValue=s,null!==a)if(si(a.value,s)){if(a.children===o.children&&!Io.current){t=Ws(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){s=a.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=Fr(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Rr(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(r(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Rr(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}_s(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,i=t.pendingProps.children,Ir(t,n),i=i(o=Mr(o)),t.flags|=1,_s(e,t,i,n),t.child;case 14:return o=ns(i=t.type,t.pendingProps),ws(e,t,i,o=ns(i.type,o),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:ns(i,o),qs(e,t),t.tag=1,Lo(i)?(e=!0,jo(t)):e=!1,Ir(t,n),as(t,i,o),cs(t,i,o,n),Ps(null,t,i,!0,e,n);case 19:return Vs(e,t,n);case 22:return Ts(e,t,n)}throw Error(r(156,t.tag))};var Gl="function"===typeof reportError?reportError:function(e){console.error(e)};function Kl(e){this._internalRoot=e}function Jl(e){this._internalRoot=e}function Ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function Xl(e,t,n,i,o){var r=n._reactRootContainer;if(r){var a=r;if("function"===typeof o){var s=o;o=function(){var e=Wl(a);s.call(e)}}ql(t,a,e,o)}else a=function(e,t,n,i,o){if(o){if("function"===typeof i){var r=i;i=function(){var e=Wl(a);r.call(e)}}var a=Vl(t,i,e,0,null,!1,0,"",$l);return e._reactRootContainer=a,e[fo]=a.current,Vi(8===e.nodeType?e.parentNode:e),ul(),a}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof i){var s=i;i=function(){var e=Wl(c);s.call(e)}}var c=Bl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[fo]=c.current,Vi(8===e.nodeType?e.parentNode:e),ul(function(){ql(t,c,n,i)}),c}(n,t,e,o,i);return Wl(a)}Jl.prototype.render=Kl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));ql(e,t,null,null)},Jl.prototype.unmount=Kl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){ql(null,e,null,null)}),t[fo]=null}},Jl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&jt(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),il(t,Ye()),0===(6&Pc)&&(Vc=Ye()+500,qo()))}break;case 13:ul(function(){var t=Dr(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),Zl(e,1)}},wt=function(e){if(13===e.tag){var t=Dr(e,134217728);if(null!==t)nl(t,e,134217728,el());Zl(e,134217728)}},St=function(e){if(13===e.tag){var t=tl(e),n=Dr(e,t);if(null!==n)nl(n,e,t,el());Zl(e,t)}},Tt=function(){return bt},Ct=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if($(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var o=wo(i);if(!o)throw Error(r(90));G(i),$(i,o)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Pe=ll,Re=ul;var eu={usingClientEntryPoint:!1,Events:[_o,ko,wo,Ee,xe,ll]},tu={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{ot=iu.inject(nu),rt=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ql(t))throw Error(r(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Ql(e))throw Error(r(299));var n=!1,i="",o=Gl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Bl(e,1,!1,null,0,n,0,i,o),e[fo]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Kl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Yl(t))throw Error(r(200));return Xl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Ql(e))throw Error(r(405));var i=null!=n&&n.hydratedSources||null,o=!1,a="",s=Gl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vl(t,null,e,1,null!=n?n:null,o,0,a,s),e[fo]=t.current,Vi(e),i)for(e=0;e<i.length;e++)o=(o=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Jl(t)},t.render=function(e,t,n){if(!Yl(t))throw Error(r(200));return Xl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yl(e))throw Error(r(40));return!!e._reactRootContainer&&(ul(function(){Xl(null,null,e,!1,function(){e._reactRootContainer=null,e[fo]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Yl(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return Xl(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{"use strict";e.exports=n(234)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,o){if(1&o&&(i=this(i)),8&o)return i;if("object"===typeof i&&i){if(4&o&&i.__esModule)return i;if(16&o&&"function"===typeof i.then)return i}var r=Object.create(null);n.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&i;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>a[e]=()=>i[e]);return a.default=()=>i,n.d(r,a),r}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,i)=>(n.f[i](e,t),t),[])),n.u=e=>"static/js/"+e+".6a44d712.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="SafeCircle:";n.l=(i,o,r,a)=>{if(e[i])e[i].push(o);else{var s,c;if(void 0!==r)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+r){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+r),s.src=i),e[i]=[o];var h=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var o=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach(e=>e(n)),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,i)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)i.push(o[2]);else{var r=new Promise((n,i)=>o=e[t]=[n,i]);i.push(o[2]=r);var a=n.p+n.u(t),s=new Error;n.l(a,i=>{if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,o[1](s)}},"chunk-"+t,t)}};var t=(t,i)=>{var o,r,[a,s,c]=i,l=0;if(a.some(t=>0!==e[t])){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(c)c(n)}for(t&&t(i);l<a.length;l++)r=a[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0},i=self.webpackChunkSafeCircle=self.webpackChunkSafeCircle||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e,t=n(43),i=n.t(t,2),o=n(391);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const a="popstate";function s(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(Ut){}}}function l(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,n,i){return void 0===n&&(n=null),r({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?h(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function h(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function p(t,n,i,o){void 0===o&&(o={});let{window:c=document.defaultView,v5Compat:h=!1}=o,p=c.history,m=e.Pop,f=null,g=v();function v(){return(p.state||{idx:null}).idx}function y(){m=e.Pop;let t=v(),n=null==t?null:t-g;g=t,f&&f({action:m,location:_.location,delta:n})}function b(e){let t="null"!==c.location.origin?c.location.origin:c.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),s(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,p.replaceState(r({},p.state,{idx:g}),""));let _={get action(){return m},get location(){return t(c,p)},listen(e){if(f)throw new Error("A history only accepts one active listener");return c.addEventListener(a,y),f=e,()=>{c.removeEventListener(a,y),f=null}},createHref:e=>n(c,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){m=e.Push;let o=u(_.location,t,n);i&&i(o,t),g=v()+1;let r=l(o,g),a=_.createHref(o);try{p.pushState(r,"",a)}catch(s){if(s instanceof DOMException&&"DataCloneError"===s.name)throw s;c.location.assign(a)}h&&f&&f({action:m,location:_.location,delta:1})},replace:function(t,n){m=e.Replace;let o=u(_.location,t,n);i&&i(o,t),g=v();let r=l(o,g),a=_.createHref(o);p.replaceState(r,"",a),h&&f&&f({action:m,location:_.location,delta:0})},go:e=>p.go(e)};return _}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function f(e,t,n){return void 0===n&&(n="/"),g(e,t,n,!1)}function g(e,t,n,i){let o=I(("string"===typeof t?h(t):t).pathname||"/",n);if(null==o)return null;let r=v(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let a=null;for(let s=0;null==a&&s<r.length;++s){let e=R(o);a=x(r[s],e,i)}return a}function v(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let o=(e,o,r)=>{let a={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};a.relativePath.startsWith("/")&&(s(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let c=D([i,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(s(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+c+'".'),v(e.children,t,l,c)),(null!=e.path||e.index)&&t.push({path:c,score:E(c,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of y(e.path))o(e,t,i);else o(e,t)}),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,o=n.endsWith("?"),r=n.replace(/\?$/,"");if(0===i.length)return o?[r,""]:[r];let a=y(i.join("/")),s=[];return s.push(...a.map(e=>""===e?r:[r,e].join("/"))),o&&s.push(...a),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const b=/^:[\w-]+$/,_=3,k=2,w=1,S=10,T=-2,C=e=>"*"===e;function E(e,t){let n=e.split("/"),i=n.length;return n.some(C)&&(i+=T),t&&(i+=k),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?_:""===t?w:S),i)}function x(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,o={},r="/",a=[];for(let s=0;s<i.length;++s){let e=i[s],c=s===i.length-1,l="/"===r?t:t.slice(r.length)||"/",u=P({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),d=e.route;if(!u&&c&&n&&!i[i.length-1].route.index&&(u=P({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!u)return null;Object.assign(o,u.params),a.push({params:o,pathname:D([r,u.pathname]),pathnameBase:A(D([r,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(r=D([r,u.pathnameBase]))}return a}function P(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(i.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))");let r=new RegExp(o,t?void 0:"i");return[r,i]}(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let r=o[0],a=r.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:i.reduce((e,t,n)=>{let{paramName:i,isOptional:o}=t;if("*"===i){let e=s[n]||"";a=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const c=s[n];return e[i]=o&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{}),pathname:r,pathnameBase:a,pattern:e}}function R(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function I(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function M(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function O(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function L(e,t){let n=O(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function N(e,t,n,i){let o;void 0===i&&(i=!1),"string"===typeof e?o=h(e):(o=r({},e),s(!o.pathname||!o.pathname.includes("?"),M("?","pathname","search",o)),s(!o.pathname||!o.pathname.includes("#"),M("#","pathname","hash",o)),s(!o.search||!o.search.includes("#"),M("#","search","hash",o)));let a,c=""===e||""===o.pathname,l=c?"/":o.pathname;if(null==l)a=n;else{let e=t.length-1;if(!i&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:o=""}="string"===typeof e?h(e):e,r=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:r,search:j(i),hash:U(o)}}(o,a),d=l&&"/"!==l&&l.endsWith("/"),p=(c||"."===l)&&n.endsWith("/");return u.pathname.endsWith("/")||!d&&!p||(u.pathname+="/"),u}const D=e=>e.join("/").replace(/\/\/+/g,"/"),A=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),j=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function F(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const B=["post","put","patch","delete"],z=(new Set(B),["get",...B]);new Set(z),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},V.apply(this,arguments)}const q=t.createContext(null);const W=t.createContext(null);const H=t.createContext(null);const Z=t.createContext(null);const G=t.createContext({outlet:null,matches:[],isDataRoute:!1});const K=t.createContext(null);function J(){return null!=t.useContext(Z)}function Q(){return J()||s(!1),t.useContext(Z).location}function Y(e){t.useContext(H).static||t.useLayoutEffect(e)}function $(){let{isDataRoute:e}=t.useContext(G);return e?function(){let{router:e}=ce(ae.UseNavigateStable),n=ue(se.UseNavigateStable),i=t.useRef(!1);return Y(()=>{i.current=!0}),t.useCallback(function(t,o){void 0===o&&(o={}),i.current&&("number"===typeof t?e.navigate(t):e.navigate(t,V({fromRouteId:n},o)))},[e,n])}():function(){J()||s(!1);let e=t.useContext(q),{basename:n,future:i,navigator:o}=t.useContext(H),{matches:r}=t.useContext(G),{pathname:a}=Q(),c=JSON.stringify(L(r,i.v7_relativeSplatPath)),l=t.useRef(!1);return Y(()=>{l.current=!0}),t.useCallback(function(t,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof t)return void o.go(t);let r=N(t,JSON.parse(c),a,"path"===i.relative);null==e&&"/"!==n&&(r.pathname="/"===r.pathname?n:D([n,r.pathname])),(i.replace?o.replace:o.push)(r,i.state,i)},[n,o,c,a,e])}()}function X(e,n){let{relative:i}=void 0===n?{}:n,{future:o}=t.useContext(H),{matches:r}=t.useContext(G),{pathname:a}=Q(),s=JSON.stringify(L(r,o.v7_relativeSplatPath));return t.useMemo(()=>N(e,JSON.parse(s),a,"path"===i),[e,s,a,i])}function ee(n,i,o,r){J()||s(!1);let{navigator:a}=t.useContext(H),{matches:c}=t.useContext(G),l=c[c.length-1],u=l?l.params:{},d=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let p,m=Q();if(i){var g;let e="string"===typeof i?h(i):i;"/"===d||(null==(g=e.pathname)?void 0:g.startsWith(d))||s(!1),p=e}else p=m;let v=p.pathname||"/",y=v;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=f(n,{pathname:y});let _=re(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:D([d,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:D([d,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),c,o,r);return i&&_?t.createElement(Z.Provider,{value:{location:V({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:e.Pop}},_):_}function te(){let e=function(){var e;let n=t.useContext(K),i=le(se.UseRouteError),o=ue(se.UseRouteError);if(void 0!==n)return n;return null==(e=i.errors)?void 0:e[o]}(),n=F(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,o="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:o};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),i?t.createElement("pre",{style:r},i):null,null)}const ne=t.createElement(te,null);class ie extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(G.Provider,{value:this.props.routeContext},t.createElement(K.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:n,match:i,children:o}=e,r=t.useContext(q);return r&&r.static&&r.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=i.route.id),t.createElement(G.Provider,{value:n},o)}function re(e,n,i,o){var r;if(void 0===n&&(n=[]),void 0===i&&(i=null),void 0===o&&(o=null),null==e){var a;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(a=o)&&a.v7_partialHydration&&0===n.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let c=e,l=null==(r=i)?void 0:r.errors;if(null!=l){let e=c.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||s(!1),c=c.slice(0,Math.min(c.length,e+1))}let u=!1,d=-1;if(i&&o&&o.v7_partialHydration)for(let t=0;t<c.length;t++){let e=c[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:n}=i,o=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||o){u=!0,c=d>=0?c.slice(0,d+1):[c[0]];break}}}return c.reduceRight((e,o,r)=>{let a,s=!1,h=null,p=null;var m;i&&(a=l&&o.route.id?l[o.route.id]:void 0,h=o.route.errorElement||ne,u&&(d<0&&0===r?(m="route-fallback",!1||de[m]||(de[m]=!0),s=!0,p=null):d===r&&(s=!0,p=o.route.hydrateFallbackElement||null)));let f=n.concat(c.slice(0,r+1)),g=()=>{let n;return n=a?h:s?p:o.route.Component?t.createElement(o.route.Component,null):o.route.element?o.route.element:e,t.createElement(oe,{match:o,routeContext:{outlet:e,matches:f,isDataRoute:null!=i},children:n})};return i&&(o.route.ErrorBoundary||o.route.errorElement||0===r)?t.createElement(ie,{location:i.location,revalidation:i.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var ae=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ae||{}),se=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(se||{});function ce(e){let n=t.useContext(q);return n||s(!1),n}function le(e){let n=t.useContext(W);return n||s(!1),n}function ue(e){let n=function(){let e=t.useContext(G);return e||s(!1),e}(),i=n.matches[n.matches.length-1];return i.route.id||s(!1),i.route.id}const de={};function he(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}i.startTransition;function pe(e){let{to:n,replace:i,state:o,relative:r}=e;J()||s(!1);let{future:a,static:c}=t.useContext(H),{matches:l}=t.useContext(G),{pathname:u}=Q(),d=$(),h=N(n,L(l,a.v7_relativeSplatPath),u,"path"===r),p=JSON.stringify(h);return t.useEffect(()=>d(JSON.parse(p),{replace:i,state:o,relative:r}),[d,p,r,i,o]),null}function me(e){s(!1)}function fe(n){let{basename:i="/",children:o=null,location:r,navigationType:a=e.Pop,navigator:c,static:l=!1,future:u}=n;J()&&s(!1);let d=i.replace(/^\/*/,"/"),p=t.useMemo(()=>({basename:d,navigator:c,static:l,future:V({v7_relativeSplatPath:!1},u)}),[d,u,c,l]);"string"===typeof r&&(r=h(r));let{pathname:m="/",search:f="",hash:g="",state:v=null,key:y="default"}=r,b=t.useMemo(()=>{let e=I(m,d);return null==e?null:{location:{pathname:e,search:f,hash:g,state:v,key:y},navigationType:a}},[d,m,f,g,v,y,a]);return null==b?null:t.createElement(H.Provider,{value:p},t.createElement(Z.Provider,{children:o,value:b}))}function ge(e){let{children:t,location:n}=e;return ee(ve(t),n)}new Promise(()=>{});t.Component;function ve(e,n){void 0===n&&(n=[]);let i=[];return t.Children.forEach(e,(e,o)=>{if(!t.isValidElement(e))return;let r=[...n,o];if(e.type===t.Fragment)return void i.push.apply(i,ve(e.props.children,r));e.type!==me&&s(!1),e.props.index&&e.props.children&&s(!1);let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=ve(e.props.children,r)),i.push(a)}),i}var ye=n(950),be=n.t(ye,2);function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_e.apply(this,arguments)}function ke(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Se=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(Ut){}const Te=t.createContext({isTransitioning:!1});new Map;const Ce=i.startTransition;be.flushSync,i.useId;function Ee(e){let{basename:n,children:i,future:o,window:r}=e,a=t.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:r,v5Compat:!0})&&(s={}),p(function(e,t){let{pathname:n,search:i,hash:o}=e.location;return u("",{pathname:n,search:i,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:d(t)},null,s)));let c=a.current,[l,h]=t.useState({action:c.action,location:c.location}),{v7_startTransition:m}=o||{},f=t.useCallback(e=>{m&&Ce?Ce(()=>h(e)):h(e)},[h,m]);return t.useLayoutEffect(()=>c.listen(f),[c,f]),t.useEffect(()=>he(o),[o]),t.createElement(fe,{basename:n,children:i,location:l.location,navigationType:l.action,navigator:c,future:o})}const xe="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Pe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Re=t.forwardRef(function(e,n){let i,{onClick:o,relative:r,reloadDocument:a,replace:c,state:l,target:u,to:h,preventScrollReset:p,viewTransition:m}=e,f=ke(e,we),{basename:g}=t.useContext(H),v=!1;if("string"===typeof h&&Pe.test(h)&&(i=h,xe))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=I(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:v=!0}catch(Ut){}let y=function(e,n){let{relative:i}=void 0===n?{}:n;J()||s(!1);let{basename:o,navigator:r}=t.useContext(H),{hash:a,pathname:c,search:l}=X(e,{relative:i}),u=c;return"/"!==o&&(u="/"===c?o:D([o,c])),r.createHref({pathname:u,search:l,hash:a})}(h,{relative:r}),b=function(e,n){let{target:i,replace:o,state:r,preventScrollReset:a,relative:s,viewTransition:c}=void 0===n?{}:n,l=$(),u=Q(),h=X(e,{relative:s});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,i)){t.preventDefault();let n=void 0!==o?o:d(u)===d(h);l(e,{replace:n,state:r,preventScrollReset:a,relative:s,viewTransition:c})}},[u,l,h,o,r,i,e,a,s,c])}(h,{replace:c,state:l,target:u,preventScrollReset:p,relative:r,viewTransition:m});return t.createElement("a",_e({},f,{href:i||y,onClick:v||a?o:function(e){o&&o(e),e.defaultPrevented||b(e)},ref:n,target:u}))});const Ie=t.forwardRef(function(e,n){let{"aria-current":i="page",caseSensitive:o=!1,className:r="",end:a=!1,style:c,to:l,viewTransition:u,children:d}=e,h=ke(e,Se),p=X(l,{relative:h.relative}),m=Q(),f=t.useContext(W),{navigator:g,basename:v}=t.useContext(H),y=null!=f&&function(e,n){void 0===n&&(n={});let i=t.useContext(Te);null==i&&s(!1);let{basename:o}=Le(Me.useViewTransitionState),r=X(e,{relative:n.relative});if(!i.isTransitioning)return!1;let a=I(i.currentLocation.pathname,o)||i.currentLocation.pathname,c=I(i.nextLocation.pathname,o)||i.nextLocation.pathname;return null!=P(r.pathname,c)||null!=P(r.pathname,a)}(p)&&!0===u,b=g.encodeLocation?g.encodeLocation(p).pathname:p.pathname,_=m.pathname,k=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;o||(_=_.toLowerCase(),k=k?k.toLowerCase():null,b=b.toLowerCase()),k&&v&&(k=I(k,v)||k);const w="/"!==b&&b.endsWith("/")?b.length-1:b.length;let S,T=_===b||!a&&_.startsWith(b)&&"/"===_.charAt(w),C=null!=k&&(k===b||!a&&k.startsWith(b)&&"/"===k.charAt(b.length)),E={isActive:T,isPending:C,isTransitioning:y},x=T?i:void 0;S="function"===typeof r?r(E):[r,T?"active":null,C?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let R="function"===typeof c?c(E):c;return t.createElement(Re,_e({},h,{"aria-current":x,className:S,ref:n,style:R,to:l,viewTransition:u}),"function"===typeof d?d(E):d)});var Me,Oe;function Le(e){let n=t.useContext(q);return n||s(!1),n}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Me||(Me={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Oe||(Oe={}));const Ne="sc_local_db",De="sc_current_user";function Ae(e){localStorage.setItem(Ne,JSON.stringify(e))}function je(){var e,t,n,i;const o=function(){try{return JSON.parse(localStorage.getItem(Ne))||{}}catch(e){return{}}}();return null!==(e=o.users)&&void 0!==e||(o.users=[]),null!==(t=o.pairs)&&void 0!==t||(o.pairs=[]),null!==(n=o.zones)&&void 0!==n||(o.zones=[]),null!==(i=o.locations)&&void 0!==i||(o.locations={}),o}function Ue(){const e=localStorage.getItem(De);if(!e)return null;return je().users.find(t=>t.id===e)||null}function Fe(){localStorage.removeItem(De)}function Be(e){const t=je(),n=t.pairs.find(t=>t.patientId===e);return n&&t.users.find(e=>e.id===n.caregiverId)||null}function ze(e){const t=je();let n=t.pairs.find(t=>t.caregiverId===e);return n||(n=t.pairs.find(t=>t.patientId===e),n||null)}function Ve(e,t){const n=je();n.pairs=n.pairs.filter(n=>!(n.caregiverId===e&&n.patientId===t)),Ae(n)}function qe(e){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe(e)}function We(e){var t=function(e,t){if("object"!=qe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=qe(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qe(t)?t:t+""}function He(e,t,n){return(t=We(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach(function(t){He(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ke(e){return je().zones.find(t=>t.patientId===e)||null}function Je(e,t){const n=je(),i=n.zones.find(t=>t.patientId===e);i?Object.assign(i,t):n.zones.push(Ge({patientId:e},t)),Ae(n)}function Qe(e){return je().locations[e]||null}function Ye(e,t){return Object.freeze(Ge(Ge({},e),t))}const $e=(0,t.createContext)(null),Xe=$e.Provider;function et(){const e=(0,t.useContext)($e);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function tt(){return et().map}function nt(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var it=n(228),ot=n.n(it);const rt=["bounds","boundsOptions","center","children","className","id","placeholder","style","whenReady","zoom"];function at(){return at=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},at.apply(this,arguments)}function st(e,n){let{bounds:i,boundsOptions:o,center:r,children:a,className:s,id:c,placeholder:l,style:u,whenReady:d,zoom:h}=e,p=nt(e,rt);const[m]=(0,t.useState)({className:s,id:c,style:u}),[f,g]=(0,t.useState)(null);(0,t.useImperativeHandle)(n,()=>{var e;return null!==(e=null===f||void 0===f?void 0:f.map)&&void 0!==e?e:null},[f]);const v=(0,t.useCallback)(e=>{if(null!==e&&null===f){const t=new it.Map(e,p);null!=r&&null!=h?t.setView(r,h):null!=i&&t.fitBounds(i,o),null!=d&&t.whenReady(d),g(function(e){return Object.freeze({__version:1,map:e})}(t))}},[]);(0,t.useEffect)(()=>()=>{null===f||void 0===f||f.map.remove()},[f]);const y=f?t.createElement(Xe,{value:f},a):null!==l&&void 0!==l?l:null;return t.createElement("div",at({},m,{ref:v}),y)}const ct=(0,t.forwardRef)(st);function lt(e){function n(n,i){const{instance:o,context:r}=e(n).current;return(0,t.useImperativeHandle)(i,()=>o),null==n.children?null:t.createElement(Xe,{value:r},n.children)}return(0,t.forwardRef)(n)}function ut(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function dt(e,n){return null==n?function(n,i){const o=(0,t.useRef)();return o.current||(o.current=e(n,i)),o}:function(i,o){const r=(0,t.useRef)();r.current||(r.current=e(i,o));const a=(0,t.useRef)(i),{instance:s}=r.current;return(0,t.useEffect)(function(){a.current!==i&&(n(s,i,a.current),a.current=i)},[s,i,o]),r}}function ht(e,n){const i=(0,t.useRef)(n);(0,t.useEffect)(function(){n!==i.current&&null!=e.attributionControl&&(null!=i.current&&e.attributionControl.removeAttribution(i.current),null!=n&&e.attributionControl.addAttribution(n)),i.current=n},[e,n])}function pt(e,n){const i=(0,t.useRef)();(0,t.useEffect)(function(){return null!=n&&e.instance.on(n),i.current=n,function(){null!=i.current&&e.instance.off(i.current),i.current=null}},[e,n])}function mt(e,t){var n;const i=null!==(n=e.pane)&&void 0!==n?n:t.pane;return i?Ge(Ge({},e),{},{pane:i}):e}function ft(e,n){(0,t.useEffect)(function(){var t;return(null!==(t=n.layerContainer)&&void 0!==t?t:n.map).addLayer(e.instance),function(){var t;null===(t=n.layerContainer)||void 0===t||t.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}function gt(e){return function(t){const n=et(),i=e(mt(t,n),n);return ht(n.map,t.attribution),pt(i.current,t.eventHandlers),ft(i.current,n),i}}function vt(e){return function(n){const i=et(),o=e(mt(n,i),i);return pt(o.current,n.eventHandlers),ft(o.current,i),function(e,n){const i=(0,t.useRef)();(0,t.useEffect)(function(){if(n.pathOptions!==i.current){var t;const o=null!==(t=n.pathOptions)&&void 0!==t?t:{};e.instance.setStyle(o),i.current=o}},[e,n])}(o.current,n),o}}function yt(e,t){return lt(vt(dt(e,t)))}const bt=["url"],_t=function(e){function n(n,i){const{instance:o}=e(n).current;return(0,t.useImperativeHandle)(i,()=>o),null}return(0,t.forwardRef)(n)}(gt(dt(function(e,t){let{url:n}=e,i=nt(e,bt);return ut(new it.TileLayer(n,mt(i,t)),t)},function(e,t,n){!function(e,t,n){const{opacity:i,zIndex:o}=t;null!=i&&i!==n.opacity&&e.setOpacity(i),null!=o&&o!==n.zIndex&&e.setZIndex(o)}(e,t,n);const{url:i}=t;null!=i&&i!==n.url&&e.setUrl(i)})));const kt=["position"],wt=function(e,t){return lt(gt(dt(e,t)))}(function(e,t){let{position:n}=e,i=nt(e,kt);const o=new it.Marker(n,i);return ut(o,Ye(t,{overlayContainer:o}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),St=function(e,n){const i=function(e,t){return function(n,i){const o=et(),r=e(mt(n,o),o);return ht(o.map,n.attribution),pt(r.current,n.eventHandlers),t(r.current,o,n,i),r}}(dt(e),n);return function(e){function n(n,i){const[o,r]=(0,t.useState)(!1),{instance:a}=e(n,r).current;(0,t.useImperativeHandle)(i,()=>a),(0,t.useEffect)(function(){o&&a.update()},[a,o,n.children]);const s=a._contentNode;return s?(0,ye.createPortal)(n.children,s):null}return(0,t.forwardRef)(n)}(i)}(function(e,t){return ut(new it.Popup(e,t.overlayContainer),t)},function(e,n,i,o){let{position:r}=i;(0,t.useEffect)(function(){const{instance:t}=e;function i(e){e.popup===t&&(t.update(),o(!0))}function a(e){e.popup===t&&o(!1)}return n.map.on({popupopen:i,popupclose:a}),null==n.overlayContainer?(null!=r&&t.setLatLng(r),t.openOn(n.map)):n.overlayContainer.bindPopup(t),function(){var e;n.map.off({popupopen:i,popupclose:a}),null===(e=n.overlayContainer)||void 0===e||e.unbindPopup(),n.map.removeLayer(t)}},[e,n,o,r])});const Tt=["center","children"],Ct=yt(function(e,t){let{center:n,children:i}=e,o=nt(e,Tt);const r=new it.Circle(n,o);return ut(r,Ye(t,{overlayContainer:r}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),Et=["positions"],xt=yt(function(e,t){let{positions:n}=e,i=nt(e,Et);const o=new it.Polyline(n,i);return ut(o,Ye(t,{overlayContainer:o}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)});function Pt(e){var t;return(null!==(t=je().alerts)&&void 0!==t?t:[]).filter(t=>t.toUserId===e).sort((e,t)=>t.ts-e.ts)}var Rt=n(579);delete ot().Icon.Default.prototype._getIconUrl,ot().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const It=new(ot().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Mt=new(ot().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Ot=new(ot().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Lt=[40.7128,-74.006],Nt=(e,t,n,i)=>{const o=e*Math.PI/180,r=n*Math.PI/180,a=(n-e)*Math.PI/180,s=(i-t)*Math.PI/180,c=Math.sin(a/2)**2+Math.cos(o)*Math.cos(r)*Math.sin(s/2)**2;return 12742e3*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))};function Dt(e){let{onLongPress:n,pressMs:i=500}=e;const o=(0,t.useRef)(null);return function(e){const n=tt();(0,t.useEffect)(function(){return n.on(e),function(){n.off(e)}},[n,e])}({mousedown(e){o.current={t:Date.now(),latlng:e.latlng,type:"mouse"}},mouseup(){const e=o.current;"mouse"===(null===e||void 0===e?void 0:e.type)&&(Date.now()-e.t>=i&&n(e.latlng),o.current=null)},touchstart(e){var t;o.current={t:Date.now(),latlng:e.latlng||(null===(t=e.originalEvent)||void 0===t?void 0:t.latlng),type:"touch"}},touchend(){const e=o.current;"touch"===(null===e||void 0===e?void 0:e.type)&&(Date.now()-e.t>=i&&e.latlng&&n(e.latlng),o.current=null)},contextmenu(e){n(e.latlng)}}),null}function At(e){let{hideHeader:n=!1,headerTitle:i="Safety Map",hideBanner:o=!1,hideErrors:r=!1,embed:a=!1}=e;const s=(0,t.useRef)(null),[c]=(0,t.useState)(()=>Ue()),[l,u]=(0,t.useState)(null),d="caregiver"===(null===c||void 0===c?void 0:c.role),h="patient"===(null===c||void 0===c?void 0:c.role),[p,m]=(0,t.useState)(null),[f,g]=(0,t.useState)(""),[v,y]=(0,t.useState)(null),[b,_]=(0,t.useState)(!1),[k,w]=(0,t.useState)(null),[S,T]=(0,t.useState)([]),[C,E]=(0,t.useState)(null);(0,t.useEffect)(()=>{u(ze(null===c||void 0===c?void 0:c.id))},[null===c||void 0===c?void 0:c.id]);const x=(0,t.useMemo)(()=>l?l.patientId:null,[l]),P=(0,t.useMemo)(()=>l?l.caregiverId:null,[l]),R=(0,t.useCallback)(()=>{if(!x)return;const e=Ke(x);y(e||null)},[x]);(0,t.useEffect)(()=>{R()},[R]),(0,t.useEffect)(()=>{if(!("geolocation"in navigator))return void g("Geolocation not supported");const e=navigator.geolocation.watchPosition(e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy};m(t),null!==c&&void 0!==c&&c.id&&function(e,t){const n=je();n.locations[e]=Ge(Ge({},t),{},{ts:Date.now()}),Ae(n)}(c.id,t)},e=>g((null===e||void 0===e?void 0:e.message)||"Unable to get location"),{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return()=>navigator.geolocation.clearWatch(e)},[null===c||void 0===c?void 0:c.id]),(0,t.useEffect)(()=>{if(!d||!x)return;let e=setInterval(()=>{w(Qe(x)),T(Pt(c.id))},1500);return()=>clearInterval(e)},[d,x,null===c||void 0===c?void 0:c.id]);const I=(0,t.useRef)(0);(0,t.useEffect)(()=>{if(!h||!v||!p||!P)return;const e=Nt(p.latitude,p.longitude,v.latitude,v.longitude);if(e>v.radius){const t=Date.now();t-I.current>3e4&&(!function(e){var t;let{toUserId:n,fromUserId:i,type:o,payload:r}=e;const a=je();null!==(t=a.alerts)&&void 0!==t||(a.alerts=[]),a.alerts.push({id:Date.now().toString(),toUserId:n,fromUserId:i,type:o,payload:r,ts:Date.now(),read:!1}),Ae(a)}({toUserId:P,fromUserId:c.id,type:"GEOFENCE_EXIT",payload:{distance:Math.round(e),patientLat:p.latitude,patientLng:p.longitude,zone:v}}),I.current=t)}},[h,v,p,P,null===c||void 0===c?void 0:c.id]),(0,t.useEffect)(()=>{d&&Notification&&"default"===Notification.permission&&Notification.requestPermission().catch(()=>{})},[d]),(0,t.useEffect)(()=>{var e;if(!d||0===S.length)return;const t=S[0];if((null===t||void 0===t||!t.read)&&"granted"===(null===(e=Notification)||void 0===e?void 0:e.permission)&&"GEOFENCE_EXIT"===t.type){var n;const e=null===(n=t.payload)||void 0===n?void 0:n.distance;new Notification("Patient left safe zone",{body:e?"~".concat(e,"m away"):void 0}),function(e){var t;const n=je();(null!==(t=n.alerts)&&void 0!==t?t:[]).forEach(t=>{t.toUserId===e&&(t.read=!0)}),Ae(n)}(c.id),T(Pt(c.id))}},[S,d,null===c||void 0===c?void 0:c.id]);const M=(0,t.useCallback)(e=>{var t;let{lat:n,lng:i}=e;if(!d||!x)return;const o={latitude:n,longitude:i,radius:null!==(t=null===v||void 0===v?void 0:v.radius)&&void 0!==t?t:150};Je(x,o),y(o),_(!0)},[d,x,null===v||void 0===v?void 0:v.radius]),O=(0,t.useMemo)(()=>p?[p.latitude,p.longitude]:Lt,[p]),L=(0,t.useMemo)(()=>{if(d){if(!l)return{type:"info",text:"Pair with a patient to begin."};if(!k)return{type:"warning",text:"Waiting for patient location..."};if(!v)return{type:"info",text:"Long-press to set a safe zone for your patient."};const e=k?Math.round(Nt(k.latitude,k.longitude,v.latitude,v.longitude)):null;return null!=e&&e>v.radius?{type:"error",text:"Patient is OUTSIDE the safe zone (~".concat(e," m from center)")}:{type:"success",text:"Patient is inside the safe zone."}}if(h){if(!v)return{type:"info",text:"Your caregiver hasn\u2019t set a safe zone yet."};if(!p)return{type:"warning",text:"Locating you..."};const e=Math.round(Nt(p.latitude,p.longitude,v.latitude,v.longitude));return e>v.radius?{type:"error",text:"You are OUTSIDE your safe zone (~".concat(e," m from center).")}:{type:"success",text:"You are inside your safe zone."}}return null},[d,h,l,k,p,v]),N=e=>{let{children:t}=e;return a?(0,Rt.jsx)("div",{className:"map-screen embedded",children:t}):(0,Rt.jsx)("div",{className:"screen-container",children:(0,Rt.jsx)("div",{className:"map-screen",children:t})})};return(0,Rt.jsxs)(N,{children:[!n&&(0,Rt.jsxs)("div",{className:"map-header",children:[(0,Rt.jsx)("h1",{children:i}),(0,Rt.jsxs)("div",{className:"map-controls",children:[(0,Rt.jsx)("button",{className:"btn btn-dark",onClick:()=>{s.current&&p&&s.current.setView([p.latitude,p.longitude],15,{animate:!0})},children:"Recenter"}),d&&k&&(0,Rt.jsx)("button",{className:"btn",onClick:async()=>{if(d&&p&&k)try{var e,t,n;const i="https://router.project-osrm.org/route/v1/driving/".concat(p.longitude,",").concat(p.latitude,";").concat(k.longitude,",").concat(k.latitude,"?overview=full&geometries=geojson"),o=await fetch(i),r=await o.json(),a=(null===r||void 0===r||null===(e=r.routes)||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.geometry)||void 0===n?void 0:n.coordinates)||null;a&&E(a.map(e=>{let[t,n]=e;return[n,t]}))}catch(Ut){console.error(Ut),E(null)}},style:{marginLeft:8},children:"Route to patient"})]})]}),!o&&L&&(0,Rt.jsx)("div",{className:"alert alert-".concat(L.type),children:L.text}),!r&&f&&(0,Rt.jsx)("div",{className:"alert alert-error",children:f}),(0,Rt.jsx)("div",{className:"map-container",children:(0,Rt.jsxs)(ct,{center:O,zoom:13,className:"map-root",ref:s,children:[(0,Rt.jsx)(_t,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),d&&(0,Rt.jsx)(Dt,{onLongPress:e=>{let{lat:t,lng:n}=e;return M({lat:t,lng:n})}}),p&&(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)(wt,{position:[p.latitude,p.longitude],icon:It,children:(0,Rt.jsx)(St,{children:(0,Rt.jsxs)("strong",{children:["Me (",null===c||void 0===c?void 0:c.role,")"]})})}),Number.isFinite(p.accuracy)&&p.accuracy>0&&p.accuracy<200&&(0,Rt.jsx)(Ct,{center:[p.latitude,p.longitude],radius:Math.max(20,p.accuracy),pathOptions:{color:"rgba(37,99,235,0.9)",fillColor:"rgba(37,99,235,0.15)"}})]}),d&&k&&(0,Rt.jsx)(wt,{position:[k.latitude,k.longitude],icon:Mt,children:(0,Rt.jsx)(St,{children:(0,Rt.jsx)("strong",{children:"Patient"})})}),v&&(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)(Ct,{center:[v.latitude,v.longitude],radius:v.radius,pathOptions:{color:"rgba(220,38,38,1)",fillColor:"rgba(220,38,38,0.15)"}}),(0,Rt.jsx)(wt,{position:[v.latitude,v.longitude],icon:Ot,draggable:d,eventHandlers:d?{dragend:e=>{const{lat:t,lng:n}=e.target.getLatLng();M({lat:t,lng:n})}}:{},children:(0,Rt.jsx)(St,{children:(0,Rt.jsxs)("div",{className:"zone-popup",children:[(0,Rt.jsx)("strong",{children:"Safe Zone"}),(0,Rt.jsx)("br",{}),"Radius: ",v.radius,"m",(0,Rt.jsx)("br",{}),d&&(0,Rt.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>{d&&x&&(!function(e){const t=je();t.zones=t.zones.filter(t=>t.patientId!==e),Ae(t)}(x),y(null),_(!1))},children:"Remove Zone"})]})})})]}),d&&C&&(0,Rt.jsx)(xt,{positions:C})]})}),d&&v&&(0,Rt.jsxs)("div",{className:"card editor",children:[(0,Rt.jsx)("div",{className:"row",children:(0,Rt.jsx)("strong",{children:"Edit Safe Zone"})}),(0,Rt.jsxs)("div",{className:"row",children:[(0,Rt.jsxs)("label",{style:{width:120},children:["Radius: ",v.radius," m"]}),(0,Rt.jsx)("input",{type:"range",min:"50",max:"1000",step:"10",value:v.radius,onChange:e=>(e=>{if(!d||!x)return;const t=Ge(Ge({},v||{}),{},{radius:e});Je(x,t),y(t)})(Number(e.target.value)),style:{flex:1}}),(0,Rt.jsx)("button",{className:"btn btn-ghost",onClick:()=>_(!1),children:"Done"})]})]}),h&&(0,Rt.jsx)("div",{className:"card",style:{marginTop:12},children:(0,Rt.jsx)("p",{children:"Your caregiver controls your safe zone. You cannot edit it."})})]})}function jt(e,t){return t.forEach(function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var Ut=Object.defineProperty,Ft=(e,t,n)=>((e,t,n)=>t in e?Ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class Bt{constructor(){Ft(this,"_locking"),Ft(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}}function zt(e,t){if(!e)throw new Error(t)}function Vt(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function qt(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function Wt(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const Ht=Symbol("@bufbuild/protobuf/enum-type");function Zt(e){const t=e[Ht];return zt(t,"missing enum type on enum object"),t}function Gt(e,t,n,i){e[Ht]=Kt(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function Kt(e,t,n){const i=Object.create(null),o=Object.create(null),r=[];for(const a of t){const e=Qt(a);r.push(e),i[a.name]=e,o[a.no]=e}return{typeName:e,values:r,findName:e=>i[e],findNumber:e=>o[e]}}function Jt(e,t,n){const i={};for(const o of t){const e=Qt(o);i[e.localName]=e.no,i[e.no]=e.localName}return Gt(i,e,t),i}function Qt(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class Yt{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,o=i.makeReadOptions(t);return i.readMessage(n,e,o,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(Ut){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(Ut instanceof Error?Ut.message:String(Ut)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function $t(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Xt(e,t,n){for(let r=0;r<28;r+=7){const i=e>>>r,o=!(i>>>7==0&&0==t),a=255&(o?128|i:i);if(n.push(a),!o)return}const i=e>>>28&15|(7&t)<<4,o=!(t>>3==0);if(n.push(255&(o?128|i:i)),o){for(let e=3;e<31;e+=7){const i=t>>>e,o=!(i>>>7==0),r=255&(o?128|i:i);if(n.push(r),!o)return}n.push(t>>>31&1)}}const en=4294967296;function tn(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,o=0;function r(t,r){const a=Number(e.slice(t,r));o*=n,i=i*n+a,i>=en&&(o+=i/en|0,i%=en)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),t?rn(i,o):on(i,o)}function nn(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(en*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let o=(16777215&e)+6777216*n+6710656*i,r=n+8147497*i,a=2*i;const s=1e7;return o>=s&&(r+=Math.floor(o/s),o%=s),r>=s&&(a+=Math.floor(r/s),r%=s),a.toString()+an(r)+an(o)}function on(e,t){return{lo:0|e,hi:0|t}}function rn(e,t){return t=~t,e?e=1+~e:t+=1,on(e,t)}const an=e=>{const t=String(e);return"0000000".slice(t.length)+t};function sn(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function cn(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const ln=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyBwv7wdSDYKdl4rZChr3lKEjrRgw7Ysj7Y"}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>o||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>zt(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>zt(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),tn(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),tn(e)),dec:(e,t)=>function(e,t){let n=on(e,t);const i=2147483648&n.hi;i&&(n=rn(n.lo,n.hi));const o=nn(n.lo,n.hi);return i?"-"+o:o}(e,t),uDec:(e,t)=>nn(e,t)}}();var un,dn,hn;function pn(e,t,n){if(t===n)return!0;if(e==un.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case un.UINT64:case un.FIXED64:case un.INT64:case un.SFIXED64:case un.SINT64:return t==n}return!1}function mn(e,t){switch(e){case un.BOOL:return!1;case un.UINT64:case un.FIXED64:case un.INT64:case un.SFIXED64:case un.SINT64:return 0==t?ln.zero:"0";case un.DOUBLE:case un.FLOAT:return 0;case un.BYTES:return new Uint8Array(0);case un.STRING:return"";default:return 0}}function fn(e,t){switch(e){case un.BOOL:return!1===t;case un.STRING:return""===t;case un.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(un||(un={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(dn||(dn={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(hn||(hn={}));class gn{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(qt(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return Vt(e),sn(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Wt(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){qt(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Vt(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Vt(e),sn(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=ln.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=ln.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=ln.enc(e);return Xt(t.lo,t.hi,this.buf),this}sint64(e){let t=ln.enc(e),n=t.hi>>31;return Xt(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=ln.uEnc(e);return Xt(t.lo,t.hi,this.buf),this}}class vn{constructor(e,t){this.varint64=$t,this.uint32=cn,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case hn.Varint:for(;128&this.buf[this.pos++];);break;case hn.Bit64:this.pos+=4;case hn.Bit32:this.pos+=4;break;case hn.LengthDelimited:let n=this.uint32();this.pos+=n;break;case hn.StartGroup:for(;;){const[e,n]=this.tag();if(n===hn.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return ln.dec(...this.varint64())}uint64(){return ln.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,ln.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ln.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ln.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function yn(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return mn(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let bn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),_n=[];for(let n=0;n<bn.length;n++)_n[bn[n].charCodeAt(0)]=n;_n["-".charCodeAt(0)]=bn.indexOf("+"),_n["_".charCodeAt(0)]=bn.indexOf("/");const kn={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),o=0,r=0,a=0;for(let s=0;s<e.length;s++){if(n=_n[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":r=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=n,r=1;break;case 1:i[o++]=a<<2|(48&n)>>4,a=n,r=2;break;case 2:i[o++]=(15&a)<<4|(60&n)>>2,a=n,r=3;break;case 3:i[o++]=(3&a)<<6|n,r=0}}if(1==r)throw Error("invalid base64 string.");return i.subarray(0,o)},enc(e){let t,n="",i=0,o=0;for(let r=0;r<e.length;r++)switch(t=e[r],i){case 0:n+=bn[t>>2],o=(3&t)<<4,i=1;break;case 1:n+=bn[o|t>>4],o=(15&t)<<2,i=2;break;case 2:n+=bn[o|t>>6],n+=bn[63&t],i=0}return i&&(n+=bn[o],n+="=",1==i&&(n+="=")),n}};function wn(e,t,n){Cn(t,e);const i=t.runtime.bin.makeReadOptions(n),o=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[r,a]=yn(t);for(const s of o)t.runtime.bin.readField(r,i.readerFactory(s.data),t.field,s.wireType,i);return a()}function Sn(e,t,n,i){Cn(t,e);const o=t.runtime.bin.makeReadOptions(i),r=t.runtime.bin.makeWriteOptions(i);if(Tn(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=r.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,r);const c=o.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function Tn(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function Cn(e,t){zt(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function En(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!fn(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function xn(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?mn(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function Pn(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(Yt.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function Rn(e,t){return Pn(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}un.DOUBLE,un.FLOAT,un.INT64,un.UINT64,un.INT32,un.UINT32,un.BOOL,un.STRING,un.BYTES;const In={ignoreUnknownFields:!1},Mn={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function On(e){return e?Object.assign(Object.assign({},In),e):In}function Ln(e){return e?Object.assign(Object.assign({},Mn),e):Mn}const Nn=Symbol(),Dn=Symbol();function An(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function jn(e,t,n,i,o){let r=n.localName;if(n.repeated){if(zt("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(t)));const a=e[r];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(e)));switch(n.kind){case"message":a.push(n.T.fromJson(e,i));break;case"enum":const t=Bn(n.T,e,i.ignoreUnknownFields,!0);t!==Dn&&a.push(t);break;case"scalar":try{a.push(Fn(n.T,e,n.L,!0))}catch(Ut){let i="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(e));throw Ut instanceof Error&&Ut.message.length>0&&(i+=": ".concat(Ut.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(t)));const a=e[r];for(const[e,r]of Object.entries(t)){if(null===r)throw new Error("cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: map value null"));let s;try{s=Un(n.K,e)}catch(Ut){let i="cannot decode map key for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(t));throw Ut instanceof Error&&Ut.message.length>0&&(i+=": ".concat(Ut.message)),new Error(i)}switch(n.V.kind){case"message":a[s]=n.V.T.fromJson(r,i);break;case"enum":const e=Bn(n.V.T,r,i.ignoreUnknownFields,!0);e!==Dn&&(a[s]=e);break;case"scalar":try{a[s]=Fn(n.V.T,r,dn.BIGINT,!0)}catch(Ut){let i="cannot decode map value for field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(t));throw Ut instanceof Error&&Ut.message.length>0&&(i+=": ".concat(Ut.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:r},r="value"),n.kind){case"message":const a=n.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let s=e[r];Pn(s)?s.fromJson(t,i):(e[r]=s=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[r]=a.fieldWrapper.unwrapField(s)));break;case"enum":const c=Bn(n.T,t,i.ignoreUnknownFields,!1);switch(c){case Nn:xn(n,e);break;case Dn:break;default:e[r]=c}break;case"scalar":try{const i=Fn(n.T,t,n.L,!1);if(i===Nn)xn(n,e);else e[r]=i}catch(Ut){let i="cannot decode field ".concat(o.typeName,".").concat(n.name," from JSON: ").concat(An(t));throw Ut instanceof Error&&Ut.message.length>0&&(i+=": ".concat(Ut.message)),new Error(i)}}}function Un(e,t){if(e===un.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Fn(e,t,dn.BIGINT,!0).toString()}function Fn(e,t,n,i){if(null===t)return i?mn(e,n):Nn;switch(e){case un.DOUBLE:case un.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==un.FLOAT&&Wt(i),i;case un.INT32:case un.FIXED32:case un.SFIXED32:case un.SINT32:case un.UINT32:let o;if("number"==typeof t?o=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(o=Number(t)),void 0===o)break;return e==un.UINT32||e==un.FIXED32?qt(o):Vt(o),o;case un.INT64:case un.SFIXED64:case un.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const r=ln.parse(t);return n?r.toString():r;case un.FIXED64:case un.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=ln.uParse(t);return n?a.toString():a;case un.BOOL:if("boolean"!==typeof t)break;return t;case un.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(Ut){throw new Error("invalid UTF8")}return t;case un.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return kn.dec(t)}throw new Error}function Bn(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:Nn;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return Dn}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(An(t)))}function zn(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function Vn(e,t,n){if("map"==e.kind){zt("object"==typeof t&&null!=t);const i={},o=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,r]of o)i[n.toString()]=Wn(e.V.T,r);break;case"message":for(const[e,r]of o)i[e.toString()]=r.toJson(n);break;case"enum":const t=e.V.T;for(const[e,r]of o)i[e.toString()]=qn(t,r,n.enumAsInteger)}return n.emitDefaultValues||o.length>0?i:void 0}if(e.repeated){zt(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(Wn(e.T,t[n]));break;case"enum":for(let o=0;o<t.length;o++)i.push(qn(e.T,t[o],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return Wn(e.T,t);case"enum":return qn(e.T,t,n.enumAsInteger);case"message":return Rn(e.T,t).toJson(n)}}function qn(e,t,n){var i;if(zt("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const o=e.findNumber(t);return null!==(i=null===o||void 0===o?void 0:o.name)&&void 0!==i?i:t}function Wn(e,t){switch(e){case un.INT32:case un.SFIXED32:case un.SINT32:case un.FIXED32:case un.UINT32:return zt("number"==typeof t),t;case un.FLOAT:case un.DOUBLE:return zt("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case un.STRING:return zt("string"==typeof t),t;case un.BOOL:return zt("boolean"==typeof t),t;case un.UINT64:case un.FIXED64:case un.INT64:case un.SFIXED64:case un.SINT64:return zt("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case un.BYTES:return zt(t instanceof Uint8Array),kn.enc(t)}}const Hn=Symbol("@bufbuild/protobuf/unknown-fields"),Zn={readUnknownFields:!0,readerFactory:e=>new vn(e)},Gn={writeUnknownFields:!0,writerFactory:()=>new gn};function Kn(e){return e?Object.assign(Object.assign({},Zn),e):Zn}function Jn(e){return e?Object.assign(Object.assign({},Gn),e):Gn}function Qn(e,t,n,i,o){let{repeated:r,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?un.INT32:n.T;let c=Xn;if("scalar"==n.kind&&n.L>0&&(c=$n),r){let n=e[a];if(i==hn.LengthDelimited&&s!=un.STRING&&s!=un.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;r?e[a].push(Yn(t,new l,o,n)):Pn(e[a])?Yn(t,e[a],o,n):(e[a]=Yn(t,new l,o,n),!l.fieldWrapper||n.oneof||n.repeated||(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[u,d]=function(e,t,n){const i=t.uint32(),o=t.pos+i;let r,a;for(;t.pos<o;){const[i]=t.tag();switch(i){case 1:r=Xn(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=Xn(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=Yn(t,new e.V.T,n,void 0)}}}void 0===r&&(r=mn(e.K,dn.BIGINT));"string"!=typeof r&&"number"!=typeof r&&(r=r.toString());if(void 0===a)switch(e.V.kind){case"scalar":a=mn(e.V.T,dn.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[r,a]}(n,t,o);e[a][u]=d}}function Yn(e,t,n,i){const o=t.getType().runtime.bin,r=null===i||void 0===i?void 0:i.delimited;return o.readMessage(t,e,r?i.no:e.uint32(),n,r),t}function $n(e,t){const n=Xn(e,t);return"bigint"==typeof n?n.toString():n}function Xn(e,t){switch(t){case un.STRING:return e.string();case un.BOOL:return e.bool();case un.DOUBLE:return e.double();case un.FLOAT:return e.float();case un.INT32:return e.int32();case un.INT64:return e.int64();case un.UINT64:return e.uint64();case un.FIXED64:return e.fixed64();case un.BYTES:return e.bytes();case un.FIXED32:return e.fixed32();case un.SFIXED32:return e.sfixed32();case un.SFIXED64:return e.sfixed64();case un.SINT64:return e.sint64();case un.UINT32:return e.uint32();case un.SINT32:return e.sint32()}}function ei(e,t,n,i){zt(void 0!==t);const o=e.repeated;switch(e.kind){case"scalar":case"enum":let r="enum"==e.kind?un.INT32:e.T;if(o)if(zt(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,hn.LengthDelimited).fork();let[,o]=oi(t);for(let r=0;r<i.length;r++)e[o](i[r]);e.join()}(n,r,e.no,t);else for(const i of t)ii(n,r,e.no,i);else ii(n,r,e.no,t);break;case"message":if(o){zt(Array.isArray(t));for(const o of t)ni(n,i,e,o)}else ni(n,i,e,t);break;case"map":zt("object"==typeof t&&null!=t);for(const[o,a]of Object.entries(t))ti(n,i,e,o,a)}}function ti(e,t,n,i,o){e.tag(n.no,hn.LengthDelimited),e.fork();let r=i;switch(n.K){case un.INT32:case un.FIXED32:case un.UINT32:case un.SFIXED32:case un.SINT32:r=Number.parseInt(i);break;case un.BOOL:zt("true"==i||"false"==i),r="true"==i}switch(ii(e,n.K,1,r),n.V.kind){case"scalar":ii(e,n.V.T,2,o);break;case"enum":ii(e,un.INT32,2,o);break;case"message":zt(void 0!==o),e.tag(2,hn.LengthDelimited).bytes(o.toBinary(t))}e.join()}function ni(e,t,n,i){const o=Rn(n.T,i);n.delimited?e.tag(n.no,hn.StartGroup).raw(o.toBinary(t)).tag(n.no,hn.EndGroup):e.tag(n.no,hn.LengthDelimited).bytes(o.toBinary(t))}function ii(e,t,n,i){zt(void 0!==i);let[o,r]=oi(t);e.tag(n,o)[r](i)}function oi(e){let t=hn.Varint;switch(e){case un.BYTES:case un.STRING:t=hn.LengthDelimited;break;case un.DOUBLE:case un.FIXED64:case un.SFIXED64:t=hn.Bit64;break;case un.FIXED32:case un.SFIXED32:case un.FLOAT:t=hn.Bit32}return[t,un[e].toLowerCase()]}function ri(e){if(void 0===e)return e;if(Pn(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function ai(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class si{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function ci(e,t){const n=ui(e);return t?n:fi(mi(n))}const li=ui;function ui(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let o=e.charAt(i);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),n.push(o)}}return n.join("")}const di=new Set(["constructor","toString","toJSON","valueOf"]),hi=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),pi=e=>"".concat(e,"$"),mi=e=>hi.has(e)?pi(e):e,fi=e=>di.has(e)?pi(e):e;class gi{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ci(e,!1)}addField(e){zt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const vi=(yi=e=>new si(e,e=>function(e){var t,n,i,o,r,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=ci(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:li(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:dn.BIGINT),e.delimited=null!==(o=l.delimited)&&void 0!==o&&o,e.req=null!==(r=l.req)&&void 0!==r&&r,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=un.BYTES&&l.T!=un.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new gi(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e)),bi=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=mn(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:On,makeWriteOptions:Ln,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(An(t)));i=null!==i&&void 0!==i?i:new e;const o=new Map,r=n.typeRegistry;for(const[a,s]of Object.entries(t)){const t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=o.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(a,'"'));o.set(t.oneof,a)}jn(i,s,t,n,e)}else{let t=!1;if((null===r||void 0===r?void 0:r.findExtension)&&a.startsWith("[")&&a.endsWith("]")){const o=r.findExtension(a.substring(1,a.length-1));if(o&&o.extendee.typeName==e.typeName){t=!0;const[e,r]=yn(o);jn(e,s,o.field,n,o),Sn(i,o,r(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let o;try{for(o of n.fields.byNumber()){if(!En(o,e)){if(o.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!zn(o))continue}const n=Vn(o,o.oneof?e[o.oneof.localName].value:e[o.localName],t);void 0!==n&&(i[t.useProtoFieldName?o.name:o.jsonName]=n)}const r=t.typeRegistry;if(null===r||void 0===r?void 0:r.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(e)){const a=r.findExtensionFor(n.typeName,o.no);if(a&&Tn(e,a)){const n=wn(e,a,t),o=Vn(a.field,n,t);void 0!==o&&(i[a.field.jsonName]=o)}}}catch(Ut){const t=o?"cannot encode field ".concat(n.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=Ut instanceof Error?Ut.message:String(Ut);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>Fn(e,t,null!==n&&void 0!==n?n:dn.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||fn(e,t)?Wn(e,t):void 0},debug:An},bin:{makeReadOptions:Kn,makeWriteOptions:Jn,listUnknownFields(e){var t;return null!==(t=e[Hn])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[Hn]},writeUnknownFields(e,t){const n=e[Hn];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const o=e;Array.isArray(o[Hn])||(o[Hn]=[]),o[Hn].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,o){const r=e.getType(),a=o?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==o||c!=hn.EndGroup);){const n=r.fields.find(s);if(!n){const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n);continue}Qn(e,t,n,c,i)}if(o&&(c!=hn.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Qn,writeMessage(e,t,n){const i=e.getType();for(const o of i.fields.byNumber())if(En(o,e))ei(o,o.oneof?e[o.oneof.localName].value:e[o.localName],t,n);else if(o.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(o.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&ei(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:Gt,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,o=t,r=e;if(null!=r[n])switch(i.kind){case"oneof":const e=r[n].case;if(void 0===e)continue;const t=i.findField(e);let a=r[n].value;t&&"message"==t.kind&&!Pn(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===un.BYTES&&(a=ai(a)),o[n]={case:e,value:a};break;case"scalar":case"enum":let s=r[n];i.T===un.BYTES&&(s=i.repeated?s.map(ai):ai(s)),o[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===un.BYTES)for(const[t,i]of Object.entries(r[n]))o[n][t]=ai(i);else Object.assign(o[n],r[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(r[n])){let i=r[n][t];e.fieldWrapper||(i=new e(i)),o[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)o[n]=r[n].map(e=>Pn(e,c)?e:new c(e));else{const e=r[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?o[n]=ai(e):o[n]=e:o[n]=Pn(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const i=t[e.localName],o=n[e.localName];if(e.repeated){if(i.length!==o.length)return!1;switch(e.kind){case"message":return i.every((t,n)=>e.T.equals(t,o[n]));case"scalar":return i.every((t,n)=>pn(e.T,t,o[n]));case"enum":return i.every((e,t)=>pn(un.INT32,e,o[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=o;return e.T.fieldWrapper&&(void 0===t||Pn(t)||(t=e.T.fieldWrapper.wrapField(t)),void 0===n||Pn(n)||(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return pn(un.INT32,i,o);case"scalar":return pn(e.T,i,o);case"oneof":if(i.case!==o.case)return!1;const r=e.findField(i.case);if(void 0===r)return!0;switch(r.kind){case"message":return r.T.equals(i.value,o.value);case"enum":return pn(un.INT32,i.value,o.value);case"scalar":return pn(r.T,i.value,o.value)}throw new Error("oneof cannot contain ".concat(r.kind));case"map":const a=Object.keys(i).concat(Object.keys(o));switch(e.V.kind){case"message":const t=e.V.T;return a.every(e=>t.equals(i[e],o[e]));case"enum":return a.every(e=>pn(un.INT32,i[e],o[e]));case"scalar":const n=e.V.T;return a.every(e=>pn(n,i[e],o[e]))}}}),clone(e){const t=e.getType(),n=new t,i=n;for(const o of t.fields.byMember()){const t=e[o.localName];let n;if(o.repeated)n=t.map(ri);else if("map"==o.kind){n=i[o.localName];for(const[e,i]of Object.entries(t))n[e]=ri(i)}else n="oneof"==o.kind?o.findField(t.case)?{case:t.case,value:ri(t.value)}:{case:void 0}:ri(t);i[o.localName]=n}for(const o of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,o.no,o.wireType,o.data);return n}}),{newFieldList:yi,initFields:bi}),makeMessageType(e,t,n){return function(e,t,n,i){var o;const r=null!==(o=null===i||void 0===i?void 0:i.localName)&&void 0!==o?o:t.substring(t.lastIndexOf(".")+1),a={[r]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[r];return Object.setPrototypeOf(a.prototype,new Yt),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:Jt,makeEnumType:Kt,getEnumType:Zt,makeExtension(e,t,n){return function(e,t,n,i){let o;return{typeName:t,extendee:n,get field(){if(!o){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),o=e.util.newFieldList([n]).list()[0]}return o},runtime:e}}(this,e,t,n)}});var yi,bi;class _i extends Yt{constructor(e){super(),this.seconds=ln.zero,this.nanos=0,vi.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(vi.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ln.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return _i.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new _i({seconds:ln.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new _i).fromBinary(e,t)}static fromJson(e,t){return(new _i).fromJson(e,t)}static fromJsonString(e,t){return(new _i).fromJsonString(e,t)}static equals(e,t){return vi.util.equals(_i,e,t)}}_i.runtime=vi,_i.typeName="google.protobuf.Timestamp",_i.fields=vi.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const ki=vi.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:_i},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:wi,repeated:!0},{no:5,name:"events",kind:"message",T:Ti,repeated:!0}]),wi=vi.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Si,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Si=vi.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:_i},{no:3,name:"value",kind:"scalar",T:2}]),Ti=vi.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:_i},{no:7,name:"normalized_end_timestamp",kind:"message",T:_i,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Ci=vi.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ei=vi.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),xi=vi.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Pi=vi.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ri=vi.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Ii=vi.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Mi=vi.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Oi=vi.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Li=vi.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ni=vi.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Di=vi.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ai,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:vo}]),Ai=vi.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ji=vi.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:vi.getEnumType(xi),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ui=vi.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:vi.getEnumType(Fi)},{no:4,name:"tracks",kind:"message",T:Wi,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ji},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:vi.getEnumType(Bi)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:vi.getEnumType(Mi)},{no:18,name:"kind_details",kind:"enum",T:vi.getEnumType(zi),repeated:!0}]),Fi=vi.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Bi=vi.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),zi=vi.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Vi=vi.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),qi=vi.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Hi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:vi.getEnumType(Zi)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Wi=vi.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:vi.getEnumType(Ei)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:vi.getEnumType(xi)},{no:10,name:"layers",kind:"message",T:Hi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:qi,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:vi.getEnumType(Vi)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:vo},{no:19,name:"audio_features",kind:"enum",T:vi.getEnumType(Ni),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:vi.getEnumType(Ci)}]),Hi=vi.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:vi.getEnumType(Pi)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Zi=vi.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Gi=vi.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:vi.getEnumType(Ki)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Xi,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Yi,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:eo,oneof:"value"},{no:7,name:"transcription",kind:"message",T:to,oneof:"value"},{no:8,name:"metrics",kind:"message",T:ki,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:io,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:oo,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:ro,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ao,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ko,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:wo,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:So,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Ji,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ki=vi.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Ji=vi.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:vi.getEnumType(Vi)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Qi=vi.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Xi,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:io,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:oo,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:ro,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:ao,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:ko,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:wo,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:So,oneof:"value"}]),Yi=vi.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:$i,repeated:!0}]),$i=vi.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Xi=vi.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),eo=vi.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),to=vi.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:no,repeated:!0}]),no=vi.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),io=vi.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),oo=vi.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),ro=vi.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ao=vi.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:so,oneof:"value"}]),so=vi.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),co=vi.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),lo=vi.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:vi.getEnumType(uo)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),uo=vi.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ho=vi.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:vi.getEnumType(po)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),po=vi.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),mo=vi.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:fo},{no:2,name:"screen",kind:"message",T:fo},{no:3,name:"resume_connection",kind:"enum",T:vi.getEnumType(Ii)},{no:4,name:"disabled_codecs",kind:"message",T:go},{no:5,name:"force_relay",kind:"enum",T:vi.getEnumType(Ii)}]),fo=vi.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:vi.getEnumType(Ii)}]),go=vi.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ai,repeated:!0},{no:2,name:"publish",kind:"message",T:Ai,repeated:!0}]),vo=vi.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),yo=vi.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),bo=vi.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:vi.getEnumType(yo)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),_o=vi.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ko=vi.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:vi.getEnumType(Vi)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:bo,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:_o,oneof:"content_header"}],{localName:"DataStream_Header"}),wo=vi.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),So=vi.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),To=vi.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Co=vi.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Eo=vi.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),xo=vi.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Po=vi.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Uo,oneof:"message"},{no:2,name:"answer",kind:"message",T:Uo,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Oo,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Mo,oneof:"message"},{no:5,name:"mute",kind:"message",T:Lo,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Bo,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:zo,oneof:"message"},{no:8,name:"leave",kind:"message",T:Wo,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Zo,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ar,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:lr,oneof:"message"},{no:13,name:"simulate",kind:"message",T:hr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Go,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:pr,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Vo,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:qo,oneof:"message"}]),Ro=vi.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:No,oneof:"message"},{no:2,name:"answer",kind:"message",T:Uo,oneof:"message"},{no:3,name:"offer",kind:"message",T:Uo,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Oo,oneof:"message"},{no:5,name:"update",kind:"message",T:Fo,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Ao,oneof:"message"},{no:8,name:"leave",kind:"message",T:Wo,oneof:"message"},{no:9,name:"mute",kind:"message",T:Lo,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Jo,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Qo,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:$o,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:er,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ir,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:sr,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:jo,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Do,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:mr,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:vr,oneof:"message"},{no:22,name:"request_response",kind:"message",T:yr,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:_r,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:cr,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:Cr,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:or,oneof:"message"}]),Io=vi.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Hi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:vi.getEnumType(Zi)}]),Mo=vi.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:vi.getEnumType(Ei)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:vi.getEnumType(xi)},{no:9,name:"layers",kind:"message",T:Hi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Io,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:vi.getEnumType(Vi)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:vi.getEnumType(Ci)},{no:17,name:"audio_features",kind:"enum",T:vi.getEnumType(Ni),repeated:!0}]),Oo=vi.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:vi.getEnumType(Co)},{no:3,name:"final",kind:"scalar",T:8}]),Lo=vi.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),No=vi.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Di},{no:2,name:"participant",kind:"message",T:Ui},{no:3,name:"other_participants",kind:"message",T:Ui,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Ko,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:mo},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:lo},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ai,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Do=vi.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Ko,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:mo},{no:3,name:"server_info",kind:"message",T:lo},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Ao=vi.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Wi}]),jo=vi.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Uo=vi.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Fo=vi.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ui,repeated:!0}]),Bo=vi.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:co,repeated:!0}]),zo=vi.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:vi.getEnumType(Pi)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Vo=vi.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:vi.getEnumType(Ni),repeated:!0}]),qo=vi.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Wo=vi.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:vi.getEnumType(Mi)},{no:3,name:"action",kind:"enum",T:vi.getEnumType(Ho)},{no:4,name:"regions",kind:"message",T:fr}]),Ho=vi.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Zo=vi.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Hi,repeated:!0}]),Go=vi.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Ko=vi.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Jo=vi.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:$i,repeated:!0}]),Qo=vi.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Di}]),Yo=vi.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:vi.getEnumType(Ri)},{no:3,name:"score",kind:"scalar",T:2}]),$o=vi.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Yo,repeated:!0}]),Xo=vi.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:vi.getEnumType(Eo)}]),er=vi.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Xo,repeated:!0}]),tr=vi.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:vi.getEnumType(Pi)},{no:2,name:"enabled",kind:"scalar",T:8}]),nr=vi.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:tr,repeated:!0}]),ir=vi.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:tr,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:nr,repeated:!0}]),or=vi.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:To,repeated:!0}]),rr=vi.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ar=vi.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:rr,repeated:!0}]),sr=vi.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),cr=vi.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Di},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ui},{no:4,name:"other_participants",kind:"message",T:Ui,repeated:!0}]),lr=vi.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Uo},{no:2,name:"subscription",kind:"message",T:Bo},{no:3,name:"publish_tracks",kind:"message",T:Ao,repeated:!0},{no:4,name:"data_channels",kind:"message",T:dr,repeated:!0},{no:5,name:"offer",kind:"message",T:Uo},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:ur,repeated:!0}]),ur=vi.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),dr=vi.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:vi.getEnumType(Co)}]),hr=vi.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:vi.getEnumType(xo),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),pr=vi.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),mr=vi.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),fr=vi.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:gr,repeated:!0}]),gr=vi.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),vr=vi.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:vi.getEnumType(Li)}]),yr=vi.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:vi.getEnumType(br)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Oo,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Mo,oneof:"request"},{no:6,name:"mute",kind:"message",T:Lo,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Go,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Vo,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:qo,oneof:"request"}]),br=vi.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),_r=vi.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),kr=vi.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),wr=vi.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:ho},{no:2,name:"connection_settings",kind:"message",T:kr},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Mo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Uo},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:vi.getEnumType(Oi)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:lr}]),Sr=vi.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:vi.getEnumType(Tr)},{no:2,name:"join_request",kind:"scalar",T:12}]),Tr=vi.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),Cr=vi.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function Er(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xr,Pr={exports:{}},Rr=Pr.exports;var Ir,Mr,Or=function(){return xr||(xr=1,e=Pr,function(t,n){e.exports?e.exports=n():t.log=n()}(Rr,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],o={},r=null;function a(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(Ut){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),o=0;o<i.length;o++){var r=i[o];this[r]=o<n?e:this.methodFactory(r,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function u(i,o,r){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function d(e,n){var a,s,l,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(r){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),o=n.indexOf(i+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o+i.length+1))[1])}catch(r){}return void 0===d.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"===typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return null!=l?l:null!=s?s:a},d.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(o){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(o){}}}(l),c.call(d)},d.setDefaultLevel=function(e){s=m(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(r!==d&&(a=m(r.getLevel())),c.call(d),r===d)for(var e in o)o[e].rebuild()},a=m(r?r.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(d)}(r=new d).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=o[e];return t||(t=o[e]=new d(e,r.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return r.noConflict=function(){return typeof window!==t&&window.log===r&&(window.log=h),r},r.getLoggers=function(){return o},r.default=r,r})),Pr.exports;var e}();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(Ir||(Ir={})),function(e){e.Default="livekit",e.Room="livekit-room",e.TokenSource="livekit-token-source",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(Mr||(Mr={}));let Lr=Or.getLogger("livekit");Object.values(Mr).map(e=>Or.getLogger(e));function Nr(e){const t=Or.getLogger(e);return t.setDefaultLevel(Lr.getLevel()),t}Lr.setDefaultLevel(Ir.info);const Dr=Or.getLogger("lk-e2ee"),Ar=7e3,jr=[0,300,1200,2700,4800,Ar,Ar,Ar,Ar,Ar];function Ur(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n}function Fr(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{c(i.next(e))}catch(Ut){r(Ut)}}function s(e){try{c(i.throw(e))}catch(Ut){r(Ut)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((i=i.apply(e,t||[])).next())})}function Br(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function zr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Br(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,o){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,o,(t=e[n](t)).done,t.value)})}}}"function"===typeof SuppressedError&&SuppressedError;var Vr,qr={exports:{}};var Wr=function(){if(Vr)return qr.exports;Vr=1;var e,t="object"===typeof Reflect?Reflect:null,n=t&&"function"===typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"===typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function o(){o.init.call(this)}qr.exports=o,qr.exports.once=function(e,t){return new Promise(function(n,i){function o(n){e.removeListener(t,r),i(n)}function r(){"function"===typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&m(e,"error",t,n)}(e,o,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var r=10;function a(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,r,c;if(a(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),c=r[t]),void 0===c)c=r[t]=n,++e._eventsCount;else if("function"===typeof c?c=r[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(o=s(e))>0&&c.length>o&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=c.length,function(e){console&&console.warn&&console.warn(e)}(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=l.bind(i);return o.listener=n,i.wrapFn=o,o}function d(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"===typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):p(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function o(r){i.once&&e.removeEventListener(t,o),n(r)})}}return Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");r=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return s(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=r[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var l=c.length,u=p(c,l);for(i=0;i<l;++i)n(u[i],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,o,r,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},qr.exports}();let Hr=!0,Zr=!0;function Gr(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function Kr(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return o.apply(this,arguments);const r=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,r),o.apply(this,[e,r])};const r=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(n))return r.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Jr(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Hr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Qr(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Zr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Yr(){if("object"===typeof window){if(Hr)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function $r(e,t){Zr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Xr(e){return"[object Object]"===Object.prototype.toString.call(e)}function ea(e){return Xr(e)?Object.keys(e).reduce(function(t,n){const i=Xr(e[n]),o=i?ea(e[n]):e[n],r=i&&!Object.keys(o).length;return void 0===o||r?t:Object.assign(t,{[n]:o})},{}):e}function ta(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?ta(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{ta(e,e.get(t),n)})}))}function na(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&ta(e,n,o)})}),o}const ia=Yr;function oa(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[o("min",n)]=i.ideal,t.optional.push(e),e={},e[o("max",n)]=i.ideal,t.optional.push(e)):(e[o("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let r=e.video.facingMode;r=r&&("object"===typeof r?r:{ideal:r});const a=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?t=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{n=n.filter(e=>"videoinput"===e.kind);let a=n.find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),ia("chrome: "+JSON.stringify(e)),o(e)})}e.video=i(e.video)}return ia("chrome: "+JSON.stringify(e)),o(e)},r=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){o(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(r(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return o(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(r(e))))}}}function ra(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function aa(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],this.dispatchEvent(o)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Kr(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function sa(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ca(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>na(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Kr(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>na(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function la(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{const t=this.getSenders().find(t=>t.track===e);if(t)throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),o.apply(this,arguments)}}function ua(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return la(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{const t=this.getSenders().find(t=>t.track===e);if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],o=e._streams[i.id];n=n.replace(new RegExp(o.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find(e=>e.track===t);if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=r(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>r(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],o=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function da(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function ha(e,t){Kr(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var pa=Object.freeze({__proto__:null,fixNegotiationNeeded:ha,shimAddTrackRemoveTrack:ua,shimAddTrackRemoveTrackWithNative:la,shimGetSendersWithDtmf:sa,shimGetUserMedia:oa,shimMediaStream:ra,shimOnTrack:aa,shimPeerConnection:da,shimSenderReceiverGetStats:ca});function ma(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){$r("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function fa(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ga(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,r]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!o)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(Ut){if("TypeError"!==Ut.name)throw Ut;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(o,r)}}function va(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ya(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Kr(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ba(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){$r("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function _a(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ka(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function wa(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Sa(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ta(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Ca=Object.freeze({__proto__:null,shimAddTransceiver:ka,shimCreateAnswer:Ta,shimCreateOffer:Sa,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:wa,shimGetUserMedia:ma,shimOnTrack:fa,shimPeerConnection:ga,shimRTCDataChannel:_a,shimReceiverGetStats:ya,shimRemoveStream:ba,shimSenderGetStats:va});function Ea(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function xa(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function Pa(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=i.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Ra(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Ia(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Ia(e){return e&&void 0!==e.video?Object.assign({},e,{video:ea(e.video)}):e}function Ma(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?($r("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Oa(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function La(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Na(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Da,Aa=Object.freeze({__proto__:null,shimAudioContext:Na,shimCallbacksAPI:Pa,shimConstraints:Ia,shimCreateOfferLegacy:La,shimGetUserMedia:Ra,shimLocalStreamsAPI:Ea,shimRTCIceServerUrls:Ma,shimRemoteStreamsAPI:xa,shimTrackEventTransceiver:Oa}),ja={exports:{}};var Ua=(Da||(Da=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)n=i[o].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],o=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const o=i[r],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const o=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{o.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let o=0;return n.codecs.forEach(e=>{e.maxptime>o&&(o=e.maxptime)}),o>0&&(i+="a=maxptime:"+o+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),r=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:r?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=u})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;const r=t.matchPrefix(e,"a=rtcp-mux");return n.mux=r.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);const r=t.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:n.fmt,maxMessageSize:o};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let o;const r=void 0!==n?n:2;return o=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+o+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(ja)),ja.exports),Fa=Er(Ua),Ba=jt({__proto__:null,default:Fa},[Ua]);function za(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Fa.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Kr(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Va(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Kr(e,"icecandidate",e=>{if(e.candidate){const t=Fa.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function qa(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Fa.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Fa.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const o=Fa.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let o;o=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const r={};Object.defineProperty(r,"maxMessageSize",{get:()=>o}),this._sctp=r}return n.apply(this,arguments)}}function Wa(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],o=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Kr(e,"datachannel",e=>(t(e.channel,e.target),e))}function Ha(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Za(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ga(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ka(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var Ja=Object.freeze({__proto__:null,removeExtmapAllowMixed:Za,shimAddIceCandidateNullOrEmpty:Ga,shimConnectionState:Ha,shimMaxMessageSize:qa,shimParameterlessSetLocalDescription:Ka,shimRTCIceCandidate:za,shimRTCIceCandidateRelayProtocol:Va,shimSendThrowTypeError:Wa});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Yr,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Gr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Gr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(Gr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Gr(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),o={browserDetails:i,commonShim:Ja,extractVersion:Gr,disableLog:Jr,disableWarnings:Qr,sdp:Ba};switch(i.browser){case"chrome":if(!pa||!da||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=pa,Ga(e,i),Ka(e),oa(e,i),ra(e),da(e,i),aa(e),ua(e,i),sa(e),ca(e),ha(e,i),za(e),Va(e),Ha(e),qa(e,i),Wa(e),Za(e,i);break;case"firefox":if(!Ca||!ga||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=Ca,Ga(e,i),Ka(e),ma(e,i),ga(e,i),fa(e),ba(e),va(e),ya(e),_a(e),ka(e),wa(e),Sa(e),Ta(e),za(e),Ha(e),qa(e,i),Wa(e);break;case"safari":if(!Aa||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Aa,Ga(e,i),Ka(e),Ma(e),La(e),Pa(e),Ea(e),xa(e),Oa(e),Ra(e),Na(e),za(e),Va(e),qa(e,i),Wa(e),Za(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const Qa="lk_e2ee";var Ya,$a,Xa,es;function ts(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||ns()}function ns(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Ya||(Ya={})),function(e){e.KeyRatcheted="keyRatcheted"}($a||($a={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(Xa||(Xa={})),function(e){e.Error="cryptorError"}(es||(es={}));Wr.EventEmitter;class is extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var os,rs,as,ss,cs,ls,us,ds;!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(os||(os={}));class hs extends is{constructor(e,t,n,i){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=i,this.reasonName=os[t]}}class ps extends is{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class ms extends is{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid"),this.name="TrackInvalidError"}}class fs extends is{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server"),this.name="UnsupportedServer"}}class gs extends is{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class vs extends is{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate"),this.name="NegotiationError"}}class ys extends is{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class bs extends is{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"===typeof t?t:br[t]}}!function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",e[e.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"}(rs||(rs={}));class _s extends is{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=rs[t]}}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(as||(as={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(as||(as={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(ss||(ss={}));!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(cs||(cs={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(ls||(ls={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(us||(us={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(ds||(ds={}));const ks=/version\/(\d+(\.?_?\d+)+)/i;let ws;function Ss(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===ws||t){const e=Ts.find(e=>{let{test:t}=e;return t.test(n)});ws=null===e||void 0===e?void 0:e.describe(n)}return ws}const Ts=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Cs(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Es(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Cs(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Es(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Cs(ks,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Es(e)})}];function Cs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Es(e){return e.includes("mac os")?Cs(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class xs{}xs.setTimeout=function(){return setTimeout(...arguments)},xs.setInterval=function(){return setInterval(...arguments)},xs.clearTimeout=function(){return clearTimeout(...arguments)},xs.clearInterval=function(){return clearInterval(...arguments)};const Ps=[];var Rs;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(Rs||(Rs={}));class Is extends Wr.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=Is.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Lr,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),5e3):this.handleAppVisibilityChanged()},this.log=Nr(null!==(i=n.loggerName)&&void 0!==i?i:Mr.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Is.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Fc(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Is.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===Is.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Ps.forEach(t=>{null!==t.parentElement||e||(e=t)}),e&&Ps.splice(Ps.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ms(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some(e=>"audio"===e.kind);return e.play().then(()=>{this.emit(i?ds.AudioPlaybackStarted:ds.VideoPlaybackStarted)}).catch(t=>{"NotAllowedError"===t.name?this.emit(i?ds.AudioPlaybackFailed:ds.VideoPlaybackFailed,t):"AbortError"===t.name?Lr.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Lr.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some(e=>"video"===e.kind)&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ds.ElementAttached,e),e}detach(e){try{if(e){Os(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(ds.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(e=>{Os(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(ds.ElementDetached,e)}),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Nr(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Ps.forEach(e=>{e.parentElement||(t=!1)}),t&&Ps.push(e)}}handleAppVisibilityChanged(){return Fr(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==Is.Kind.Video||setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Xs()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Xs()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ms(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),Js()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Js()||Ks())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function Os(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return Ei.AUDIO;case t.Video:return Ei.VIDEO;default:return Ei.DATA}},e.kindFromProto=function(e){switch(e){case Ei.AUDIO:return t.Audio;case Ei.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return xi.CAMERA;case n.Microphone:return xi.MICROPHONE;case n.ScreenShare:return xi.SCREEN_SHARE;case n.ScreenShareAudio:return xi.SCREEN_SHARE_AUDIO;default:return xi.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case xi.CAMERA:return n.Camera;case xi.MICROPHONE:return n.Microphone;case xi.SCREEN_SHARE:return n.ScreenShare;case xi.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case Eo.ACTIVE:return i.Active;case Eo.PAUSED:return i.Paused;default:return i.Unknown}}}(Is||(Is={}));class Ls{constructor(e,t,n,i,o){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:o}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Ns=["vp8","h264"],Ds=["vp8","h264","vp9","av1","h265"];const As=function(e){return!!Ns.find(t=>t===e)};var js,Us;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(js||(js={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(Us||(Us={}));const Fs={h90:new Ls(160,90,9e4,20),h180:new Ls(320,180,16e4,20),h216:new Ls(384,216,18e4,20),h360:new Ls(640,360,45e4,20),h540:new Ls(960,540,8e5,25),h720:new Ls(1280,720,17e5,30),h1080:new Ls(1920,1080,3e6,30),h1440:new Ls(2560,1440,5e6,30),h2160:new Ls(3840,2160,8e6,30)},Bs={h120:new Ls(160,120,7e4,20),h180:new Ls(240,180,125e3,20),h240:new Ls(320,240,14e4,20),h360:new Ls(480,360,33e4,20),h480:new Ls(640,480,5e5,20),h540:new Ls(720,540,6e5,25),h720:new Ls(960,720,13e5,30),h1080:new Ls(1440,1080,23e5,30),h1440:new Ls(1920,1440,38e5,30)},zs={h360fps3:new Ls(640,360,2e5,3,"medium"),h360fps15:new Ls(640,360,4e5,15,"medium"),h720fps5:new Ls(1280,720,8e5,5,"medium"),h720fps15:new Ls(1280,720,15e5,15,"medium"),h720fps30:new Ls(1280,720,2e6,30,"medium"),h1080fps15:new Ls(1920,1080,25e5,15,"medium"),h1080fps30:new Ls(1920,1080,5e6,30,"medium"),original:new Ls(0,0,7e6,30,"medium")},Vs="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function qs(e){return Fr(this,void 0,void 0,function*(){return new Promise(t=>xs.setTimeout(t,e))})}function Ws(){return"addTransceiver"in RTCPeerConnection.prototype}function Hs(){return"addTrack"in RTCPeerConnection.prototype}function Zs(e){return"av1"===e||"vp9"===e}function Gs(e){return!(!document||Qs())&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function Ks(){var e;return"Firefox"===(null===(e=Ss())||void 0===e?void 0:e.name)}function Js(){var e;return"Safari"===(null===(e=Ss())||void 0===e?void 0:e.name)}function Qs(){const e=Ss();return"Safari"===(null===e||void 0===e?void 0:e.name)||"iOS"===(null===e||void 0===e?void 0:e.os)}function Ys(){const e=Ss();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&rc(e.osVersion,"17")>=0}function $s(){var e,t;return!!Xs()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function Xs(){return"undefined"!==typeof document}function ec(){return"ReactNative"==navigator.product}function tc(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function nc(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function ic(){if(!ec())return;let e=nc();return e?e.platform:void 0}function oc(){if(Xs())return window.devicePixelRatio;if(ec()){let e=nc();if(e)return e.devicePixelRatio}return 1}function rc(e,t){const n=e.split("."),i=t.split("."),o=Math.min(n.length,i.length);for(let r=0;r<o;++r){const e=parseInt(n[r],10),t=parseInt(i[r],10);if(e>t)return 1;if(e<t)return-1;if(r===o-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function ac(e){for(const t of e)t.target.handleResize(t)}function sc(e){for(const t of e)t.target.handleVisibilityChanged(t)}let cc=null;const lc=()=>(cc||(cc=new ResizeObserver(ac)),cc);let uc=null;const dc=()=>(uc||(uc=new IntersectionObserver(sc,{root:null,rootMargin:"0px"})),uc);let hc;function pc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=document.createElement("canvas");o.width=e,o.height=t;const r=o.getContext("2d");null===r||void 0===r||r.fillRect(0,0,o.width,o.height),i&&r&&(r.beginPath(),r.arc(e/2,t/2,50,0,2*Math.PI,!0),r.closePath(),r.fillStyle="grey",r.fill());const a=o.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function mc(){if(!hc){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[hc]=i.stream.getAudioTracks(),!hc)throw Error("Could not get empty media stream audio track");hc.enabled=!1}return hc.clone()}class fc{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((t,n)=>Fr(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;this._isResolved=!0,null===(e=this.onFinally)||void 0===e||e.call(this)})}}function gc(e){if("string"===typeof e||"number"===typeof e)return e;if(Array.isArray(e))return e[0];if(void 0!==e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(void 0!==e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function vc(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function yc(e){switch(e.reason){case os.LeaveRequest:return e.context;case os.Cancelled:return Mi.CLIENT_INITIATED;case os.NotAllowed:return Mi.USER_REJECTED;case os.ServerUnreachable:return Mi.JOIN_FAILURE;default:return Mi.UNKNOWN_REASON}}function bc(e){return void 0!==e?Number(e):void 0}function _c(e){return void 0!==e?BigInt(e):void 0}function kc(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function wc(e){return!!e&&e.kind==Is.Kind.Audio}function Sc(e){return!!e&&e.kind==Is.Kind.Video}function Tc(e){return kc(e)&&Sc(e)}function Cc(e){return kc(e)&&wc(e)}function Ec(e){return!!e&&!e.isLocal}function xc(e){return!!e&&!e.isLocal}function Pc(e){return Ec(e)&&Sc(e)}function Rc(e,t,n){var i,o,r,a;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=Bc(null!==e&&void 0!==e?e:{}),u=null===t||void 0===t?void 0:t.processor,d=null===n||void 0===n?void 0:n.processor,h=null!==s&&void 0!==s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(Ic(h.audio,t),null!==(i=(r=h.audio).deviceId)&&void 0!==i||(r.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=null!==c&&void 0!==c?c:u)),h.video&&(Ic(h.video,n),null!==(o=(a=h.video).deviceId)&&void 0!==o||(a.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=null!==l&&void 0!==l?l:d)),h}function Ic(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function Mc(e){var t,n,i,o;const r={};if(e.video)if("object"===typeof e.video){const n={},o=n,a=e.video;Object.keys(a).forEach(e=>{if("resolution"===e)Ic(o,a.resolution);else o[e]=a[e]}),r.video=n,null!==(t=(i=r.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else r.video=!!e.video&&{deviceId:{ideal:"default"}};else r.video=!1;return e.audio?"object"===typeof e.audio?(r.audio=e.audio,null!==(n=(o=r.audio).deviceId)&&void 0!==n||(o.deviceId={ideal:"default"})):r.audio={deviceId:{ideal:"default"}}:r.audio=!1,r}function Oc(e){return Fr(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=Lc();if(n){const i=n.createAnalyser();i.fftSize=2048;const o=i.frequencyBinCount,r=new Uint8Array(o);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield qs(t),i.getByteTimeDomainData(r);const a=r.some(e=>128!==e&&0!==e);return n.close(),!a}return!1}()})}function Lc(){var e;const t="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&"undefined"!==typeof window&&(null===(e=window.document)||void 0===e?void 0:e.body)){const e=()=>Fr(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(Ut){console.warn("Error trying to auto-resume audio context",Ut)}finally{null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)}});n.addEventListener("statechange",()=>{var t;"closed"===n.state&&(null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e))}),window.document.body.addEventListener("click",e)}return n}}function Nc(e){return"audioinput"===e?Is.Source.Microphone:"videoinput"===e?Is.Source.Camera:Is.Source.Unknown}function Dc(e){return e===Is.Source.Microphone?"audioinput":e===Is.Source.Camera?"videoinput":void 0}function Ac(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=Js()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function jc(e){return e.split("/")[1].toLowerCase()}function Uc(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new Ao({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function Fc(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Fc(e.track):{})}}function Bc(e){const t=Object.assign({},e);let n,i;return"object"===typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"===typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:(o=t,"undefined"===typeof o?o:"function"===typeof structuredClone?"object"===typeof o&&null!==o?structuredClone(Object.assign({},o)):structuredClone(o):JSON.parse(JSON.stringify(o)))};var o}function zc(e,t){return e.width*e.height<t.width*t.height}class Vc extends Wr.EventEmitter{constructor(e,t){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=e=>{var t,n;const{kind:i,data:o}=e.data;switch(i){case"error":Lr.error(o.error.message),this.emit(Xa.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(Xa.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(o.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Xa.ParticipantEncryptionStatusChanged,o.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(Ya.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break;case"decryptDataResponse":const e=this.decryptDataRequests.get(o.uuid);(null===e||void 0===e?void 0:e.resolve)&&e.resolve(o);break;case"encryptDataResponse":const i=this.encryptDataRequests.get(o.uuid);(null===i||void 0===i?void 0:i.resolve)&&i.resolve(o)}},this.onWorkerError=e=>{Lr.error("e2ee worker encountered an error:",{error:e.error}),this.emit(Xa.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=t}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!ts())throw new ps("tried to setup end-to-end encryption on an unsupported browser");if(Lr.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Dr.getLevel()}};this.worker&&(Lr.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Lr.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Lr.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(us.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(e,t){e.on(cs.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==Vi.NONE,t.identity)),e.on(cs.ConnectionStateChanged,t=>{t===Ru.Connected&&e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==Vi.NONE,e.identity)})})}).on(cs.TrackUnsubscribed,(e,t,n)=>{var i;const o={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(o)}).on(cs.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(cs.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ls.LocalSenderCreated,(e,t)=>Fr(this,void 0,void 0,function*(){this.setupE2EESender(t,e)})),e.localParticipant.on(ls.LocalTrackPublished,e=>{if(!Sc(e.track)||!Qs())return;const t={kind:"updateCodec",data:{trackId:e.track.mediaStreamID,codec:jc(e.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(t)}),t.on(Ya.SetKey,e=>this.postKey(e)).on(Ya.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}encryptData(e){return Fr(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const t=crypto.randomUUID(),n={kind:"encryptDataRequest",data:{uuid:t,payload:e,participantIdentity:this.room.localParticipant.identity}},i=new fc;return i.onFinally=()=>{this.encryptDataRequests.delete(t)},this.encryptDataRequests.set(t,i),this.worker.postMessage(n),i.promise})}handleEncryptedData(e,t,n,i){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),r={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:t,participantIdentity:n,keyIndex:i}},a=new fc;return a.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,a),this.worker.postMessage(r),a.promise}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const r={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(o=this.room)||void 0===o?void 0:o.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(r)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?jc(n.mimeType):void 0)}}setupE2EESender(e,t){kc(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Lr.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Fr(this,void 0,void 0,function*(){if(this.worker){if(ns()){const o={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Qa in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let o=e.writableStream,r=e.readableStream;if(!o||!r){const t=e.createEncodedStreams();e.writableStream=t.writable,o=t.writable,e.readableStream=t.readable,r=t.readable}const a={kind:"decode",data:{readableStream:r,writableStream:o,trackId:t,codec:i,participantIdentity:n,isReuse:Qa in e}};this.worker.postMessage(a,[r,o])}e[Qa]=!0}})}handleSender(e,t,n){var i;if(!(Qa in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ns()){Lr.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Lr.info("initialize encoded streams");const i=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[i.readable,i.writable])}e[Qa]=!0}}}const qc="default";class Wc{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new Wc),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=Wc.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Lr.debug("awaiting getUserMedia promise");try{e?yield Wc.userMediaPromiseMap.get(e):yield Promise.all(Wc.userMediaPromiseMap.values())}catch(Ut){Lr.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(n&&(!Js()||!t.hasDeviceInUse(e))){const t=0===o.filter(t=>t.kind===e).length||o.some(t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i});if(t){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);o=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}}return t._previousDevices=o,e&&(o=o.filter(t=>t.kind===e)),o}()})}normalizeDeviceId(e,t,n){return Fr(this,void 0,void 0,function*(){if(t!==qc)return t;const i=yield this.getDevices(e),o=i.find(e=>e.deviceId===qc);if(!o)return void Lr.warn("could not reliably determine default device");const r=i.find(e=>e.deviceId!==qc&&e.groupId===(null!==n&&void 0!==n?n:o.groupId));if(r)return null===r||void 0===r?void 0:r.deviceId;Lr.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?Wc.userMediaPromiseMap.has(e):Wc.userMediaPromiseMap.size>0}}var Hc;Wc.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Wc.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Hc||(Hc={}));class Zc{constructor(){this.pendingTasks=new Map,this.taskMutex=new Bt,this.nextTaskIndex=0}run(e){return Fr(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Hc.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Hc.RUNNING,yield e()}finally{t.status=Hc.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return Fr(this,void 0,void 0,function*(){return this.run(()=>Fr(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class Gc{get readyState(){return this.ws.readyState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,i;if(null===(n=t.signal)||void 0===n?void 0:n.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,null!==(i=t.protocols)&&void 0!==i?i:[]);o.binaryType="arraybuffer",this.ws=o;const r=function(){let{closeCode:e,reason:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.close(e,t)};this.opened=new Promise((e,t)=>{o.onopen=()=>{e({readable:new ReadableStream({start(e){o.onmessage=t=>{let{data:n}=t;return e.enqueue(n)},o.onerror=t=>e.error(t)},cancel:r}),writable:new WritableStream({write(e){o.send(e)},abort(){o.close()},close:r}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",t)},o.addEventListener("error",t)}),this.closed=new Promise((e,t)=>{const n=()=>Fr(this,void 0,void 0,function*(){const n=new Promise(e=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",t=>{e(t)},{once:!0})}),i=yield Promise.race([qs(250),n]);i?e(i):t(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=t=>{let{code:i,reason:r}=t;e({closeCode:i,reason:r}),o.removeEventListener("error",n)},o.addEventListener("error",n)}),t.signal&&(t.signal.onabort=()=>o.close()),this.close=r}}function Kc(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}function Jc(e){if("string"===typeof e)return Ro.fromJson(JSON.parse(e),{ignoreUnknownFields:!0});if(e instanceof ArrayBuffer)return Ro.fromBinary(new Uint8Array(e));throw new Error("could not decode websocket message: ".concat(typeof e))}const Qc=["syncState","trickle","offer","answer","simulate","leave"];var Yc;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(Yc||(Yc={}));class $c{get currentState(){return this.state}get isDisconnected(){return this.state===Yc.DISCONNECTING||this.state===Yc.DISCONNECTED}get isEstablishingConnection(){return this.state===Yc.CONNECTING||this.state===Yc.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=Yc.DISCONNECTED,this.log=Lr,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Nr(null!==(n=t.loggerName)&&void 0!==n?n:Mr.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new Zc,this.queuedRequests=[],this.closingLock=new Bt,this.connectionLock=new Bt,this.state=Yc.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Fr(this,void 0,void 0,function*(){this.state=Yc.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)})}reconnect(e,t,n,i){return Fr(this,void 0,void 0,function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=Yc.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))})}connect(e,t,n,i){return Fr(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=n;const r=function(){var e;const t=new ho({sdk:po.JS,protocol:16,version:"2.15.11"});return ec()&&(t.os=null!==(e=ic())&&void 0!==e?e:""),t}(),a=n.singlePeerConnection?function(e,t,n){const i=new URLSearchParams;i.set("access_token",e);const o=new wr({clientInfo:t,connectionSettings:new kr({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(o.reconnectReason=n.reconnectReason);const r=new Sr({joinRequest:o.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(r.toBinary()))),i}(t,r,n):function(e,t,n){var i;const o=new URLSearchParams;o.set("access_token",e),n.reconnect&&(o.set("reconnect","1"),n.sid&&o.set("sid",n.sid));o.set("auto_subscribe",n.autoSubscribe?"1":"0"),o.set("sdk",ec()?"reactnative":"js"),o.set("version",t.version),o.set("protocol",t.protocol.toString()),t.deviceModel&&o.set("device_model",t.deviceModel);t.os&&o.set("os",t.os);t.osVersion&&o.set("os_version",t.osVersion);t.browser&&o.set("browser",t.browser);t.browserVersion&&o.set("browser_version",t.browserVersion);n.adaptiveStream&&o.set("adaptive_stream","1");n.reconnectReason&&o.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&o.set("network",navigator.connection.type);return o}(t,r,n),s=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),Kc(n,"rtc")}(e,a),c=Kc(new URL(vc(s)),"validate");return new Promise((e,t)=>Fr(this,void 0,void 0,function*(){var r,a;try{const o=new AbortController,l=i?[o.signal,i]:[o.signal],u=AbortSignal.any(l),d=e=>Fr(this,void 0,void 0,function*(){const n=e.currentTarget,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unknown reason";if(!(e instanceof AbortSignal))return t;const n=e.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:t;default:return"toString"in n?n.toString():t}}(n,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(i)).catch(e=>{this.log.error(e),this.close()}):this.close(),clearTimeout(h),t(n instanceof AbortSignal?n.reason:n)});u.addEventListener("abort",d);const h=setTimeout(()=>{o.abort(new hs("room connection has timed out (signal)",os.ServerUnreachable))},n.websocketTimeout),p=(e,t)=>{this.handleSignalConnected(e,h,t)},m=new URL(s);m.searchParams.has("access_token")&&m.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(m),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new Gc(s);try{this.ws.closed.then(e=>{this.isEstablishingConnection&&t(new hs("Websocket got closed during a (re)connection attempt: ".concat(e.reason),os.InternalError)),1e3!==e.closeCode&&this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.closeCode,wasClean:1e3===e.closeCode,state:this.state}))}).catch(e=>{this.isEstablishingConnection&&t(new hs("Websocket error during a (re)connection attempt: ".concat(e),os.InternalError))});const i=yield this.ws.opened.catch(e=>Fr(this,void 0,void 0,function*(){if(this.state!==Yc.CONNECTED){this.state=Yc.DISCONNECTED,clearTimeout(h);const n=yield this.handleConnectionError(e,c);return void t(n)}this.handleWSError(e),t(e)}));if(clearTimeout(h),!i)return;const o=i.readable.getReader();this.streamWriter=i.writable.getWriter();const s=yield o.read();if(o.releaseLock(),!s.value)throw new hs("no message received as first message",os.InternalError);const l=Jc(s.value),u=this.validateFirstMessage(l,null!==(r=n.reconnect)&&void 0!==r&&r);if(!u.isValid)return void t(u.error);"join"===(null===(a=l.message)||void 0===a?void 0:a.case)&&(this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));p(i,u.shouldProcessFirstMessage?l:void 0),e(u.response)}catch(Ut){clearTimeout(h),t(Ut)}}finally{o()}}))})}startReadingLoop(e,t){return Fr(this,void 0,void 0,function*(){for(t&&this.handleSignalResponse(t);;){this.signalLatency&&(yield qs(this.signalLatency));const{done:t,value:n}=yield e.read();if(t)break;const i=Jc(n);this.handleSignalResponse(i)}})}close(){return Fr(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Close method called on signal client";return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=Yc.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:n});const t=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([t,qs(250)])}}catch(Ut){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:Ut}))}finally{t&&(e.state=Yc.DISCONNECTED),i()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:el(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:el(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Oo({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Lo({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Fr(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const o=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new Go({requestId:o,metadata:e,name:t,attributes:i})}),o}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new Zo({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new ar({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ln.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new pr({timestamp:ln.parse(Date.now()),rtt:ln.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new Vo({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Wo({reason:Mi.CLIENT_INITIATED,action:Ho.DISCONNECT})})}sendRequest(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=Qc.indexOf(e.case)>=0;return Lr.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===Yc.RECONNECTING)return void t.queuedRequests.push(()=>Fr(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield qs(t.signalLatency)),t.isDisconnected)return void t.log.debug("skipping signal request (type: ".concat(e.case,") - SignalClient disconnected"));if(!t.streamWriter)return void t.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),t.logContext);const o=new Po({message:e});try{t.useJSON?yield t.streamWriter.write(o.toJsonString()):yield t.streamWriter.write(o.toBinary())}catch(Ut){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:Ut}))}}()})}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let o=!1;if("answer"===i.case){const e=Xc(i.value);this.onAnswer&&this.onAnswer(e,i.value.id,i.value.midToTrackId)}else if("offer"===i.case){const e=Xc(i.value);this.onOffer&&this.onOffer(e,i.value.id,i.value.midToTrackId)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):"mediaSectionsRequirement"===i.case?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(i.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Fr(this,void 0,void 0,function*(){if(this.state===Yc.DISCONNECTED)return;const t=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=xs.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&xs.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=xs.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&xs.clearInterval(this.pingInterval)}handleSignalConnected(e,t,n){this.state=Yc.CONNECTED,clearTimeout(t),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),n)}validateFirstMessage(e,t){var n,i,o,r,a;return"join"===(null===(n=e.message)||void 0===n?void 0:n.case)?{isValid:!0,response:e.message.value}:this.state===Yc.RECONNECTING&&"leave"!==(null===(i=e.message)||void 0===i?void 0:i.case)?"reconnect"===(null===(o=e.message)||void 0===o?void 0:o.case)?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&"leave"===(null===(r=e.message)||void 0===r?void 0:r.case)?{isValid:!1,error:new hs("Received leave request while trying to (re)connect",os.LeaveRequest,void 0,e.message.value.reason)}:t?{isValid:!1,error:new hs("Unexpected first message",os.InternalError)}:{isValid:!1,error:new hs("did not receive join response, got ".concat(null===(a=e.message)||void 0===a?void 0:a.case," instead"),os.InternalError)}}handleConnectionError(e,t){return Fr(this,void 0,void 0,function*(){try{const n=yield fetch(t);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();return new hs(e,os.NotAllowed,n.status)}return e instanceof hs?e:new hs("Encountered unknown websocket error during connection: ".concat(e),os.InternalError,n.status)}catch(Ut){return Ut instanceof hs?Ut:new hs(Ut instanceof Error?Ut.message:"server was not reachable",os.ServerUnreachable)}})}}function Xc(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function el(e,t){return new Uo({sdp:e.sdp,type:e.type,id:t})}class tl{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0;){if(!(this.buffer[0].sequence<=e))break;this.pop()}}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class nl{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(!(t.expiresAt<Date.now()))return t.value;this._map.delete(e)}}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,o]of n.entries())t.push(e(o,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var il,ol,rl,al,sl,cl={},ll={},ul={exports:{}};function dl(){if(il)return ul.exports;il=1;var e=ul.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),ul.exports}function hl(){return ol||(ol=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var o=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:o&&!n[e.name]&&(n[e.name]={});var r=e.push?{}:o?n[e.name]:n;!function(e,n,i,o){if(o&&!i)n[o]=t(e[1]);else for(var r=0;r<i.length;r+=1)null!=e[r+1]&&(n[i[r]]=t(e[r+1]))}(i.match(e.reg),r,e.names,e.name),e.push&&n[e.push].push(r)},i=dl(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach(function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(o))return n(c,a,o)}}),t.media=r,t};var r=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(r,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),o=0;o<i.length;o+=3)n.push({component:i[o],ip:i[o+1],port:i[o+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(r,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(ll)),ll}function pl(){if(al)return rl;al=1;var e=dl(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,o=i.length;return e.replace(t,function(e){if(n>=o)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},i=function(e,t,i){var o=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?o.push(i[t.name][a]):o.push(i[t.names[r]])}else o.push(i[t.name]);return n.apply(null,o)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return rl=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var a=n.outerOrder||o,s=n.innerOrder||r,c=[];return a.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})}),t.media.forEach(function(t){c.push(i("m",e.m[0],t)),s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})})}),c.join("\r\n")+"\r\n"},rl}var ml=function(){if(sl)return cl;sl=1;var e=hl(),t=pl(),n=dl();return cl.grammar=n,cl.write=t,cl.parse=e.parse,cl.parseParams=e.parseParams,cl.parseFmtpConfig=e.parseFmtpConfig,cl.parsePayloads=e.parsePayloads,cl.parseRemoteCandidates=e.parseRemoteCandidates,cl.parseImageAttributes=e.parseImageAttributes,cl.parseSimulcastStreamList=e.parseSimulcastStreamList,cl}();function fl(e,t,n){var i,o,r;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(o=n.callback)&&o,c=n.maxWait,l=Date.now(),u=[];function d(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,o){var c=a&&void 0===r;if(void 0!==r&&clearTimeout(r),r=setTimeout(function(){if(r=void 0,l=Date.now(),!a){var i=e.apply(n,t);s&&s(i),u.forEach(function(e){return(0,e.resolve)(i)}),u=[]}},d()),c){var h=e.apply(n,t);return s&&s(h),i(h)}u.push({resolve:i,reject:o})})};return h.cancel=function(e){void 0!==r&&clearTimeout(r),u.forEach(function(t){return(0,t.reject)(e)}),u=[]},h}const gl="negotiationStarted",vl="negotiationComplete",yl="rtpVideoPayloadTypes";class bl extends Wr.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=Lr,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=fl(e=>Fr(this,void 0,void 0,function*(){this.emit(gl);try{yield this.createAndSendOffer()}catch(Ut){if(!e)throw Ut;e(Ut)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Nr(null!==(n=t.loggerName)&&void 0!==n?n:Mr.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new Bt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Fr(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return Fr(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],o=ml.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let r=0;return o.media.forEach(e=>{var t;const o=wl(e.mid);"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(r=e.payload,!0)),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(e=>e.payload===r&&"nack"===e.type))&&i.push(o),e.fmtp.some(e=>e.payload===r&&(e.config.includes("sprop-stereo=1")&&n.push(o),!0)))}),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=ml.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{const t=wl(e.mid);"audio"===e.type&&this.trackBitrates.some(n=>{if(!n.transceiver||t!=n.transceiver.mid)return!1;let i=0;if(e.rtp.some(e=>e.codec.toUpperCase()===n.codec.toUpperCase()&&(i=e.payload,!0)),0===i)return!0;let o=!1;for(const t of e.fmtp)if(t.payload===i){t.config=t.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),n.maxbr>0&&(t.config+=";maxaveragebitrate=".concat(1e3*n.maxbr)),o=!0;break}return o||n.maxbr>0&&e.fmtp.push({payload:i,config:"maxaveragebitrate=".concat(1e3*n.maxbr)}),!0})}),i=ml.write(t)}if(yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(vl),e.sdp)){ml.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(yl,e.rtp)})}return!0})}createAndSendOffer(e){return Fr(this,void 0,void 0,function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const o=ml.parse(null!==(t=i.sdp)&&void 0!==t?t:"");if(o.media.forEach(e=>{kl(e),"audio"===e.type?_l(e,["all"],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;if(Zs(t.codec)&&!Js()&&this.ensureVideoDDExtensionForSVC(e,o),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const o of e.fmtp)if(o.payload===n){o.config.includes("x-google-start-bitrate")||(o.config+=";x-google-start-bitrate=".concat(i));break}return!0})}),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(i,ml.write(o)),this.onOffer(i,this.latestOfferId)}finally{n()}})}createAndSetAnswer(){return Fr(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=ml.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{kl(e),"audio"===e.type&&_l(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,ml.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTransceiverOfKind(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new gs("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new gs("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Fr(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const o=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==o?i.get(o):void 0})}setMungedSDP(e,t,n){return Fr(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(Ut){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:Ut,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(Ut){let i="unknown error";Ut instanceof Error?i=Ut.message:"string"===typeof Ut&&(i=Ut);const o={error:i,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new vs(i)}})}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===Vs))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:Vs})}}}function _l(e,t,n){const i=wl(e.mid);let o=0;e.rtp.some(e=>"opus"===e.codec&&(o=e.payload,!0)),o>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(i)&&!e.rtcpFb.some(e=>e.payload===o&&"nack"===e.type)&&e.rtcpFb.push({payload:o,type:"nack"}),(t.includes(i)||1===t.length&&"all"===t[0])&&e.fmtp.some(e=>e.payload===o&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function kl(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}function wl(e){return"number"===typeof e?e.toFixed(0):e}const Sl="vp8",Tl={audioPreset:Us.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:zs.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Sl,backupCodec:!0,preConnectBuffer:!1},Cl={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},El={deviceId:{ideal:"default"},resolution:Fs.h720.resolution},xl={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:jr}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Pl={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Rl;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Rl||(Rl={}));class Il{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=Pl.peerConnectionTimeout,this.log=Lr,this.updateState=()=>{var e,t;const n=this.state,i=this.requiredTransports.map(e=>e.getConnectionState());i.every(e=>"connected"===e)?this.state=Rl.CONNECTED:i.some(e=>"failed"===e)?this.state=Rl.FAILED:i.some(e=>"connecting"===e)?this.state=Rl.CONNECTING:i.every(e=>"closed"===e)?this.state=Rl.CLOSED:i.some(e=>"closed"===e)?this.state=Rl.CLOSING:i.every(e=>"new"===e)&&(this.state=Rl.NEW),n!==this.state&&(this.log.debug("pc state change: from ".concat(Rl[n]," to ").concat(Rl[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),null===(t=this.subscriber)||void 0===t?void 0:t.getConnectionState()))},this.log=Nr(null!==(i=n.loggerName)&&void 0!==i?i:Mr.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired="subscriber-primary"!==t,this.isSubscriberConnectionRequired="subscriber-primary"===t,this.publisher=new bl(e,n),"publisher-only"!==t&&(this.subscriber=new bl(e,n),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Co.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Co.PUBLISHER)},this.publisher.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=Rl.NEW,this.connectionLock=new Bt,this.remoteOfferLock=new Bt}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Fr(this,void 0,void 0,function*(){var e;if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(Ut){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:Ut}))}}yield Promise.all([this.publisher.close(),null===(e=this.subscriber)||void 0===e?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return Fr(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return Fr(this,void 0,void 0,function*(){var n;t===Co.PUBLISHER?yield this.publisher.addIceCandidate(e):yield null===(n=this.subscriber)||void 0===n?void 0:n.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return Fr(this,void 0,void 0,function*(){var n,i,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:null===(n=this.subscriber)||void 0===n?void 0:n.getSignallingState().toString()}));const r=yield this.remoteOfferLock.lock();try{if(!(yield null===(i=this.subscriber)||void 0===i?void 0:i.setRemoteDescription(e,t)))return;return yield null===(o=this.subscriber)||void 0===o?void 0:o.createAndSetAnswer()}finally{r()}})}updateConfiguration(e,t){var n;this.publisher.setConfiguration(e),null===(n=this.subscriber)||void 0===n||n.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Fr(this,void 0,void 0,function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{i()}})}negotiate(e){return Fr(this,void 0,void 0,function*(){return new Promise((t,n)=>Fr(this,void 0,void 0,function*(){const i=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(i),n("negotiation aborted")}),this.publisher.once(gl,()=>{e.signal.aborted||this.publisher.once(vl,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(i),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTransceiverOfKind(e,t){return this.publisher.addTransceiverOfKind(e,t)}getMidForReceiver(e){const t=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(t=>t.receiver===e);return null===t||void 0===t?void 0:t.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Co.PUBLISHER||e===Co.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return Fr(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise((e,o)=>Fr(n,void 0,void 0,function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),xs.clearTimeout(r),o(new hs("room connection has been cancelled",os.Cancelled))};(null===t||void 0===t?void 0:t.signal.aborted)&&n(),null===t||void 0===t||t.signal.addEventListener("abort",n);const r=xs.setTimeout(()=>{null===t||void 0===t||t.signal.removeEventListener("abort",n),o(new hs("could not establish pc connection",os.InternalError))},i);for(;this.state!==Rl.CONNECTED;)if(yield qs(50),null===t||void 0===t?void 0:t.signal.aborted)return void o(new hs("room connection has been cancelled",os.Cancelled));xs.clearTimeout(r),null===t||void 0===t||t.signal.removeEventListener("abort",n),e()}))}()})}}class Ml extends Error{constructor(e,t,n){super(t),this.code=e,this.message=Ll(t,Ml.MAX_MESSAGE_BYTES),this.data=n?Ll(n,Ml.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ml(e.code,e.message,e.data)}toProto(){return new so({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Ml(Ml.ErrorCode[e],Ml.ErrorMessage[e],t)}}Ml.MAX_MESSAGE_BYTES=256,Ml.MAX_DATA_BYTES=15360,Ml.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Ml.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};function Ol(e){return(new TextEncoder).encode(e).length}function Ll(e,t){if(Ol(e)<=t)return e;let n=0,i=e.length;const o=new TextEncoder;for(;n<i;){const r=Math.floor((n+i+1)/2);o.encode(e.slice(0,r)).length<=t?n=r:i=r-1}return e.slice(0,n)}const Nl=2e3;function Dl(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const Al="undefined"!==typeof MediaRecorder;const jl=Al?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class Ul extends jl{constructor(e,t){if(!Al)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const o=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",o),this.removeEventListener("error",r),null===i||void 0===i||i.close(),i=void 0},r=e=>{null===i||void 0===i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",o),this.removeEventListener("error",r),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>Fr(this,void 0,void 0,function*(){let n;if(t.data.arrayBuffer){const e=yield t.data.arrayBuffer();n=new Uint8Array(e)}else{if(!t.data.byteArray)throw new Error("no data available!");n=t.data.byteArray}void 0!==i&&e.enqueue(n)}),this.addEventListener("dataavailable",n)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",r)}}class Fl extends Is{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=fl(()=>Fr(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>Fr(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ds.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new Bt,this.pauseUpstreamLock=new Bt,this.trackChangeLock=new Bt,this.trackChangeLock.lock().then(t=>Fr(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{t()}})),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Is.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Fr(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let i;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{Os(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ms(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(null!==i&&void 0!==i?i:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{Ms(null!==i&&void 0!==i?i:e,t)}))})}waitForDimensions(){return Fr(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===Is.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Ss())||void 0===n?void 0:n.os)&&(yield qs(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield qs(50)}throw new ms("unable to get track dimensions after timeout")}()})}setDeviceId(e){return Fr(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===gc(e)||(this._constraints.deviceId=e,!!this.isMuted||(yield this.restartTrack(),gc(e)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return Fr(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===Is.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),o=e.kind===Is.Kind.Audio?"audioinput":"videoinput";return t?Wc.getInstance().normalizeDeviceId(o,n,i):n}()})}mute(){return Fr(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return Fr(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return Fr(this,void 0,void 0,function*(){const n=yield this.trackChangeLock.lock();try{if(!this.sender)throw new ms("unable to replace an unpublished track");let n,i;return"boolean"===typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null===n||void 0===n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.internalStopProcessor()),this}finally{n()}})}restart(e){return Fr(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,i=Ur(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===Is.Kind.Video?o.video=!t&&!n||{deviceId:t,facingMode:n}:o.audio=!t||Object.assign({deviceId:t},i),this.attachedElements.forEach(e=>{Os(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const r=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===Is.Kind.Video&&(yield r.applyConstraints(i)),r.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(r),this._constraints=e,this.emit(ds.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ds.Muted:ds.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Fr(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),$s()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Fr(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(ds.UpstreamPaused,this);const t=Ss();if("Safari"===(null===t||void 0===t?void 0:t.name)&&rc(t.version,"12.0")<0)throw new ps("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return Fr(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(ds.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return Fr(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()})}setProcessor(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const o=yield t.trackChangeLock.lock();try{t.log.debug("setting up processor",t.logContext);const o=document.createElement(t.kind),r={kind:t.kind,track:t._mediaStreamTrack,element:o,audioContext:t.audioContext};if(yield e.init(r),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.internalStopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(Ms(t._mediaStreamTrack,o),o.muted=!0,o.play().catch(e=>{e instanceof DOMException&&"AbortError"===e.name?(t.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},t.logContext),{error:e})),setTimeout(()=>{o.play().catch(e=>{t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{err:e}))})},100)):t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))}),t.processor=e,t.processorElement=o,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Os(t._mediaStreamTrack,e),Ms(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(ds.TrackProcessorUpdate,t.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return Fr(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{n()}}()})}internalStopProcessor(){return Fr(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ds.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(Al)if(this.localTrackRecorder)this.log.warn("preconnect buffer already started");else{{let e="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(e)||(e="video/mp4"),this.localTrackRecorder=new Ul(this,{mimeType:e})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},1e4)}else this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.mimeType}}class Bl extends Fl{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,Is.Kind.Audio,t,n,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Fr(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(Ut){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:Ut}))}e&&this.prevStats&&(this._currentBitrate=Dl(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ds.AudioTrackFeatureUpdate,this,Ni.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ds.AudioTrackFeatureUpdate,this,Ni.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Fr(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Is.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Fr(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==gc(this._constraints.deviceId);return this.source!==Is.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return Fr(this,void 0,void 0,function*(){let t;if(e){const n=Mc({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Fr(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){Xs()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Nl)))}setProcessor(e){return Fr(this,void 0,void 0,function*(){var t;const n=yield this.trackChangeLock.lock();try{if(!ec()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ds.TrackProcessorUpdate,this.processor)}finally{n()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return Fr(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return Fr(this,void 0,void 0,function*(){const e=yield Oc(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ds.AudioSilenceDetected)),e})}}const zl=Object.values(Fs),Vl=Object.values(Bs),ql=Object.values(zs),Wl=[Fs.h180,Fs.h360],Hl=[Bs.h180,Bs.h360],Zl=["q","h","f"];function Gl(e,t,n,i){var o,r;let a=null===i||void 0===i?void 0:i.videoEncoding;e&&(a=null===i||void 0===i?void 0:i.screenShareEncoding);const s=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const o=function(e,t,n){if(e)return ql;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return zl;return Vl}(e,t,n);let{encoding:r}=o[0];const a=Math.max(t,n);for(let s=0;s<o.length;s+=1){const e=o[s];if(r=e.encoding,e.width>=a)break}if(i)switch(i){case"av1":case"h265":r=Object.assign({},r),r.maxBitrate=.7*r.maxBitrate;break;case"vp9":r=Object.assign({},r),r.maxBitrate=.85*r.maxBitrate}return r}(e,t,n,l),Lr.debug("using video encoding",a));const u=a.maxFramerate,d=new Ls(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&Zs(l)){const e=new Yl(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Ss();if(Qs()||ec()||"Chrome"===(null===n||void 0===n?void 0:n.name)&&rc(null===n||void 0===n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,o=function(e){return e||(e=Ss()),"Safari"===(null===e||void 0===e?void 0:e.name)&&rc(e.version,"18.3")>0||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&rc(e.osVersion,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:Zl[2-n],maxBitrate:a.maxBitrate/Math.pow(i,n),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:o?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),Lr.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let h,p=[];if(p=e?null!==(o=Ql(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==o?o:Kl(e,d):null!==(r=Ql(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==r?r:Kl(e,d),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return Jl(t,n,[e,h,d],u);if(i>=480)return Jl(t,n,[e,d],u)}return Jl(t,n,[d])}function Kl(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map(e=>{var t,i;return new Ls(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)});var n;const{width:i,height:o}=t,r=i>o?i/o:o/i;return Math.abs(r-16/9)<Math.abs(r-4/3)?Wl:Hl}function Jl(e,t,n,i){const o=[];if(n.forEach((n,r)=>{if(r>=Zl.length)return;const a=Math.min(e,t),s={rid:Zl[r],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=Ks()||0===r;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),o.push(s)}),ec()&&"ios"===ic()){let e;o.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;o.forEach(n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Lr.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Lr.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)})}return o}function Ql(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}class Yl{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class $l extends Fl{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,Is.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>Fr(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(Ut){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:Ut}))}const t=new Map(e.map(e=>[e.rid,e])),n=e.some(e=>"cpu"===e.qualityLimitationReason);if(n!==this.isCpuConstrained&&(this.isCpuConstrained=n,this.isCpuConstrained&&this.emit(ds.CpuConstrained)),this.prevStats){let e=0;t.forEach((t,n)=>{var i;const o=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=Dl(t,o)}),this._currentBitrate=e}this.prevStats=t}),this.senderLock=new Bt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Xs())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Nl))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Fr(this,void 0,void 0,function*(){var t,n,i,o,r;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=zr(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){o=a.value,s=!1;const e=o;yield null===(r=e.sender)||void 0===r?void 0:r.replaceTrack(null)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Fr(this,void 0,void 0,function*(){var t,n,i,o,r;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=zr(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){o=a.value,s=!1;const e=o;yield null===(r=e.sender)||void 0===r?void 0:r.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Fr(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==Is.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Fr(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==Is.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Fr(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var i;if("outbound-rtp"===e.type){const o={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},r=n.get(e.remoteId);r&&(o.jitter=r.jitter,o.packetsLost=r.packetsLost,o.roundTripTime=r.roundTripTime),t.push(o)}}),t.sort((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),t})}setPublishingQuality(e){const t=[];for(let n=Rs.LOW;n<=Rs.HIGH;n+=1)t.push(new tr({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Zs(this.codec),t)}restartTrack(e){return Fr(this,void 0,void 0,function*(){var t,n,i,o,r;let a;if(e){const t=Mc({video:e});"boolean"!==typeof t.video&&(a=t.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var s,c=!0,l=zr(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){o=s.value,c=!1;const e=o;e.sender&&"closed"!==(null===(r=e.sender.transport)||void 0===r?void 0:r.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(u){n={error:u}}finally{try{c||t||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Fr(this,arguments,void 0,function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var o,r,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var u,d=!0,h=zr(n.simulcastCodecs.values());!(o=(u=yield h.next()).done);d=!0){s=u.value,d=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(p){r={error:p}}finally{try{d||o||!(a=h.return)||(yield a.call(h))}finally{if(r)throw r.error}}}()})}setDegradationPreference(e){return Fr(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(Ut){this.log.warn("failed to set degradationPreference",Object.assign({error:Ut},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},5e3))}setPublishingCodecs(e){return Fr(this,void 0,void 0,function*(){var t,n,i,o,r,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Zs(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=zr(e);!(o=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Xl(t.sender,t.encodings,e.qualities,this.senderLock,Zs(e.codec),this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(Zs(e.codec),e.qualities)}}catch(l){r={error:l}}finally{try{t||o||!(a=n.return)||(yield a.call(n))}finally{if(r)throw r.error}}return c})}setPublishingLayers(e,t){return Fr(this,void 0,void 0,function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield Xl(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))})}prioritizePerformance(){return Fr(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&Zs(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(Ut){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:Ut})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Fr(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),$s()&&this.isInBackground&&this.source===Is.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Xl(e,t,n,i,o,r,a){return Fr(this,void 0,void 0,function*(){const s=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:s,senderEncodings:t}));let c=!1;if(!1&&s[0].scalabilityMode);else{if(o){n.some(e=>e.enabled)&&n.forEach(e=>e.enabled=!0)}s.forEach((e,i)=>{var o;let s=null!==(o=e.rid)&&void 0!==o?o:"";""===s&&(s="q");const l=eu(s),u=n.find(e=>e.quality===l);u&&e.active!==u.enabled&&(c=!0,e.active=u.enabled,r.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),a),Ks()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})}c&&(i.encodings=s,r.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}})}function eu(e){switch(e){case"f":default:return Rs.HIGH;case"h":return Rs.MEDIUM;case"q":return Rs.LOW}}function tu(e,t,n,i){if(!n)return[new Hi({quality:Rs.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,o=new Yl(i),r=[],a="h"==o.suffix?1.5:2,s="h"==o.suffix?2:3;for(let c=0;c<o.spatial;c+=1)r.push(new Hi({quality:Math.min(Rs.HIGH,o.spatial-1)-c,width:Math.ceil(e/Math.pow(a,c)),height:Math.ceil(t/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,c)):0,ssrc:0}));return r}return n.map(n=>{var i,o,r;const a=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=eu(null!==(o=n.rid)&&void 0!==o?o:"");return new Hi({quality:s,width:Math.ceil(e/a),height:Math.ceil(t/a),bitrate:null!==(r=n.maxBitrate)&&void 0!==r?r:0,ssrc:0})})}const nu="_lossy",iu="_reliable",ou="leave-reconnect";var ru;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(ru||(ru={}));class au extends Wr.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Pl.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=ru.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Lr,this.reliableDataSequence=1,this.reliableMessageBuffer=new tl,this.reliableReceivedState=new nl(3e4),this.midToTrackId={},this.handleDataChannel=e=>Fr(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===iu)t.reliableDCSub=n;else{if(n.label!==nu)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=e=>Fr(this,void 0,void 0,function*(){var t,n,i,o,r;const a=yield this.dataProcessLock.lock();try{let a;if(e.data instanceof ArrayBuffer)a=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));a=yield e.data.arrayBuffer()}const s=Gi.fromBinary(new Uint8Array(a));if(s.sequence>0&&""!==s.participantSid){const e=this.reliableReceivedState.get(s.participantSid);if(e&&s.sequence<=e)return;this.reliableReceivedState.set(s.participantSid,s.sequence)}if("speaker"===(null===(t=s.value)||void 0===t?void 0:t.case))this.emit(us.ActiveSpeakersUpdate,s.value.value.speakers);else if("encryptedPacket"===(null===(n=s.value)||void 0===n?void 0:n.case)){if(!this.e2eeManager)return void this.log.error("Received encrypted packet but E2EE not set up",this.logContext);const e=yield null===(i=this.e2eeManager)||void 0===i?void 0:i.handleEncryptedData(s.value.value.encryptedValue,s.value.value.iv,s.participantIdentity,s.value.value.keyIndex),t=Qi.fromBinary(e.payload),n=new Gi({value:t.value,participantIdentity:s.participantIdentity,participantSid:s.participantSid});"user"===(null===(o=n.value)||void 0===o?void 0:o.case)&&cu(n,n.value.value),this.emit(us.DataPacketReceived,n,s.value.value.encryptionType)}else"user"===(null===(r=s.value)||void 0===r?void 0:r.case)&&cu(s,s.value.value),this.emit(us.DataPacketReceived,s,Vi.NONE)}finally{a()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?Ki.LOSSY:Ki.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(us.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==o?(e===ou&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=xs.setTimeout(()=>this.attemptReconnect(t).finally(()=>this.reconnectTimeout=void 0),o)):n(i)},this.waitForRestarted=()=>new Promise((e,t)=>{this.pcState===ru.Connected&&e();const n=()=>{this.off(us.Disconnected,i),e()},i=()=>{this.off(us.Restarted,n),t()};this.once(us.Restarted,n),this.once(us.Disconnected,i)}),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(us.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===Ki.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Yc.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Oi.RR_SIGNAL_DISCONNECTED))},this.log=Nr(null!==(t=e.loggerName)&&void 0!==t?t:Mr.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new $c(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Bt,this.dataProcessLock=new Bt,this.dcBufferStatus=new Map([[Ki.LOSSY,!0],[Ki.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(us.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(us.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(us.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(us.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(us.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(us.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(us.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(us.SignalRequestResponse,e)}get logContext(){var e,t,n,i,o,r;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(r=null===(o=this.latestJoinResponse)||void 0===o?void 0:o.participant)||void 0===r?void 0:r.identity,pID:this.participantSid}}join(e,t,n,i){return Fr(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),this.subscriberPrimary&&!o.fastPublish||this.negotiate().catch(e=>{Lr.error(e,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(us.SignalConnected,o),o}catch(Ut){if(Ut instanceof hs&&Ut.reason===os.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw Ut}})}close(){return Fr(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(us.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return Fr(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new tl,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return Fr(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new ms("a track with the same ID has already been published");return new Promise((t,n)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],n(new hs("publication of local track timed out, no response from server",os.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(Ut){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:Ut}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return Fr(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return Fr(this,void 0,void 0,function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Rl.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var o;this.pcManager=new Il(i,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(us.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>Fr(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Rl.CONNECTED){const t=this.pcState===ru.New;this.pcState=ru.Connected,t&&this.emit(us.Connected,e)}else t===Rl.FAILED&&(this.pcState!==ru.Connected&&this.pcState!==ru.Reconnecting||(this.pcState=ru.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?Oi.RR_SUBSCRIBER_FAILED:Oi.RR_PUBLISHER_FAILED)));const o=this.client.isDisconnected||this.client.currentState===Yc.RECONNECTING,r=[Rl.FAILED,Rl.CLOSING,Rl.CLOSED].includes(t);o&&r&&!this._isClosed&&this.emit(us.Offline)}),this.pcManager.onTrack=e=>{0!==e.streams.length&&this.emit(us.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(o=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&o>13||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t,n)=>Fr(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:n})),this.midToTrackId=n,yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t,n)=>Fr(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;this.midToTrackId=n;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);i&&this.client.sendAnswer(i,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(us.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(us.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(us.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(us.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(us.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var t,n;const i={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)null===(t=this.pcManager)||void 0===t||t.addPublisherTransceiverOfKind("audio",i);for(let o=0;o<e.numVideos;o++)null===(n=this.pcManager)||void 0===n||n.addPublisherTransceiverOfKind("video",i);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Oi.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Ho.DISCONNECT:this.emit(us.Disconnected,null===e||void 0===e?void 0:e.reason),this.close();break;case Ho.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ou);break;case Ho.RESUME:this.handleDisconnect(ou)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ii.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(nu,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(iu,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return Fr(this,void 0,void 0,function*(){if(Ws()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(Hs()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new gs("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,i){return Fr(this,void 0,void 0,function*(){if(Ws())return this.createSimulcastTransceiverSender(e,t,n,i);if(Hs())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new gs("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return Fr(this,void 0,void 0,function*(){if(!this.pcManager)throw new gs("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Sc(e)&&(e.codec=t.videoCodec);const o={direction:"sendonly",streams:i};n&&(o.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,t,n,i){return Fr(this,void 0,void 0,function*(){if(!this.pcManager)throw new gs("publisher is closed");const o={direction:"sendonly"};i&&(o.sendEncodings=i);const r=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,o);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,r.sender),r.sender})}createRTCRtpSender(e){return Fr(this,void 0,void 0,function*(){if(!this.pcManager)throw new gs("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return Fr(this,void 0,void 0,function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)Lr.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==Ii.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Rl.NEW)!==Rl.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(Ut){this.reconnectAttempts+=1;let t=!0;Ut instanceof gs?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:Ut})),t=!1):Ut instanceof su||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",Oi.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(us.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(Ut){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:Ut}))}return null}restartConnection(e){return Fr(this,void 0,void 0,function*(){var t,n,i;try{if(!this.url||!this.token)throw new gs("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(us.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new su;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(Ut){if(Ut instanceof hs&&Ut.reason===os.NotAllowed)throw new gs("could not reconnect, token might be expired");throw new su}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(us.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==Yc.CONNECTED)throw new su("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(us.Restarted)}catch(o){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),o}})}resumeConnection(e){return Fr(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new gs("could not reconnect, url or token not saved");if(!this.pcManager)throw new gs("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(us.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let e="";if(i instanceof Error&&(e=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof hs&&i.reason===os.NotAllowed)throw new gs("could not reconnect, token might be expired");if(i instanceof hs&&i.reason===os.LeaveRequest)throw i;throw new su(e)}if(this.emit(us.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Yc.CONNECTED)throw new su("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),(null===n||void 0===n?void 0:n.lastMessageSeq)&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(us.Resumed)})}waitForPCInitialConnection(e,t){return Fr(this,void 0,void 0,function*(){if(!this.pcManager)throw new gs("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return Fr(this,void 0,void 0,function*(){this.pcState=ru.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield qs(2e3),!this.pcManager)throw new gs("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=ru.Connected}catch(Ut){throw this.pcState=ru.Disconnected,new hs("could not establish PC connection, ".concat(Ut.message),os.InternalError)}})}publishRpcResponse(e,t,n,i){return Fr(this,void 0,void 0,function*(){const o=new Gi({destinationIdentities:[e],kind:Ki.RELIABLE,value:{case:"rpcResponse",value:new ao({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!==n&&void 0!==n?n:""}})}});yield this.sendDataPacket(o,Ki.RELIABLE)})}publishRpcAck(e,t){return Fr(this,void 0,void 0,function*(){const n=new Gi({destinationIdentities:[e],kind:Ki.RELIABLE,value:{case:"rpcAck",value:new ro({requestId:t})}});yield this.sendDataPacket(n,Ki.RELIABLE)})}sendDataPacket(e,t){return Fr(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(t),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const t=function(e){var t,n,i,o,r;if("sipDtmf"!==(null===(t=e.value)||void 0===t?void 0:t.case)&&"metrics"!==(null===(n=e.value)||void 0===n?void 0:n.case)&&"speaker"!==(null===(i=e.value)||void 0===i?void 0:i.case)&&"transcription"!==(null===(o=e.value)||void 0===o?void 0:o.case)&&"encryptedPacket"!==(null===(r=e.value)||void 0===r?void 0:r.case))return new Qi({value:e.value})}(e);if(t){const n=yield this.e2eeManager.encryptData(t.toBinary());e.value={case:"encryptedPacket",value:new Ji({encryptedValue:n.payload,iv:n.iv,keyIndex:n.keyIndex})}}}t===Ki.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===Ki.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return Fr(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ki.RELIABLE);const t=this.dataChannelForKind(Ki.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(Ki.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,n)=>Fr(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>n("Engine closed");for(this.once(us.Closing,i);!this.dcBufferStatus.get(e);)yield qs(10);this.off(us.Closing,i),t()}}))}ensureDataTransportConnected(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new gs("PC manager is closed");const o=n?t.pcManager.subscriber:t.pcManager.publisher,r=n?"Subscriber":"Publisher";if(!o)throw new hs("".concat(r," connection not set"),os.InternalError);let a=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),a=!0),a||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(a=!0),a&&t.negotiate().catch(e=>{Lr.error(e,t.logContext)});const s=t.dataChannelForKind(e,n);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(o.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield qs(50)}throw new hs("could not establish ".concat(r," connection, state: ").concat(o.getICEConnectionState()),os.InternalError)}()})}ensurePublisherConnected(e){return Fr(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===Rl.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return Fr(this,void 0,void 0,function*(){return new Promise((e,t)=>Fr(this,void 0,void 0,function*(){if(!this.pcManager)return void t(new vs("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(us.Closing,i),this.pcManager.publisher.once(yl,e=>{const t=new Map;e.forEach(e=>{const n=e.codec.toLowerCase();var i;i=n,Ds.includes(i)&&t.set(e.payload,n)}),this.emit(us.RTPVideoMapUpdate,t)});try{yield this.pcManager.negotiate(n),e()}catch(Ut){Ut instanceof vs&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Oi.RR_UNKNOWN),t(Ut)}finally{this.off(us.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===Ki.LOSSY)return this.lossyDCSub;if(e===Ki.RELIABLE)return this.reliableDCSub}else{if(e===Ki.LOSSY)return this.lossyDC;if(e===Ki.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i,o,r;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const a=this.pcManager.publisher.getLocalDescription(),s=this.pcManager.publisher.getRemoteDescription(),c=null===(n=this.pcManager.subscriber)||void 0===n?void 0:n.getRemoteDescription(),l=null===(i=this.pcManager.subscriber)||void 0===i?void 0:i.getLocalDescription(),u=null===(r=null===(o=this.signalOpts)||void 0===o?void 0:o.autoSubscribe)||void 0===r||r,d=new Array,h=new Array;e.forEach(e=>{e.isDesired!==u&&d.push(e.trackSid),e.isEnabled||h.push(e.trackSid)}),this.client.sendSyncState(new lr({answer:this.options.singlePeerConnection?s?el({sdp:s.sdp,type:s.type}):void 0:l?el({sdp:l.sdp,type:l.type}):void 0,offer:this.options.singlePeerConnection?a?el({sdp:a.sdp,type:a.type}):void 0:c?el({sdp:c.sdp,type:c.type}):void 0,subscription:new Bo({trackSids:d,subscribe:!u,participantTracks:[]}),publishTracks:Uc(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:h,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new ur({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new dr({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(Ki.LOSSY),Co.PUBLISHER),t(this.dataChannelForKind(Ki.RELIABLE),Co.PUBLISHER),t(this.dataChannelForKind(Ki.LOSSY,!0),Co.SUBSCRIBER),t(this.dataChannelForKind(Ki.RELIABLE,!0),Co.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&xs.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Xs()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Xs()&&window.removeEventListener("online",this.handleBrowserOnLine)}getTrackIdForReceiver(e){var t;const n=null===(t=this.pcManager)||void 0===t?void 0:t.getMidForReceiver(e);if(n){const e=Object.entries(this.midToTrackId).find(e=>{let[t]=e;return t===n});if(e)return e[1]}}}class su extends Error{}function cu(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}class lu{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return tc(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Fr(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Lr.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return Fr(this,void 0,void 0,function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new hs("Could not fetch region settings: ".concat(t.statusText),401===t.status?os.NotAllowed:os.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class uu{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("number"===typeof this.totalByteSize&&0!==this.totalByteSize){if(e&&this.bytesReceived<this.totalByteSize)throw new _s("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),rs.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new _s("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),rs.LengthExceeded)}}constructor(e,t,n,i){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class du extends uu{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new fc,n=null,i=null;if(this.signal){const e=this.signal;i=()=>{var n;null===(n=t.reject)||void 0===n||n.call(t,e.reason)},e.addEventListener("abort",i),n=e}const o=()=>{e.releaseLock(),n&&i&&n.removeEventListener("abort",i),this.signal=void 0};return{next:()=>Fr(this,void 0,void 0,function*(){var n,i;try{const{done:o,value:r}=yield Promise.race([e.read(),t.promise,null!==(i=null===(n=this.outOfBandFailureRejectingFuture)||void 0===n?void 0:n.promise)&&void 0!==i?i:new Promise(()=>{})]);return o?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(r),{done:!1,value:r.content})}catch(r){throw o(),r}}),return(){return Fr(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return Fr(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,o,r;let a=new Set;const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,u=zr(s);!(n=(c=yield u.next()).done);l=!0){r=c.value,l=!1;const e=r;a.add(e)}}catch(d){i={error:d}}finally{try{l||n||!(o=u.return)||(yield o.call(u))}finally{if(i)throw i.error}}return Array.from(a)}()})}}class hu extends uu{constructor(e,t,n,i){super(e,t,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=bc(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let n=new fc,i=null,o=null;if(this.signal){const e=this.signal;o=()=>{var t;null===(t=n.reject)||void 0===t||t.call(n,e.reason)},e.addEventListener("abort",o),i=e}const r=()=>{e.releaseLock(),i&&o&&i.removeEventListener("abort",o),this.signal=void 0};return{next:()=>Fr(this,void 0,void 0,function*(){var i,o;try{const{done:r,value:s}=yield Promise.race([e.read(),n.promise,null!==(o=null===(i=this.outOfBandFailureRejectingFuture)||void 0===i?void 0:i.promise)&&void 0!==o?o:new Promise(()=>{})]);if(r)return this.validateBytesReceived(!0),{done:!0,value:void 0};{let e;this.handleChunkReceived(s);try{e=t.decode(s.content)}catch(a){throw new _s("Cannot decode datastream chunk ".concat(s.chunkIndex," as text: ").concat(a),rs.DecodeFailed)}return{done:!1,value:e}}}catch(a){throw r(),a}}),return(){return Fr(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return Fr(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,o,r;let a="";const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,u=zr(s);!(n=(c=yield u.next()).done);l=!0){r=c.value,l=!1;a+=r}}catch(d){i={error:d}}finally{try{l||n||!(o=u.return)||(yield o.call(u))}finally{if(i)throw i.error}}return a}()})}}class pu{constructor(){this.log=Lr,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new _s('A text stream handler for topic "'.concat(e,'" has already been set.'),rs.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new _s('A byte stream handler for topic "'.concat(e,'" has already been set.'),rs.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,n,i,o;const r=Array.from(this.textStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e);if(r.length>0||a.length>0){const s=new _s("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),rs.AbnormalEnd);for(const[e,i]of a)null===(n=(t=i.outOfBandFailureRejectingFuture).reject)||void 0===n||n.call(t,s),this.byteStreamControllers.delete(e);for(const[e,t]of r)null===(o=(i=t.outOfBandFailureRejectingFuture).reject)||void 0===o||o.call(i,s),this.textStreamControllers.delete(e)}}handleDataStreamPacket(e,t){return Fr(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,t);case"streamChunk":return this.handleStreamChunk(e.value.value,t);case"streamTrailer":return this.handleStreamTrailer(e.value.value,t);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t,n){return Fr(this,void 0,void 0,function*(){var i;if("byteHeader"===e.contentHeader.case){const o=this.byteStreamHandlers.get(e.topic);if(!o)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const a=new fc;a.promise.catch(e=>{this.log.error(e)});const s={id:e.streamId,name:null!==(i=e.contentHeader.value.name)&&void 0!==i?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:bc(e.timestamp),attributes:e.attributes,encryptionType:n},c=new ReadableStream({start:n=>{if(r=n,this.textStreamControllers.has(e.streamId))throw new _s("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),rs.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:s,controller:r,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:a})}});o(new du(s,c,bc(e.totalLength),a),{identity:t})}else if("textHeader"===e.contentHeader.case){const i=this.textStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let o;const r=new fc;r.promise.catch(e=>{this.log.error(e)});const a={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:n},s=new ReadableStream({start:n=>{if(o=n,this.textStreamControllers.has(e.streamId))throw new _s("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),rs.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:a,controller:o,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:r})}});i(new hu(a,s,bc(e.totalLength),r),{identity:t})}})}handleStreamChunk(e,t){const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.encryptionType!==t?(n.controller.error(new _s("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(n.info.encryptionType),rs.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&n.controller.enqueue(e));const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?(i.controller.error(new _s("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),rs.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e))}handleStreamTrailer(e,t){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.encryptionType!==t?n.controller.error(new _s("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(n.info.encryptionType),rs.EncryptionTypeMismatch)):(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId)));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?i.controller.error(new _s("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),rs.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class mu{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return Fr(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class fu extends mu{}class gu extends mu{}class vu{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return Fr(this,void 0,void 0,function*(){var n;const i=crypto.randomUUID(),o=(new TextEncoder).encode(e).byteLength,r=null===(n=null===t||void 0===t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),a=new Array(r?r.length+1:1).fill(0),s=(e,n)=>{var i;a[n]=e;const o=a.reduce((e,t)=>e+t,0);null===(i=null===t||void 0===t?void 0:t.onProgress)||void 0===i||i.call(t,o)},c=yield this.streamText({streamId:i,totalSize:o,destinationIdentities:null===t||void 0===t?void 0:t.destinationIdentities,topic:null===t||void 0===t?void 0:t.topic,attachedStreamIds:r,attributes:null===t||void 0===t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),(null===t||void 0===t?void 0:t.attachments)&&r&&(yield Promise.all(t.attachments.map((e,n)=>Fr(this,void 0,void 0,function*(){return this._sendFile(r[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))),c.info})}streamText(e){return Fr(this,void 0,void 0,function*(){var t,n,i;const o=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),r={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null===e||void 0===e?void 0:e.topic)&&void 0!==n?n:"",size:null===e||void 0===e?void 0:e.totalSize,attributes:null===e||void 0===e?void 0:e.attributes,encryptionType:(null===(i=this.engine.e2eeManager)||void 0===i?void 0:i.isDataChannelEncryptionEnabled)?Vi.GCM:Vi.NONE},a=new ko({streamId:o,mimeType:r.mimeType,topic:r.topic,timestamp:_c(r.timestamp),totalLength:_c(null===e||void 0===e?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new bo({version:null===e||void 0===e?void 0:e.version,attachedStreamIds:null===e||void 0===e?void 0:e.attachedStreamIds,replyToStreamId:null===e||void 0===e?void 0:e.replyToStreamId,operationType:"update"===(null===e||void 0===e?void 0:e.type)?yo.UPDATE:yo.CREATE})}}),s=null===e||void 0===e?void 0:e.destinationIdentities,c=new Gi({destinationIdentities:s,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,Ki.RELIABLE);let l=0;const u=this.engine,d=new WritableStream({write(e){return Fr(this,void 0,void 0,function*(){for(const t of function(e,t){const n=[];let i=(new TextEncoder).encode(e);for(;i.length>t;){let e=t;for(;e>0;){const t=i[e];if(void 0!==t&&128!==(192&t))break;e--}n.push(i.slice(0,e)),i=i.slice(e)}return i.length>0&&n.push(i),n}(e,15e3)){yield u.waitForBufferStatusLow(Ki.RELIABLE);const e=new wo({content:t,streamId:o,chunkIndex:_c(l)}),n=new Gi({destinationIdentities:s,value:{case:"streamChunk",value:e}});yield u.sendDataPacket(n,Ki.RELIABLE),l+=1}})},close(){return Fr(this,void 0,void 0,function*(){const e=new So({streamId:o}),t=new Gi({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield u.sendDataPacket(t,Ki.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let h=()=>Fr(this,void 0,void 0,function*(){yield p.close()});u.once(us.Closing,h);const p=new fu(d,r,()=>this.engine.off(us.Closing,h));return p})}sendFile(e,t){return Fr(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return Fr(this,void 0,void 0,function*(){var i;const o=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null===n||void 0===n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null===n||void 0===n?void 0:n.topic,destinationIdentities:null===n||void 0===n?void 0:n.destinationIdentities}),r=t.stream().getReader();for(;;){const{done:e,value:t}=yield r.read();if(e)break;yield o.write(t)}return yield o.close(),o.info})}streamBytes(e){return Fr(this,void 0,void 0,function*(){var t,n,i,o,r,a;const s=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),c=null===e||void 0===e?void 0:e.destinationIdentities,l={id:s,mimeType:null!==(n=null===e||void 0===e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null===e||void 0===e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null===e||void 0===e?void 0:e.attributes,size:null===e||void 0===e?void 0:e.totalSize,name:null!==(o=null===e||void 0===e?void 0:e.name)&&void 0!==o?o:"unknown",encryptionType:(null===(r=this.engine.e2eeManager)||void 0===r?void 0:r.isDataChannelEncryptionEnabled)?Vi.GCM:Vi.NONE},u=new ko({totalLength:_c(null!==(a=l.size)&&void 0!==a?a:0),mimeType:l.mimeType,streamId:s,topic:l.topic,timestamp:_c(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new _o({name:l.name})}}),d=new Gi({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,Ki.RELIABLE);let h=0;const p=new Bt,m=this.engine,f=this.log,g=new WritableStream({write(e){return Fr(this,void 0,void 0,function*(){const t=yield p.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield m.waitForBufferStatusLow(Ki.RELIABLE);const i=new Gi({destinationIdentities:c,value:{case:"streamChunk",value:new wo({content:t,streamId:s,chunkIndex:_c(h)})}});yield m.sendDataPacket(i,Ki.RELIABLE),h+=1,n+=t.byteLength}}finally{t()}})},close(){return Fr(this,void 0,void 0,function*(){const e=new So({streamId:s}),t=new Gi({destinationIdentities:c,value:{case:"streamTrailer",value:e}});yield m.sendDataPacket(t,Ki.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new gu(g,l)})}}class yu extends Is{constructor(e,t,n,i,o){super(e,n,o),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ds.Muted:ds.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ds.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Fr(this,void 0,void 0,function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Nl)),"undefined"!==typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(ds.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class bu extends yu{constructor(e,t,n,i,o,r){super(e,t,Is.Kind.Audio,n,r),this.monitorReceiver=()=>Fr(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Dl(e,this.prevStats)),this.prevStats=e}),this.audioContext=i,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;ec()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ec())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return Fr(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Gs(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Gs(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{n.connect(e),n=e}),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then(()=>{"running"!==e.state&&this.emit(ds.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(e=>{this.emit(ds.AudioPlaybackFailed,e)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Fr(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}class _u extends yu{constructor(e,t,n,i,o){super(e,t,Is.Kind.Video,n,o),this.elementInfos=[],this.monitorReceiver=()=>Fr(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Dl(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=fl(()=>{this.updateDimensions()},100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}setStreamState(e){super.setStreamState(e),console.log("setStreamState",e),e===Is.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Os(this._mediaStreamTrack,t):Ms(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new ku(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Fr(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)}),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Fr(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,n;const i=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),o=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,r=this.elementInfos.some(e=>e.pictureInPicture),a=this.elementInfos.some(e=>e.visible)&&!o||r;(this.lastVisible!==a||e)&&(!a&&Date.now()-i<100?xs.setTimeout(()=>{this.updateVisibility()},100):(this.lastVisible=a,this.emit(ds.VisibilityChanged,a,this)))}updateDimensions(){var e,t;let n=0,i=0;const o=this.getPixelDensity();for(const r of this.elementInfos){const e=r.width()*o,t=r.height()*o;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(ds.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return oc();if(!t){return oc()>2?2:1}return t}}class ku{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=wu(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=wu(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=wu(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:Su(e),this.isPiP=Xs()&&wu(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Su(this.element),this.isPiP=wu(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,dc().observe(this.element),lc().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,o;null===(e=dc())||void 0===e||e.unobserve(this.element),null===(t=lc())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(o=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===o||o.removeEventListener("pagehide",this.onLeavePiP)}}function wu(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&Su(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Su(e,t){const n=t||window;let i=e.offsetTop,o=e.offsetLeft;const r=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,o+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&o<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&o+r>n.pageXOffset&&!s&&"none"!==c}class Tu extends Wr.EventEmitter{constructor(e,t,n,i){var o;super(),this.metadataMuted=!1,this.encryption=Vi.NONE,this.log=Lr,this.handleMuted=()=>{this.emit(ds.Muted)},this.handleUnmuted=()=>{this.emit(ds.Unmuted)},this.log=Nr(null!==(o=null===i||void 0===i?void 0:i.loggerName)&&void 0!==o?o:Mr.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=Is.Source.Unknown}setTrack(e){this.track&&(this.track.off(ds.Muted,this.handleMuted),this.track.off(ds.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ds.Muted,this.handleMuted),e.on(ds.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Fc(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==Vi.NONE}get audioTrack(){if(wc(this.track))return this.track}get videoTrack(){if(Sc(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Is.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Is.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(Tu||(Tu={}));class Cu extends Tu{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ds.Ended)},this.handleCpuConstrained=()=>{this.track&&Sc(this.track)&&this.emit(ds.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&(this.track.off(ds.Ended,this.handleTrackEnded),this.track.off(ds.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ds.Ended,this.handleTrackEnded),e.on(ds.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return Fr(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return Fr(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return Fr(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return Fr(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(wc(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(Ni.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(Ni.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(Ni.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(Ni.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(Ni.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(Ni.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Eu(e,t){return Fr(this,void 0,void 0,function*(){null!==e&&void 0!==e||(e={});let n=!1;const{audioProcessor:i,videoProcessor:o,optionsWithoutProcessor:r}=Bc(e);let a=r.audio,s=r.video;if(i&&"object"===typeof r.audio&&(r.audio.processor=i),o&&"object"===typeof r.video&&(r.video.processor=o),e.audio&&"object"===typeof r.audio&&"string"===typeof r.audio.deviceId){const e=r.audio.deviceId;r.audio.deviceId={exact:e},n=!0,a=Object.assign(Object.assign({},r.audio),{deviceId:{ideal:e}})}if(r.video&&"object"===typeof r.video&&"string"===typeof r.video.deviceId){const e=r.video.deviceId;r.video.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},r.video),{deviceId:{ideal:e}})}(!0===r.audio||"object"===typeof r.audio&&!r.audio.deviceId)&&(r.audio={deviceId:"default"}),!0===r.video?r.video={deviceId:"default"}:"object"!==typeof r.video||r.video.deviceId||(r.video.deviceId="default");const c=Rc(r,Cl,El),l=Mc(c),u=navigator.mediaDevices.getUserMedia(l);r.audio&&(Wc.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Wc.userMediaPromiseMap.delete("audioinput"))),r.video&&(Wc.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Wc.userMediaPromiseMap.delete("videoinput")));try{const e=yield u;return yield Promise.all(e.getTracks().map(n=>Fr(this,void 0,void 0,function*(){const r="audio"===n.kind;let a,s=r?c.audio:c.video;"boolean"!==typeof s&&s||(s={});const u=r?l.audio:l.video;"boolean"!==typeof u&&(a=u);const d=n.getSettings().deviceId;(null===a||void 0===a?void 0:a.deviceId)&&gc(a.deviceId)!==d?a.deviceId=d:a||(a={deviceId:d});const h=function(e,t,n){switch(e.kind){case"audio":return new Bl(e,t,!1,void 0,n);case"video":return new $l(e,t,!1,n);default:throw new ms("unsupported track type: ".concat(e.kind))}}(n,a,t);return h.kind===Is.Kind.Video?h.source=Is.Source.Camera:h.kind===Is.Kind.Audio&&(h.source=Is.Source.Microphone),h.mediaStream=e,wc(h)&&i?yield h.setProcessor(i):Sc(h)&&o&&(yield h.setProcessor(o)),h})))}catch(Ut){if(!n)throw Ut;return Eu(Object.assign(Object.assign({},e),{audio:a,video:s}),t)}})}function xu(e){return Fr(this,void 0,void 0,function*(){return(yield Eu({audio:null===e||void 0===e||e,video:!1}))[0]})}var Pu,Ru;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(Pu||(Pu={}));class Iu extends Wr.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===Bi.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===Fi.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,o,r){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Bi.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Pu.Unknown,this.log=Lr,this.log=Nr(null!==(s=null===r||void 0===r?void 0:r.loggerName)&&void 0!==s?s:Mr.Participant),this.loggerOptions=r,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=null!==o&&void 0!==o?o:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new fc,this.once(ls.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Is.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Is.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Is.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Fi.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==Fi.ACTIVE&&this.emit(ls.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(ls.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ls.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],o={};for(const r of i)e[r]!==t[r]&&(o[r]=null!==(n=t[r])&&void 0!==n?n:"");return o}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ls.AttributesChanged,t)}setPermissions(e){var t,n,i,o,r,a;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(o=this.permissions)||void 0===o?void 0:o.hidden)||e.recorder!==(null===(r=this.permissions)||void 0===r?void 0:r.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||e.canSubscribeMetrics!==(null===(a=this.permissions)||void 0===a?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(ls.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ls.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case Ri.EXCELLENT:return Pu.Excellent;case Ri.GOOD:return Pu.Good;case Ri.POOR:return Pu.Poor;case Ri.LOST:return Pu.Lost;default:return Pu.Unknown}}(e),t!==this._connectionQuality&&this.emit(ls.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>wc(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(ds.Muted,()=>{this.emit(ls.TrackMuted,e)}),e.on(ds.Unmuted,()=>{this.emit(ls.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case Is.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case Is.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class Mu extends Iu{constructor(e,t,n,i,o,r){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Vi.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new fc)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var e,t,n,i,o,r;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(r=null===(o=this.activeAgentFuture)||void 0===o?void 0:o.reject)||void 0===r||r.call(o,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new fc),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,o=this.pendingSignalRequests.get(t);o&&(n!==br.OK&&o.reject(new bs(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=Ml.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let o=e.value.value;this.handleIncomingRpcAck(o.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new rr({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Fc(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Fc(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Fc(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(e,t)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Fc(t))),this.emit(ls.LocalTrackCpuConstrained,e,t)},this.handleSubscribedQualityUpdate=e=>Fr(this,void 0,void 0,function*(){var t,n,i,o,r;if(!(null===(r=this.roomOptions)||void 0===r?void 0:r.dynacast))return;const a=this.videoTrackPublications.get(e.trackSid);if(!a)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,u=zr(s);!(t=(c=yield u.next()).done);l=!0){o=c.value,l=!1;const e=o;As(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Fc(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(d){n={error:d}}finally{try{l||t||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Fr(this,void 0,void 0,function*(){if(e.source===Is.Source.ScreenShare||e.source===Is.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Fc(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(Cc(e)||Tc(e))try{if(Xs())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===Is.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Fc(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(Ut){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Fc(e))),Cc(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(Ut){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Fc(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=r}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Vi.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(us.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())}),(null===(t=this.signalConnectedFuture)||void 0===t?void 0:t.isResolved)&&(this.signalConnectedFuture=void 0),this.engine.on(us.Connected,this.handleReconnected).on(us.SignalConnected,this.handleSignalConnected).on(us.SignalRestarted,this.handleReconnected).on(us.SignalResumed,this.handleReconnected).on(us.Restarting,this.handleReconnecting).on(us.Resuming,this.handleReconnecting).on(us.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(us.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(us.Closing,this.handleClosing).on(us.SignalRequestResponse,this.handleSignalRequestResponse).on(us.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return Fr(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return Fr(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return Fr(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return Fr(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:i,attributes:o}=e;return function*(){return new Promise((e,r)=>Fr(t,void 0,void 0,function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!==n&&void 0!==n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!==i&&void 0!==i?i:this.name)&&void 0!==a?a:"",o),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{r(e),s=!0},values:{name:i,metadata:n,attributes:o}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!o||Object.entries(o).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(c),void e();yield qs(50)}r(new bs("Request to update local metadata timed out","TimeoutError"))}catch(Ut){Ut instanceof Error&&r(Ut)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(Is.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Is.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Is.Source.ScreenShare,e,t,n)}setE2EEEnabled(e){return Fr(this,void 0,void 0,function*(){this.encryptionType=e?Vi.GCM:Vi.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,n,i){return Fr(this,void 0,void 0,function*(){var o,r;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null===t||void 0===t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case Is.Source.Camera:t=yield this.createTracks({video:null===(o=n)||void 0===o||o});break;case Is.Source.Microphone:t=yield this.createTracks({audio:null===(r=n)||void 0===r||r});break;case Is.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new ms(e)}}catch(Ut){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),Ut instanceof Error&&this.emit(ls.MediaDevicesError,Ut,Dc(e)),this.pendingPublishing.delete(e),Ut}for(const i of t){const t=Object.assign(Object.assign({},this.roomOptions.publishDefaults),n);e===Is.Source.Microphone&&wc(i)&&t.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),i.startPreConnectBuffer())}try{const e=[];for(const o of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Fc(o))),e.push(this.publishTrack(o,i));const n=yield Promise.all(e);[a]=n}catch(Ut){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),Ut}finally{this.pendingPublishing.delete(e)}}else if(!(null===a||void 0===a?void 0:a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===Is.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrackPublication(Is.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return Fr(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(Is.Source.Camera)&&!this.pendingPublishing.has(Is.Source.Microphone)){this.pendingPublishing.add(Is.Source.Camera),this.pendingPublishing.add(Is.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(Is.Source.Camera),this.pendingPublishing.delete(Is.Source.Microphone)}}})}createTracks(e){return Fr(this,void 0,void 0,function*(){var t,n;null!==e&&void 0!==e||(e={});const i=Rc(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{const e=yield Eu(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return e.map(e=>(wc(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=Is.Source.Microphone,this.emit(ls.AudioStreamAcquired)),Sc(e)&&(this.cameraError=void 0,e.source=Is.Source.Camera),e))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return Fr(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new ps("getDisplayMedia not supported");void 0!==e.resolution||Ys()||(e.resolution=zs.h1080fps30.resolution);const t=Ac(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new ms("no video track found");const o=new $l(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=Is.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const r=[o];if(n.getAudioTracks().length>0){this.emit(ls.AudioStreamAcquired);const e=new Bl(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=Is.Source.ScreenShareAudio,r.push(e)}return r})}publishTrack(e,t){return Fr(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return Fr(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var o,r,a,s;let c,l;if(Cc(e)&&e.setAudioContext(n.audioContext),yield null===(o=n.reconnectFuture)||void 0===o?void 0:o.promise,n.republishPromise&&!i&&(yield n.republishPromise),kc(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case Is.Source.Microphone:t="audioinput";break;case Is.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new Bl(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new $l(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new ms("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(l=t)}),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),Fc(l))),l;const u=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t),d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,h=null!==(r=u.forceStereo)&&void 0!==r?r:d;h&&(void 0===u.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),Fc(e))),void 0===u.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=u.dtx)&&void 0!==a||(u.dtx=!1),null!==(s=u.red)&&void 0!==s||(u.red=!1)),!function(){const e=Ss(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&rc(e.osVersion,t)>=0)||"Safari"===e.name&&rc(e.version,t)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),u.simulcast=!1),u.source&&(e.source=u.source);const p=new Promise((t,i)=>Fr(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Yc.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Fc(e)}));const n=setTimeout(()=>{i(new ys("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const o=yield this.publish(e,u,h);t(o)}else try{const n=yield this.publish(e,u,h);t(n)}catch(Ut){i(Ut)}}catch(Ut){i(Ut)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(Ut){throw Ut}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new fc),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Fc(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>function(e){switch(e){case xi.CAMERA:return Is.Source.Camera;case xi.MICROPHONE:return Is.Source.Microphone;case xi.SCREEN_SHARE:return Is.Source.ScreenShare;case xi.SCREEN_SHARE_AUDIO:return Is.Source.ScreenShareAudio;default:return Is.Source.Unknown}}(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Fc(e))),!1)}publish(e,t,n){return Fr(this,void 0,void 0,function*(){var i,o,r,a,s,c,l,u,d,h;if(!this.hasPermissionsToPublish(e))throw new ys("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(t=>kc(e)&&t.source===e.source)&&e.source!==Is.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Fc(e))),t.stopMicTrackOnMute&&wc(e)&&(e.stopOnMute=!0),e.source===Is.Source.ScreenShare&&Ks()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Js()||Ks())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/av1"===n.mimeType.toLowerCase()){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(Ks())return!1;if(Js()){const e=Ss();if((null===e||void 0===e?void 0:e.version)&&rc(e.version,"16")<0)return!1;if("iOS"===(null===e||void 0===e?void 0:e.os)&&(null===e||void 0===e?void 0:e.osVersion)&&rc(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/vp9"===n.mimeType.toLowerCase()){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Sl),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>t.videoCodec===jc(e.mime))||(t.videoCodec=jc(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(ds.Muted,this.onTrackMuted),e.on(ds.Unmuted,this.onTrackUnmuted),e.on(ds.Ended,this.handleTrackEnded),e.on(ds.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ds.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ds.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const m=[],f=!(null===(i=t.dtx)||void 0===i||i),g=e.getSourceTrackSettings();g.autoGainControl&&m.push(Ni.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&m.push(Ni.TF_ECHO_CANCELLATION),g.noiseSuppression&&m.push(Ni.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&m.push(Ni.TF_STEREO),f&&m.push(Ni.TF_NO_DTX),Cc(e)&&e.hasPreConnectBuffer&&m.push(Ni.TF_PRECONNECT_BUFFER);const v=new Mo({cid:e.mediaStreamTrack.id,name:t.name,type:Is.kindToProto(e.kind),muted:e.isMuted,source:Is.sourceToProto(e.source),disableDtx:f,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(o=t.red)||void 0===o||o),stream:null===t||void 0===t?void 0:t.stream,backupCodecPolicy:null===t||void 0===t?void 0:t.backupCodecPolicy,audioFeatures:m});let y;if(e.kind===Is.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(Ut){const i=null!==(a=null===(r=this.roomOptions.videoCaptureDefaults)||void 0===r?void 0:r.resolution)&&void 0!==a?a:Fs.h720.resolution;n={width:i.width,height:i.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(e)),{dims:n}))}v.width=n.width,v.height=n.height,Tc(e)&&(Zs(p)&&(e.source===Is.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Fc(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),v.simulcastCodecs=[new Io({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Sl}),t.backupCodec&&p!==t.backupCodec.codec&&v.encryption===Vi.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new Io({codec:t.backupCodec.codec,cid:""})))),y=Gl(e.source===Is.Source.ScreenShare,v.width,v.height,t),v.layers=tu(v.width,v.height,y,Zs(t.videoCodec))}else e.kind===Is.Kind.Audio&&(y=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(u=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==u?u:"high",networkPriority:null!==(h=null===(d=t.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new gs("cannot publish track when not connected");const b=()=>Fr(this,void 0,void 0,function*(){var n,i,o;if(!this.engine.pcManager)throw new gs("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,y),this.emit(ls.LocalSenderCreated,e.sender,e),Tc(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===Is.Source.ScreenShare||e.constraints.height&&gc(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),y)if(Ks()&&e.kind===Is.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=y[0])||void 0===i?void 0:i.maxBitrate)?y[0].maxBitrate/1e3:0})}else e.codec&&Zs(e.codec)&&(null===(o=y[0])||void 0===o?void 0:o.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let _;const k=new Promise((t,n)=>Fr(this,void 0,void 0,function*(){var i;try{_=yield this.engine.addTrack(v),t(_)}catch(o){e.sender&&(null===(i=this.engine.pcManager)||void 0===i?void 0:i.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(e)),{error:t}))})),n(o)}}));if(this.enabledPublishVideoCodecs.length>0){const e=yield Promise.all([k,b()]);_=e[0]}else{let n;if(_=yield k,_.codecs.forEach(e=>{void 0===n&&(n=e.mimeType)}),n&&e.kind===Is.Kind.Video){const i=jc(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(e)),{codec:i})),t.videoCodec=i,y=Gl(e.source===Is.Source.ScreenShare,v.width,v.height,t))}yield b()}const w=new Cu(e.kind,_,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(w.on(ds.CpuConstrained,e=>this.onTrackCpuConstrained(e,w)),w.options=t,e.sid=_.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:_})),Tc(e)?e.startMonitor(this.engine.client):Cc(e)&&e.startMonitor(),this.addTrackPublication(w),this.emit(ls.LocalTrackPublished,w),Cc(e)&&_.audioFeatures.includes(Ni.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer(),n=e.getPreConnectBufferMimeType();if(this.on(ls.LocalTrackSubscribed,t=>{if(t.trackSid===_.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Fc(e))),e.stopPreConnectBuffer()}}),t){const i=new Promise((i,o)=>Fr(this,void 0,void 0,function*(){var r,a,s,c,l,u;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Fc(e)));const f=setTimeout(()=>{o(new Error("agent not active within 10 seconds"))},1e4),v=yield this.waitUntilActiveAgentPresent();clearTimeout(f),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Fc(e)));const y=yield this.streamBytes({name:"preconnect-buffer",mimeType:n,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[v.identity],attributes:{trackId:w.trackSid,sampleRate:String(null!==(l=g.sampleRate)&&void 0!==l?l:"48000"),channels:String(null!==(u=g.channelCount)&&void 0!==u?u:"1")}});try{for(var d,h=!0,p=zr(t);!(r=(d=yield p.next()).done);h=!0){c=d.value,h=!1;const e=c;yield y.write(e)}}catch(m){a={error:m}}finally{try{h||r||!(s=p.return)||(yield s.call(p))}finally{if(a)throw a.error}}yield y.close(),i()}catch(Ut){o(Ut)}}));i.then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Fc(e)))}).catch(t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(e)),{error:t}))})}}return w})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return Fr(this,void 0,void 0,function*(){var i;if(this.encryptionType!==Vi.NONE)return;let o;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(o=t)}),!o)throw new ms("track is not published");if(!Tc(e))throw new ms("track is not a video track");const r=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,o,r,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Lr.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(o=e.dimensions)||void 0===o?void 0:o.width,l=null!==(r=s.height)&&void 0!==r?r:null===(a=e.dimensions)||void 0===a?void 0:a.height;return e.source===Is.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Gl(e.source===Is.Source.ScreenShare,c,l,n)}(e,t,r);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Fc(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new Mo({cid:s.mediaStreamTrack.id,type:Is.kindToProto(e.kind),muted:e.isMuted,source:Is.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:r.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=tu(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new gs("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>Fr(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,s,r,a),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))})}unpublishTrack(e,t){return Fr(this,void 0,void 0,function*(){var n,i;if(kc(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Fc(e))),yield t)}const o=this.getPublicationForTrack(e),r=o?Fc(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),r)),!o||!o.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),r));(e=o.track).off(ds.Muted,this.onTrackMuted),e.off(ds.Unmuted,this.onTrackUnmuted),e.off(ds.Ended,this.handleTrackEnded),e.off(ds.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ds.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ds.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t?e.stop():e.stopMonitor();let a=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Rl.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(s)&&(a=!0),Tc(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(a=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(Ut){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),r),{error:Ut}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case Is.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case Is.Kind.Video:this.videoTrackPublications.delete(o.trackSid)}return this.emit(ls.LocalTrackUnpublished,o),o.setTrack(void 0),a&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return Fr(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((i,o)=>Fr(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>Fr(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),!n||t.isMuted||t.source===Is.Source.ScreenShare||t.source===Is.Source.ScreenShareAudio||!Cc(t)&&!Tc(t)||t.isUserProvided||(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),i()}catch(t){o(t)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return Fr(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?Ki.RELIABLE:Ki.LOSSY,o=n.destinationIdentities,r=n.topic;let a=new Xi({participantIdentity:t.identity,payload:e,destinationIdentities:o,topic:r});const s=new Gi({kind:i,value:{case:"user",value:a}});yield t.engine.sendDataPacket(s,i)}()})}publishDtmf(e,t){return Fr(this,void 0,void 0,function*(){const n=new Gi({kind:Ki.RELIABLE,value:{case:"sipDtmf",value:new eo({code:e,digit:t})}});yield this.engine.sendDataPacket(n,Ki.RELIABLE)})}sendChatMessage(e,t){return Fr(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null===t||void 0===t?void 0:t.attachments},i=new Gi({value:{case:"chatMessage",value:new io(Object.assign(Object.assign({},n),{timestamp:ln.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,Ki.RELIABLE),this.emit(ls.ChatMessage,n),n})}editChatMessage(e,t){return Fr(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new Gi({value:{case:"chatMessage",value:new io(Object.assign(Object.assign({},n),{timestamp:ln.parse(n.timestamp),editTimestamp:ln.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,Ki.RELIABLE),this.emit(ls.ChatMessage,n),n})}sendText(e,t){return Fr(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return Fr(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return Fr(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return Fr(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return Fr(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:i,payload:o,responseTimeout:r=15e3}=e;return function*(){return new Promise((e,a)=>Fr(t,void 0,void 0,function*(){var t,s,c,l;if(Ol(o)>15360)return void a(Ml.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&rc(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(Ml.builtIn("UNSUPPORTED_SERVER"));const u=Math.max(r,8e3),d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,o,u);const h=setTimeout(()=>{this.pendingAcks.delete(d),a(Ml.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(p)},7e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(h)},participantIdentity:n});const p=setTimeout(()=>{this.pendingResponses.delete(d),a(Ml.builtIn("RESPONSE_TIMEOUT"))},r);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(p),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(h)),n?a(n):e(null!==t&&void 0!==t?t:"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,o){return Fr(this,void 0,void 0,function*(){const r=new Gi({destinationIdentities:[e],kind:Ki.RELIABLE,value:{case:"rpcRequest",value:new oo({id:t,method:n,payload:i,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(r,Ki.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,Ml.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const o=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;o!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(i)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(e.sid,o))}}),!0)}setActiveAgent(e){var t,n,i,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(o=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===o||o.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new fc),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(Cc(i)||Tc(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}waitForPendingPublicationOfSource(e){return Fr(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield qs(20)}})}}class Ou extends Tu{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=e=>{this.setTrack(void 0),this.emit(ds.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new Bo({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new co({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ds.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Tu.SubscriptionStatus.Unsubscribed:super.isSubscribed?Tu.SubscriptionStatus.Subscribed:Tu.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Tu.PermissionStatus.Allowed:Tu.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){this.isManualOperationAllowed()&&this.requestedDisabled!==!e&&(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.requestedMaxQuality!==e&&(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(Pc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Pc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return null!==(e=this.requestedMaxQuality)&&void 0!==e?e:Rs.HIGH}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(ds.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(ds.VisibilityChanged,this.handleVisibilityChange),i.off(ds.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(ds.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ds.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ds.VisibilityChanged,this.handleVisibilityChange),e.on(ds.Ended,this.handleEnded),this.emit(ds.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(ds.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?ds.Muted:ds.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(ds.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ds.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Pc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new zo({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===Is.Kind.Video){let t=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(t){zc(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=function(e,t){var n;return null===(n=e.layers)||void 0===n?void 0:n.find(e=>e.quality===t)}(this.trackInfo,this.requestedMaxQuality);e&&zc(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Rs.HIGH})),e.quality=Rs.HIGH)}this.emit(ds.UpdateSettings,e)}}class Lu extends Iu{static fromParticipantInfo(e,t,n){return new Lu(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,o,r,a){super(t,n||"",i,o,r,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:Bi.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ds.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Fc(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(ds.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),e.on(ds.SubscriptionPermissionChanged,t=>{this.emit(ls.TrackSubscriptionPermissionChanged,e,t)}),e.on(ds.SubscriptionStatusChanged,t=>{this.emit(ls.TrackSubscriptionStatusChanged,e,t)}),e.on(ds.Subscribed,t=>{this.emit(ls.TrackSubscribed,t,e)}),e.on(ds.Unsubscribed,t=>{this.emit(ls.TrackUnsubscribed,t,e)}),e.on(ds.SubscriptionFailed,t=>{this.emit(ls.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Is.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Is.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,o,r){let a=this.getTrackPublicationBySid(t);if(a||t.startsWith("TR")||this.trackPublications.forEach(t=>{a||e.kind!==t.kind.toString()||(a=t)}),!a)return 0===r?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(ls.TrackSubscriptionFailed,t)):(void 0===r&&(r=20),void setTimeout(()=>{this.addSubscribedMediaTrack(e,t,n,i,o,r-1)},150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Fc(a))),void this.emit(ls.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new _u(e,t,i,o):new bu(e,t,i,this.audioContext,this.audioOutput),s.source=a.source,s.isMuted=a.isMuted,s.setMediaStream(n),s.start(),a.setTrack(s),this.volumeMap.has(a.source)&&Ec(s)&&wc(s)&&s.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach(e=>{var i,o;let r=this.getTrackPublicationBySid(e.sid);if(r)r.updateInfo(e);else{const t=Is.kindFromProto(e.type);if(!t)return;r=new Ou(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(o=this.loggerOptions)||void 0===o?void 0:o.loggerName}),r.updateInfo(e),n.set(e.sid,r);const a=Array.from(this.trackPublications.values()).find(e=>e.source===(null===r||void 0===r?void 0:r.source));a&&r.source!==Is.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(r.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Fc(a),newTrack:Fc(r)})),this.addTrackPublication(r)}t.set(e.sid,r)}),this.trackPublications.forEach(e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Fc(e))),this.unpublishTrack(e.trackSid,!0))}),n.forEach(e=>{this.emit(ls.TrackPublished,e)}),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case Is.Kind.Audio:this.audioTrackPublications.delete(e);break;case Is.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(ls.TrackUnpublished,n)}setAudioOutput(e){return Fr(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var i;wc(n.track)&&Ec(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(Ru||(Ru={}));class Nu extends Wr.EventEmitter{get hasE2EESetup(){return void 0!==this.e2eeManager}constructor(e){var t,n,i,o;if(super(),t=this,this.state=Ru.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Lr,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(e,t,n)=>Fr(this,void 0,void 0,function*(){var i;if("undefined"===typeof RTCPeerConnection||!Ws()&&!Hs())throw ec()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const o=yield this.disconnectLock.lock();if(this.state===Ru.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),o(),Promise.resolve();if(this.connectFuture)return o(),this.connectFuture.promise;this.setAndEmitConnectionState(Ru.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),tc(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new lu(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const r=(i,a,s)=>Fr(this,void 0,void 0,function*(){var c,l;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null===o||void 0===o||o();try{yield this.attemptConnection(null!==s&&void 0!==s?s:e,t,n,u),this.abortController=void 0,i()}catch(Ut){if(this.regionUrlProvider&&Ut instanceof hs&&Ut.reason!==os.Cancelled&&Ut.reason!==os.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(d){if(d instanceof hs&&(401===d.status||d.reason===os.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void a(d)}t&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(Ut.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield r(i,a,t)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,yc(Ut)),a(Ut))}else{let t=Mi.UNKNOWN_REASON;Ut instanceof hs&&(t=yc(Ut)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),a(Ut)}}}),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new fc((e,t)=>{r(e,t,a)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,i,o,r)=>Fr(this,void 0,void 0,function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===typeof o.adaptiveStream||o.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout,singlePeerConnection:o.singlePeerConnection},r.signal);let u=l.serverInfo;if(u||(u={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=u,this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!u.version)throw new fs("unknown server version");return"0.15.1"===u.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),o.dynacast=!1),l}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(Ut){this.log.error(Ut instanceof Error?Ut.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:Ut}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>Fr(this,void 0,void 0,function*(){var o,r;this.state===Ru.Reconnecting||this.isResuming||(null===(o=this.engine)||void 0===o?void 0:o.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(r=this.regionUrlProvider)||void 0===r?void 0:r.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Pl),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(cs.SignalConnected)}catch(a){yield this.engine.close(),this.recreateEngine();const e=new hs("could not establish signal connection",os.ServerUnreachable);throw a instanceof Error&&(e.message="".concat(e.message,": ").concat(a.message)),a instanceof hs&&(e.reason=a.reason,e.status=a.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:a})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new hs("Connection attempt aborted",os.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(Ut){throw yield this.engine.close(),this.recreateEngine(),Ut}Xs()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Xs()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ru.Connected),this.emit(cs.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Fr(t,[...n],void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,o,r;const a=yield e.disconnectLock.lock();try{if(e.state===Ru.Disconnected)return void e.log.debug("already disconnected",e.logContext);if(e.log.info("disconnect from room",Object.assign({},e.logContext)),e.state===Ru.Connecting||e.state===Ru.Reconnecting||e.isResuming){const t="Abort connection attempt due to user initiated disconnect";e.log.warn(t,e.logContext),null===(n=e.abortController)||void 0===n||n.abort(t),null===(o=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===o||o.call(i,new hs("Client initiated disconnect",os.Cancelled)),e.connectFuture=void 0}(null===(r=e.engine)||void 0===r?void 0:r.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Mi.CLIENT_INITIATED),e.engine=void 0}finally{a()}}()})},this.onPageLeave=()=>Fr(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>Fr(this,void 0,void 0,function*(){const e=[],t=Ss();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=mc();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(n),this.once(cs.Disconnected,()=>{null===n||void 0===n||n.remove(),n=null})}e.push(n)}this.remoteParticipants.forEach(t=>{t.audioTrackPublications.forEach(t=>{t.track&&t.track.attachedElements.forEach(t=>{e.push(t)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}),this.startVideo=()=>Fr(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(Ru.Reconnecting)&&this.emit(cs.Reconnecting)},this.handleSignalRestarted=e=>Fr(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(Ru.Connected),this.emit(cs.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===Fi.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach(e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}}),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=t,this.emitWhenConnected(cs.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach(e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)}),e.forEach(e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))});const n=Array.from(t.values());n.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=n,this.emitWhenConnected(cs.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach(e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=Is.streamStateFromProto(e.state);n.track.setStreamState(i),i!==n.track.streamState&&(t.emit(ls.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(cs.TrackStreamStateChanged,n,n.track.streamState,t))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=(e,t)=>{const n=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(n,e.value.value,e.kind,t);else if("transcription"===e.value.case)this.handleTranscription(n,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(n,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(n,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,n);else if("streamHeader"===e.value.case||"streamChunk"===e.value.case||"streamTrailer"===e.value.case)this.handleDataStream(e,t);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n,i)=>{this.emit(cs.DataReceived,t.payload,e,n,t.topic,i),null===e||void 0===e||e.emit(ls.DataReceived,t.payload,n,i)},this.handleSipDtmf=(e,t)=>{this.emit(cs.SipDTMFReceived,t,e),null===e||void 0===e||e.emit(ls.SipDTMFReceived,t)},this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null===n||void 0===n?void 0:n.trackPublications.get(t.trackId),o=function(e,t){return e.segments.map(e=>{let{id:n,text:i,language:o,startTime:r,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),u=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(r.toString()),endTime:Number.parseInt(a.toString()),final:s,language:o,firstReceivedTime:l,lastReceivedTime:u}})}(t,this.transcriptionReceivedTimes);null===i||void 0===i||i.emit(ds.TranscriptionReceived,o),null===n||void 0===n||n.emit(ls.TranscriptionReceived,o,i),this.emit(cs.TranscriptionReceived,o,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:o}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:i}}(t);this.emit(cs.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(cs.MetricsReceived,e,t)},this.handleDataStream=(e,t)=>{this.incomingDataStreamManager.handleDataStreamPacket(e,t)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(cs.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(cs.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(cs.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(cs.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Fr(this,void 0,void 0,function*(){var e;"iOS"!==(null===(e=Ss())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(cs.MediaDevicesChanged)}),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(cs.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(cs.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=e=>{this.emit(cs.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(cs.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(cs.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(cs.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(cs.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null===e||void 0===e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>Fr(this,void 0,void 0,function*(){var t,n,i,o,r,a;if(null===(t=e.track)||void 0===t||t.on(ds.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(ds.Restarted,this.onLocalTrackRestarted),null===(r=null===(o=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===o?void 0:o.onPublish)||void 0===r||r.call(o,this),this.emit(cs.LocalTrackPublished,e,this.localParticipant),Cc(e.track)){(yield e.track.checkForSilence())&&this.emit(cs.LocalAudioSilenceDetected,e)}const s=yield null===(a=e.track)||void 0===a?void 0:a.getDeviceId(!1),c=Dc(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(cs.ActiveDeviceChanged,c,s))}),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(ds.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(ds.Restarted,this.onLocalTrackRestarted),this.emit(cs.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>Fr(this,void 0,void 0,function*(){const t=yield e.getDeviceId(!1),n=Dc(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(cs.ActiveDeviceChanged,n,t))}),this.onLocalConnectionQualityChanged=e=>{this.emit(cs.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(cs.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(cs.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(cs.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},xl),e),this.log=Nr(null!==(n=this.options.loggerName)&&void 0!==n?n:Mr.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Cl),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},El),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Tl),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new pu,this.outgoingDataStreamManager=new vu(this.engine,this.log),this.disconnectLock=new Bt,this.localParticipant=new Mu("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",gc(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",gc(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",gc(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),Xs()){const e=new AbortController;null===(o=navigator.mediaDevices)||void 0===o||o.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),Nu.cleanupRegistry&&Nu.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return Fr(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var e;const t=!!this.options.encryption,n=this.options.encryption||this.options.e2ee;n&&("e2eeManager"in n?(this.e2eeManager=n.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=t):this.e2eeManager=new Vc(n,t),this.e2eeManager.on(Xa.ParticipantEncryptionStatusChanged,(e,t)=>{(function(e){return e.isLocal})(t)&&(this.isE2EEEnabled=e),this.emit(cs.ParticipantEncryptionStatusChanged,e,t)}),this.e2eeManager.on(Xa.EncryptionError,e=>this.emit(cs.EncryptionError,e)),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return Fr(this,void 0,void 0,function*(){return this.state===Ru.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(us.RoomUpdate,n),e(t.sid))};this.engine.on(us.RoomUpdate,n),this.once(cs.Disconnected,()=>{this.engine.off(us.RoomUpdate,n),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new au(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(us.ParticipantUpdate,this.handleParticipantUpdates).on(us.RoomUpdate,this.handleRoomUpdate).on(us.SpeakersChanged,this.handleSpeakersChanged).on(us.StreamStateChanged,this.handleStreamStateUpdate).on(us.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(us.SubscriptionError,this.handleSubscriptionError).on(us.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(us.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(us.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(us.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(us.DataPacketReceived,this.handleDataPacket).on(us.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ru.SignalReconnecting)&&this.emit(cs.SignalReconnecting)}).on(us.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ru.Connected)&&this.emit(cs.Reconnected)}).on(us.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ru.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(us.Restarting,this.handleRestarting).on(us.SignalRestarted,this.handleSignalRestarted).on(us.Offline,()=>{this.setAndEmitConnectionState(Ru.Reconnecting)&&this.emit(cs.Reconnecting)}).on(us.DCBufferStatusChanged,(e,t)=>{this.emit(cs.DCBufferStatusChanged,e,t)}).on(us.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(t=>{let{trackSid:n}=t;return n===e});t?(this.localParticipant.emit(ls.LocalTrackSubscribed,t),this.emitWhenConnected(cs.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(us.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(cs.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Wc.getInstance().getDevices(e,t)}prepareConnection(e,t){return Fr(this,void 0,void 0,function*(){if(this.state===Ru.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(tc(new URL(e))&&t){this.regionUrlProvider=new lu(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===Ru.Disconnected&&(this.regionUrl=n,yield fetch(vc(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(vc(e),{method:"HEAD"})}catch(Ut){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:Ut}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Fr(this,void 0,void 0,function*(){let n,i=()=>Fr(this,void 0,void 0,function*(){});switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new hr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new hr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new hr({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new hr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Fr(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new hr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Fr(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new hr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new hr({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Fr(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new Wo({reason:Mi.CLIENT_INITIATED,action:Ho.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new hr({scenario:{case:"subscriberBandwidth",value:_c(t)}});break;case"leave-full-reconnect":n=new hr({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return Fr(this,arguments,void 0,function(e,t){var n=this;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var o,r,a,s,c,l,u;let d=!0,h=!1;const p=i?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter(e=>e.source===Is.Source.Microphone);try{d=(yield Promise.all(i.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(Ut){throw n.options.audioCaptureDefaults.deviceId=t,Ut}const r=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&r&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter(e=>e.source===Is.Source.Camera);try{d=(yield Promise.all(i.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(Ut){throw n.options.videoCaptureDefaults.deviceId=t,Ut}const o=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&o&&(h=!0)}else if("audiooutput"===e){if(h=!0,!Gs()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");n.options.webAudioMix&&(t=null!==(a=yield Wc.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==a?a:""),null!==(s=(u=n.options).audioOutput)&&void 0!==s||(u.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:t})))}catch(Ut){throw n.options.audioOutput.deviceId=i,Ut}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(cs.ActiveDeviceChanged,e,t)),d}()})}setupLocalParticipantEvents(){this.localParticipant.on(ls.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ls.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ls.AttributesChanged,this.onLocalAttributesChanged).on(ls.TrackMuted,this.onLocalTrackMuted).on(ls.TrackUnmuted,this.onLocalTrackUnmuted).on(ls.LocalTrackPublished,this.onLocalTrackPublished).on(ls.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ls.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ls.MediaDevicesError,this.onMediaDevicesError).on(ls.AudioStreamAcquired,this.startAudio).on(ls.ChatMessage,this.onLocalChatMessageSent).on(ls.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===Ru.Connecting||this.state===Ru.Reconnecting){const i=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:t.id,tracksInStream:t.getTracks().map(e=>e.id)}),this.onTrackAdded(e,t,n),o()},o=()=>{this.off(cs.Reconnected,i),this.off(cs.Connected,i),this.off(cs.Disconnected,o)};return this.once(cs.Reconnected,i),this.once(cs.Connected,i),void this.once(cs.Disconnected,o)}if(this.state===Ru.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),o=i[0];let r=i[1],a=e.id;if(r&&r.startsWith("TR")&&(a=r),o===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find(e=>e.sid===o);if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);if(!a.startsWith("TR")){const e=this.engine.getTrackIdForReceiver(n);if(!e)return void this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);a=e}let c;a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(r,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:r,trackId:a})),this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{});const l=s.addSubscribedMediaTrack(e,a,t,n,c);(null===l||void 0===l?void 0:l.isEncrypted)&&!this.e2eeManager&&this.emit(cs.EncryptionError,new Error("Encrypted ".concat(l.source," track received from participant ").concat(s.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==Ru.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(t=>{var n,i,o;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop()):null===(o=t.track)||void 0===o||o.stopMonitor()}),this.localParticipant.off(ls.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ls.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ls.AttributesChanged,this.onLocalAttributesChanged).off(ls.TrackMuted,this.onLocalTrackMuted).off(ls.TrackUnmuted,this.onLocalTrackUnmuted).off(ls.LocalTrackPublished,this.onLocalTrackPublished).off(ls.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ls.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ls.MediaDevicesError,this.onMediaDevicesError).off(ls.AudioStreamAcquired,this.startAudio).off(ls.ChatMessage,this.onLocalChatMessageSent).off(ls.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Xs()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ru.Disconnected),this.emit(cs.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(e=>{t.unpublishTrack(e.trackSid,!0)}),this.emit(cs.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,n,i,o,r){return Fr(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==r)return void(yield this.engine.publishRpcResponse(e,t,null,Ml.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.engine.publishRpcResponse(e,t,null,Ml.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const r=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:o});Ol(r)>15360?(s=Ml.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=r}catch(l){l instanceof Ml?s=l:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),l),s=Ml.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)})}selectDefaultDevices(){return Fr(this,void 0,void 0,function*(){var e,t,n;const i=Wc.getInstance().previousDevices,o=yield Wc.getInstance().getDevices(void 0,!1),r=Ss();if("Chrome"===(null===r||void 0===r?void 0:r.name)&&"iOS"!==r.os)for(let s of o){const e=i.find(e=>e.deviceId===s.deviceId);e&&""!==e.label&&e.kind===s.kind&&e.label!==s.label&&"default"===this.getActiveDevice(s.kind)&&this.emit(cs.ActiveDeviceChanged,s.kind,s.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let s of a){const r=Nc(s),a=this.localParticipant.getTrackPublication(r);if(a&&(null===(e=a.track)||void 0===e?void 0:e.isUserProvided))continue;const c=o.filter(e=>e.kind===s),l=this.getActiveDevice(s);l===(null===(t=i.filter(e=>e.kind===s)[0])||void 0===t?void 0:t.deviceId)&&c.length>0&&(null===(n=c[0])||void 0===n?void 0:n.deviceId)!==l?yield this.switchActiveDevice(s,c[0].deviceId):"audioinput"===s&&!Qs()||"videoinput"===s||!(c.length>0)||c.find(e=>e.deviceId===this.getActiveDevice(s))||"audiooutput"===s&&Qs()||(yield this.switchActiveDevice(s,c[0].deviceId))}})}acquireAudioContext(){return Fr(this,void 0,void 0,function*(){var e,t;if("boolean"!==typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=Lc())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),qs(200)])}catch(Ut){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:Ut}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(cs.AudioPlaybackStatusChanged,n))})}createParticipant(e,t){var n;let i;return i=t?Lu.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new Lu(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(cs.ParticipantConnected,n),n.on(ls.TrackPublished,e=>{this.emitWhenConnected(cs.TrackPublished,e,n)}).on(ls.TrackSubscribed,(e,t)=>{e.kind===Is.Kind.Audio?(e.on(ds.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(ds.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===Is.Kind.Video&&(e.on(ds.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(ds.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(cs.TrackSubscribed,e,t,n)}).on(ls.TrackUnpublished,e=>{this.emit(cs.TrackUnpublished,e,n)}).on(ls.TrackUnsubscribed,(e,t)=>{this.emit(cs.TrackUnsubscribed,e,t,n)}).on(ls.TrackMuted,e=>{this.emitWhenConnected(cs.TrackMuted,e,n)}).on(ls.TrackUnmuted,e=>{this.emitWhenConnected(cs.TrackUnmuted,e,n)}).on(ls.ParticipantMetadataChanged,e=>{this.emitWhenConnected(cs.ParticipantMetadataChanged,e,n)}).on(ls.ParticipantNameChanged,e=>{this.emitWhenConnected(cs.ParticipantNameChanged,e,n)}).on(ls.AttributesChanged,e=>{this.emitWhenConnected(cs.ParticipantAttributesChanged,e,n)}).on(ls.ConnectionQualityChanged,e=>{this.emitWhenConnected(cs.ConnectionQualityChanged,e,n)}).on(ls.ParticipantPermissionsChanged,e=>{this.emitWhenConnected(cs.ParticipantPermissionsChanged,e,n)}).on(ls.TrackSubscriptionStatusChanged,(e,t)=>{this.emitWhenConnected(cs.TrackSubscriptionStatusChanged,e,t,n)}).on(ls.TrackSubscriptionFailed,(e,t)=>{this.emit(cs.TrackSubscriptionFailed,e,n,t)}).on(ls.TrackSubscriptionPermissionChanged,(e,t)=>{this.emitWhenConnected(cs.TrackSubscriptionPermissionChanged,e,t,n)}).on(ls.Active,()=>{this.emitWhenConnected(cs.ParticipantActive,n),n.kind===Bi.AGENT&&this.localParticipant.setActiveAgent(n)}),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&xc(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=xs.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Mi.STATE_MISMATCH)))},4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&xs.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(cs.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===Ru.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===Ru.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return Fr(this,void 0,void 0,function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Di({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ln.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ui({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(cs.SignalConnected),this.emit(cs.Connected),this.setAndEmitConnectionState(Ru.Connected),i.video){const e=new Cu(Is.Kind.Video,new Wi({source:xi.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Ei.AUDIO,name:"video-dummy"}),new $l(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:pc(160*(null!==(t=o.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ls.LocalTrackPublished,e)}if(i.audio){const e=new Cu(Is.Kind.Audio,new Wi({source:xi.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Ei.AUDIO}),new Bl(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:mc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ls.LocalTrackPublished,e)}for(let e=0;e<o.count-1;e+=1){let t=new Ui({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:Fi.ACTIVE,tracks:[],joinedAt:ln.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(o.video){const r=pc(160*(null!==(n=o.aspectRatios[e%o.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),a=new Wi({source:xi.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:Ei.AUDIO});i.addSubscribedMediaTrack(r,a.sid,new MediaStream([r]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(o.audio){const e=mc(),n=new Wi({source:xi.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:Ei.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==cs.ActiveSpeakersChanged&&e!==cs.TranscriptionReceived){const t=Du(n).filter(e=>void 0!==e);e!==cs.TrackSubscribed&&e!==cs.TrackUnsubscribed||this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function Du(e){return e.map(e=>{if(e)return Array.isArray(e)?Du(e):"object"===typeof e?"logContext"in e?e.logContext:void 0:e})}Nu.cleanupRegistry="undefined"!==typeof FinalizationRegistry&&new FinalizationRegistry(e=>{e()});var Au;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(Au||(Au={}));Wr.EventEmitter;Wr.EventEmitter;function ju(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}new TextEncoder;new TextDecoder;class Uu extends Error{constructor(e,t){var n;super(e,t),ju(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null===(n=Error.captureStackTrace)||void 0===n||n.call(Error,this,this.constructor)}}ju(Uu,"code","ERR_JOSE_GENERIC");ju(class extends Uu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:n,reason:i,payload:t}}),ju(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ju(this,"claim",void 0),ju(this,"reason",void 0),ju(this,"payload",void 0),this.claim=n,this.reason=i,this.payload=t}},"code","ERR_JWT_CLAIM_VALIDATION_FAILED");ju(class extends Uu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:n,reason:i,payload:t}}),ju(this,"code","ERR_JWT_EXPIRED"),ju(this,"claim",void 0),ju(this,"reason",void 0),ju(this,"payload",void 0),this.claim=n,this.reason=i,this.payload=t}},"code","ERR_JWT_EXPIRED");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}},"code","ERR_JOSE_ALG_NOT_ALLOWED");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JOSE_NOT_SUPPORTED")}},"code","ERR_JOSE_NOT_SUPPORTED");ju(class extends Uu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),ju(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JWS_INVALID")}},"code","ERR_JWS_INVALID");class Fu extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JWT_INVALID")}}ju(Fu,"code","ERR_JWT_INVALID");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");ju(class extends Uu{constructor(){super(...arguments),ju(this,"code","ERR_JWKS_INVALID")}},"code","ERR_JWKS_INVALID");ju(class extends Uu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),ju(this,"code","ERR_JWKS_NO_MATCHING_KEY")}},"code","ERR_JWKS_NO_MATCHING_KEY");ju(class extends Uu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),ju(this,Symbol.asyncIterator,void 0),ju(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}},"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");ju(class extends Uu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),ju(this,"code","ERR_JWKS_TIMEOUT")}},"code","ERR_JWKS_TIMEOUT");ju(class extends Uu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),ju(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}},"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function Bu(){return Bu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bu.apply(null,arguments)}const zu=new Uint8Array(0);class Vu{static getFullOptions(e){return Bu({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,t){var n=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(e){"connected"!==n.status&&"connecting"!==n.status||(n.updateStatus("disconnecting"),await n.handleEndSession(),n.updateStatus("disconnected"),n.options.onDisconnect&&n.options.onDisconnect(e))},this.onMessage=async function(e){switch(e.type){case"interruption":return void n.handleInterruption(e);case"agent_response":return void n.handleAgentResponse(e);case"user_transcript":return void n.handleUserTranscript(e);case"internal_tentative_agent_response":return void n.handleTentativeAgentResponse(e);case"client_tool_call":try{await n.handleClientToolCall(e)}catch(t){n.onError("Unexpected error in client tool call handling: ".concat(t instanceof Error?t.message:String(t)),{clientToolName:e.client_tool_call.tool_name,toolCallId:e.client_tool_call.tool_call_id})}return;case"audio":return void n.handleAudio(e);case"vad_score":return void n.handleVadScore(e);case"ping":return void n.connection.sendMessage({type:"pong",event_id:e.ping_event.event_id});case"mcp_tool_call":return void n.handleMCPToolCall(e);case"mcp_connection_status":return void n.handleMCPConnectionStatus(e);case"agent_tool_response":return void n.handleAgentToolResponse(e);case"conversation_initiation_metadata":return void n.handleConversationMetadata(e);case"asr_initiation_metadata":return void n.handleAsrInitiationMetadata(e);case"agent_chat_response_part":return void n.handleAgentChatResponsePart(e);default:return void(n.options.onDebug&&n.options.onDebug(e))}},this.setVolume=e=>{let{volume:t}=e;this.volume=t},this.options=e,this.connection=t,this.options.onConnect&&this.options.onConnect({conversationId:t.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(e=>this.updateMode(e)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var t;const n=null!=(t=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))?t:"Client tool execution successful.",i="object"==typeof n?JSON.stringify(n):String(n);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:i,is_error:!1})}catch(t){this.onError("Client tool execution failed with following error: ".concat(null==t?void 0:t.message),{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:"Client tool execution failed: ".concat(null==t?void 0:t.message),is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError("Client tool with name ".concat(e.client_tool_call.tool_name," is not defined on client"),{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:"Client tool with name ".concat(e.client_tool_call.tool_name," is not defined on client"),is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolResponse(e){this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}onError(e,t){console.error(e,t),this.options.onError&&this.options.onError(e,t)}getId(){return this.connection.conversationId}isOpen(){return"connected"===this.status}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return zu}getOutputByteFrequencyData(){return zu}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(0===this.lastFeedbackEventId?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,t){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:t})}}class qu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const t=this.queue;this.queue=[],t.length>0&&queueMicrotask(()=>{t.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const t=this.disconnectionDetails;t&&queueMicrotask(()=>{e(t)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var t;null==(t=this.onModeChangeCallback)||t.call(this,e)}disconnect(e){var t;this.disconnectionDetails||(this.disconnectionDetails=e,null==(t=this.onDisconnectCallback)||t.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Wu(e){const[t,n]=e.split("_");if(!["pcm","ulaw"].includes(t))throw new Error("Invalid format: ".concat(e));const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error("Invalid sample rate: ".concat(n));return{format:t,sampleRate:i}}const Hu="0.8.0";function Zu(e){return!!e.type}const Gu="conversation_initiation_client_data";function Ku(e){var t;const n={type:Gu};var i,o,r,a,s;return e.overrides&&(n.conversation_config_override={agent:{prompt:null==(i=e.overrides.agent)?void 0:i.prompt,first_message:null==(o=e.overrides.agent)?void 0:o.firstMessage,language:null==(r=e.overrides.agent)?void 0:r.language},tts:{voice_id:null==(a=e.overrides.tts)?void 0:a.voiceId},conversation:{text_only:null==(s=e.overrides.conversation)?void 0:s.textOnly}}),e.customLlmExtraBody&&(n.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(n.dynamic_variables=e.dynamicVariables),e.userId&&(n.user_id=e.userId),null!=(t=e.overrides)&&t.client&&(n.source_info={source:e.overrides.client.source,version:e.overrides.client.version}),n}class Ju extends qu{constructor(e,t,n,i){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=i,this.socket.addEventListener("error",e=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:e}),0)}),this.socket.addEventListener("close",e=>{this.disconnect(1e3===e.code?{reason:"agent",context:e}:{reason:"error",message:e.reason||"The connection was closed by the server.",context:e})}),this.socket.addEventListener("message",e=>{try{const t=JSON.parse(e.data);if(!Zu(t))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:e.data});this.handleMessage(t)}catch(t){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:t instanceof Error?t.message:String(t),data:e.data})}})}static async create(e){let t=null;try{var n,i,o;const r=null!=(n=e.origin)?n:"wss://api.elevenlabs.io";let a;const s=(null==(i=e.overrides)||null==(i=i.client)?void 0:i.version)||Hu,c=(null==(o=e.overrides)||null==(o=o.client)?void 0:o.source)||"js_sdk";if(e.signedUrl){const t=e.signedUrl.includes("?")?"&":"?";a="".concat(e.signedUrl).concat(t,"source=").concat(c,"&version=").concat(s)}else a="".concat(r,"/v1/convai/conversation?agent_id=").concat(e.agentId,"&source=").concat(c,"&version=").concat(s);const l=["convai"];e.authorization&&l.push("bearer.".concat(e.authorization)),t=new WebSocket(a,l);const u=await new Promise((n,i)=>{t.addEventListener("open",()=>{var n;const i=Ku(e);null==(n=t)||n.send(JSON.stringify(i))},{once:!0}),t.addEventListener("error",e=>{setTimeout(()=>i(e),0)}),t.addEventListener("close",i),t.addEventListener("message",e=>{const t=JSON.parse(e.data);Zu(t)&&("conversation_initiation_metadata"===t.type?n(t.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:d,agent_output_audio_format:h,user_input_audio_format:p}=u,m=Wu(null!=p?p:"pcm_16000"),f=Wu(h);return new Ju(t,d,m,f)}catch(e){var r;throw null==(r=t)||r.close(),e}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn("WebSocket connection setMicMuted called with ".concat(e,", but this is handled by VoiceConversation"))}}function Qu(e){const t=new Uint8Array(e);return window.btoa(String.fromCharCode(...t))}function Yu(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=t.charCodeAt(o);return i.buffer}const $u=new Map;function Xu(e,t){return async(n,i)=>{const o=$u.get(e);if(o)return n.addModule(o);if(i)try{return await n.addModule(i),void $u.set(e,i)}catch(t){throw new Error("Failed to load the ".concat(e," worklet module from path: ").concat(i,". Error: ").concat(t))}const r=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(r);try{return await n.addModule(a),void $u.set(e,a)}catch(e){URL.revokeObjectURL(a)}try{const i="data:application/javascript;base64,".concat(btoa(t));await n.addModule(i),$u.set(e,i)}catch(t){throw new Error("Failed to load the ".concat(e," worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files."))}}}const ed=Xu("rawAudioProcessor",'/*\n * ulaw encoding logic taken from the wavefile library\n * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js\n * USED BY @elevenlabs/client\n */\n\nconst BIAS = 0x84;\nconst CLIP = 32635;\nconst encodeTable = [\n  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,\n  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7\n];\n\nfunction encodeSample(sample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let muLawSample;\n  sign = (sample >> 8) & 0x80;\n  if (sign !== 0) sample = -sample;\n  sample = sample + BIAS;\n  if (sample > CLIP) sample = CLIP;\n  exponent = encodeTable[(sample>>7) & 0xFF];\n  mantissa = (sample >> (exponent+3)) & 0x0F;\n  muLawSample = ~(sign | (exponent << 4) | mantissa);\n  \n  return muLawSample;\n}\n\nclass RawAudioProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n              \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.isMuted = false;\n          this.buffer = []; // Initialize an empty buffer\n          this.bufferSize = data.sampleRate / 4;\n          this.format = data.format;\n\n          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {\n            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {\n              this.resampler = resampler;\n            });\n          }\n          break;\n        case "setMuted":\n          this.isMuted = data.isMuted;\n          break;\n      }\n    };\n  }\n  process(inputs) {\n    if (!this.buffer) {\n      return true;\n    }\n    \n    const input = inputs[0]; // Get the first input node\n    if (input.length > 0) {\n      let channelData = input[0]; // Get the first channel\'s data\n\n      // Resample the audio if necessary\n      if (this.resampler) {\n        channelData = this.resampler.full(channelData);\n      }\n\n      // Add channel data to the buffer\n      this.buffer.push(...channelData);\n      // Get max volume \n      let sum = 0.0;\n      for (let i = 0; i < channelData.length; i++) {\n        sum += channelData[i] * channelData[i];\n      }\n      const maxVolume = Math.sqrt(sum / channelData.length);\n      // Check if buffer size has reached or exceeded the threshold\n      if (this.buffer.length >= this.bufferSize) {\n        const float32Array = this.isMuted \n          ? new Float32Array(this.buffer.length)\n          : new Float32Array(this.buffer);\n\n        let encodedArray = this.format === "ulaw"\n          ? new Uint8Array(float32Array.length)\n          : new Int16Array(float32Array.length);\n\n        // Iterate through the Float32Array and convert each sample to PCM16\n        for (let i = 0; i < float32Array.length; i++) {\n          // Clamp the value to the range [-1, 1]\n          let sample = Math.max(-1, Math.min(1, float32Array[i]));\n\n          // Scale the sample to the range [-32768, 32767]\n          let value = sample < 0 ? sample * 32768 : sample * 32767;\n          if (this.format === "ulaw") {\n            value = encodeSample(Math.round(value));\n          }\n\n          encodedArray[i] = value;\n        }\n\n        // Send the buffered data to the main script\n        this.port.postMessage([encodedArray, maxVolume]);\n\n        // Clear the buffer after sending\n        this.buffer = [];\n      }\n    }\n    return true; // Continue processing\n  }\n}\nregisterProcessor("rawAudioProcessor", RawAudioProcessor);\n');class td extends qu{constructor(e,t,n,i){super(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=i,this.setupRoomEventListeners()}static async create(e){let t;if("conversationToken"in e&&e.conversationToken)t=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var n,i,o;const a=(null==(n=e.overrides)||null==(n=n.client)?void 0:n.version)||Hu,s=(null==(i=e.overrides)||null==(i=i.client)?void 0:i.source)||"js_sdk",c="".concat((r=null!=(o=e.origin)?o:"https://api.elevenlabs.io",r.replace(/^wss:\/\//,"https://")),"/v1/convai/conversation/token?agent_id=").concat(e.agentId,"&source=").concat(s,"&version=").concat(a),l=await fetch(c);if(!l.ok)throw new Error("ElevenLabs API returned ".concat(l.status," ").concat(l.statusText));if(t=(await l.json()).token,!t)throw new Error("No conversation token received from API")}catch(Ut){let n=Ut instanceof Error?Ut.message:String(Ut);throw Ut instanceof Error&&Ut.message.includes("401")&&(n="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error("Failed to fetch conversation token for agent ".concat(e.agentId,": ").concat(n))}}var r;const a=new Nu;try{const n="room_".concat(Date.now()),i=Wu("pcm_48000"),o=Wu("pcm_48000"),r=new td(a,n,i,o,e),c=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var s;await a.connect(c,t),await new Promise(e=>{if(r.isConnected)e();else{const t=()=>{a.off(cs.Connected,t),e()};a.on(cs.Connected,t)}}),a.name&&(r.conversationId=(null==(s=a.name.match(/(conv_[a-zA-Z0-9]+)/))?void 0:s[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const l=Ku(e);return r.debug({type:Gu,message:l}),await r.sendMessage(l),r}catch(Ut){throw await a.disconnect(),Ut}}setupRoomEventListeners(){var e=this;this.room.on(cs.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(cs.Disconnected,e=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:null==e?void 0:e.toString()})})}),this.room.on(cs.ConnectionStateChanged,e=>{e===Ru.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:"LiveKit connection state changed to ".concat(e),context:new Event("connection_state_changed")}))}),this.room.on(cs.DataReceived,(e,t)=>{try{const t=JSON.parse((new TextDecoder).decode(e));if("audio"===t.type)return;Zu(t)?this.handleMessage(t):console.warn("Invalid socket event received:",t)}catch(t){console.warn("Failed to parse incoming data message:",t),console.warn("Raw payload:",(new TextDecoder).decode(e))}}),this.room.on(cs.TrackSubscribed,async function(t,n,i){if(t.kind===Is.Kind.Audio&&i.identity.includes("agent")){const n=t,i=n.attach();if(i.autoplay=!0,i.controls=!1,e.outputDeviceId&&i.setSinkId)try{await i.setSinkId(e.outputDeviceId)}catch(e){console.warn("Failed to set output device for new audio element:",e)}i.style.display="none",document.body.appendChild(i),e.audioElements.push(i),1===e.audioElements.length&&(null==e.onDebug||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(n)}}),this.room.on(cs.ActiveSpeakersChanged,async function(t){e.updateMode(t.length>0&&t[0].identity.startsWith("agent")?"speaking":"listening")})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(Ut){console.warn("Error stopping local tracks:",Ut)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const t=(new TextEncoder).encode(JSON.stringify(e));await this.room.localParticipant.publishData(t,{reliable:!0})}catch(hd){this.debug({type:"send_message_error",message:{message:e,error:hd}}),console.error("Failed to send message via WebRTC:",hd)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const t=this.room.localParticipant.getTrackPublication(Is.Source.Microphone);if(null!=t&&t.track)try{e?await t.track.mute():await t.track.unmute()}catch(t){await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const t=new AudioContext;this.audioCaptureContext=t,this.outputAnalyser=t.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const n=new MediaStream([e.mediaStreamTrack]),i=t.createMediaStreamSource(n);i.connect(this.outputAnalyser),await ed(t.audioWorklet);const o=new AudioWorkletNode(t,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=e=>{const[t,n]=e.data;if(n>.01){const e=Qu(t.buffer),n=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:e,event_id:n}})}},i.connect(o)}catch(e){console.warn("Failed to set up audio capture:",e)}}setAudioVolume(e){this.audioElements.forEach(t=>{t.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const t=this.audioElements.map(async function(t){try{await t.setSinkId(e)}catch(e){throw console.error("Failed to set sink ID for audio element:",e),e}});await Promise.all(t),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const t=this.room.localParticipant.getTrackPublication(Is.Source.Microphone);null!=t&&t.track&&(await t.track.stop(),await this.room.localParticipant.unpublishTrack(t.track));const n={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},i=await xu(n);await this.room.localParticipant.publishTrack(i,{name:"microphone",source:Is.Source.Microphone})}catch(e){console.error("Failed to change input device:",e);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(e){console.error("Failed to recover microphone after device switch error:",e)}throw e}}getOutputByteFrequencyData(){return this.outputAnalyser?(null!=this.outputFrequencyData||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function nd(e){const t=function(e){return e.connectionType?e.connectionType:"conversationToken"in e&&e.conversationToken?"webrtc":"websocket"}(e);switch(t){case"websocket":return Ju.create(e);case"webrtc":return td.create(e);default:throw new Error("Unknown connection type: ".concat(t))}}function id(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function od(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{default:0,android:3e3},t=e.default;var n;if(/android/i.test(navigator.userAgent))t=null!=(n=e.android)?n:t;else if(id()){var i;t=null!=(i=e.ios)?i:t}t>0&&await new Promise(e=>setTimeout(e,t))}class rd extends Vu{static async startSession(e){const t=Vu.getFullOptions(e);t.onStatusChange&&t.onStatusChange({status:"connecting"}),t.onCanSendFeedbackChange&&t.onCanSendFeedbackChange({canSendFeedback:!1}),t.onModeChange&&t.onModeChange({mode:"listening"}),t.onCanSendFeedbackChange&&t.onCanSendFeedbackChange({canSendFeedback:!1});let n=null;try{return await od(t.connectionDelay),n=await nd(e),new rd(t,n)}catch(e){var i;throw t.onStatusChange&&t.onStatusChange({status:"disconnected"}),null==(i=n)||i.close(),e}}}const ad={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class sd{static async create(e){let{sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:o,workletPaths:r,libsampleratePath:a}=e,s=null,c=null;try{const e=Bu({sampleRate:{ideal:t}},ad);if(id()&&i){const t=(await window.navigator.mediaDevices.enumerateDevices()).find(e=>"audioinput"===e.kind&&["airpod","headphone","earphone"].find(t=>e.label.toLowerCase().includes(t)));t&&(e.deviceId={ideal:t.deviceId})}o&&(e.deviceId={exact:o});const l=navigator.mediaDevices.getSupportedConstraints().sampleRate;s=new window.AudioContext(l?{sampleRate:t}:{});const u=s.createAnalyser();if(!l){const e=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await s.audioWorklet.addModule(e)}await ed(s.audioWorklet,null==r?void 0:r.rawAudioProcessor);const d=Bu({voiceIsolation:!0},e);c=await navigator.mediaDevices.getUserMedia({audio:d});const h=s.createMediaStreamSource(c),p=new AudioWorkletNode(s,"rawAudioProcessor");return p.port.postMessage({type:"setFormat",format:n,sampleRate:t}),h.connect(u),u.connect(p),await s.resume(),new sd(s,u,p,c,h)}catch(t){var l,u;throw null==(l=c)||l.getTracks().forEach(e=>{e.stop()}),null==(u=s)||u.close(),t}}constructor(e,t,n,i,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=t,this.worklet=n,this.inputStream=i,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const t=Bu({},ad);e&&(t.deviceId={exact:e});const n=Bu({voiceIsolation:!0},t),i=await navigator.mediaDevices.getUserMedia({audio:n});this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=i,this.mediaStreamSource=this.context.createMediaStreamSource(i),this.mediaStreamSource.connect(this.analyser)}catch(e){throw console.error("Failed to switch input device:",e),e}}}const cd=Xu("audioConcatProcessor",'/*\n * ulaw decoding logic taken from the wavefile library\n * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js\n * USED BY @elevenlabs/client\n */\n\nconst decodeTable = [0,132,396,924,1980,4092,8316,16764];\n\nfunction decodeSample(muLawSample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let sample;\n  muLawSample = ~muLawSample;\n  sign = (muLawSample & 0x80);\n  exponent = (muLawSample >> 4) & 0x07;\n  mantissa = muLawSample & 0x0F;\n  sample = decodeTable[exponent] + (mantissa << (exponent+3));\n  if (sign !== 0) sample = -sample;\n\n  return sample;\n}\n\nclass AudioConcatProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.buffers = []; // Initialize an empty buffer\n    this.cursor = 0;\n    this.currentBuffer = null;\n    this.wasInterrupted = false;\n    this.finished = false;\n    \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.format = data.format;\n          break;\n        case "buffer":\n          this.wasInterrupted = false;\n          this.buffers.push(\n            this.format === "ulaw"\n              ? new Uint8Array(data.buffer)\n              : new Int16Array(data.buffer)\n          );\n          break;\n        case "interrupt":\n          this.wasInterrupted = true;\n          break;\n        case "clearInterrupted":\n          if (this.wasInterrupted) {\n            this.wasInterrupted = false;\n            this.buffers = [];\n            this.currentBuffer = null;\n          }\n      }\n    };\n  }\n  process(_, outputs) {\n    let finished = false;\n    const output = outputs[0][0];\n    for (let i = 0; i < output.length; i++) {\n      if (!this.currentBuffer) {\n        if (this.buffers.length === 0) {\n          finished = true;\n          break;\n        }\n        this.currentBuffer = this.buffers.shift();\n        this.cursor = 0;\n      }\n\n      let value = this.currentBuffer[this.cursor];\n      if (this.format === "ulaw") {\n        value = decodeSample(value);\n      }\n      output[i] = value / 32768;\n      this.cursor++;\n\n      if (this.cursor >= this.currentBuffer.length) {\n        this.currentBuffer = null;\n      }\n    }\n\n    if (this.finished !== finished) {\n      this.finished = finished;\n      this.port.postMessage({ type: "process", finished });\n    }\n\n    return true; // Continue processing\n  }\n}\n\nregisterProcessor("audioConcatProcessor", AudioConcatProcessor);\n');class ld{static async create(e){let{sampleRate:t,format:n,outputDeviceId:i,workletPaths:o}=e,r=null,a=null;try{r=new AudioContext({sampleRate:t});const e=r.createAnalyser(),s=r.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const c=r.createMediaStreamDestination();a.srcObject=c.stream,s.connect(e),e.connect(c),await cd(r.audioWorklet,null==o?void 0:o.audioConcatProcessor);const l=new AudioWorkletNode(r,"audioConcatProcessor");return l.port.postMessage({type:"setFormat",format:n}),l.connect(s),await r.resume(),i&&a.setSinkId&&await a.setSinkId(i),new ld(r,e,s,l,a)}catch(t){var s,c;throw null!=(s=a)&&s.parentNode&&a.parentNode.removeChild(a),null==(c=a)||c.pause(),r&&"closed"!==r.state&&await r.close(),t}}constructor(e,t,n,i,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=t,this.gain=n,this.worklet=i,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class ud extends Vu{static async startSession(e){var t;const n=Vu.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null,o=null,r=null,a=null,s=null;if(null==(t=e.useWakeLock)||t)try{s=await navigator.wakeLock.request("screen")}catch(e){}try{var c;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await od(n.connectionDelay),o=await nd(e),[i,r]=await Promise.all([sd.create(Bu({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),ld.create(Bu({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),null==(c=a)||c.getTracks().forEach(e=>{e.stop()}),a=null,new ud(n,o,i,r,s)}catch(e){var l,u,d,h;n.onStatusChange&&n.onStatusChange({status:"disconnected"}),null==(l=a)||l.getTracks().forEach(e=>{e.stop()}),null==(u=o)||u.close(),await(null==(d=i)?void 0:d.close()),await(null==(h=r)?void 0:h.close());try{var p;await(null==(p=s)?void 0:p.release()),s=null}catch(e){}throw e}}constructor(e,t,n,i,o){super(e,t),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=e=>{"connected"===this.status&&this.connection.sendMessage({user_audio_chunk:Qu(e.data[0].buffer)})},this.onOutputWorkletMessage=e=>{let{data:t}=e;"process"===t.type&&this.updateMode(t.finished?"listening":"speaking")},this.addAudioBase64Chunk=e=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:Yu(e)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=e=>{if(0===e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n]/255;return t/=e.length,t<0?0:t>1?1:t},this.setVolume=e=>{let{volume:t}=e;const n=Number.isFinite(t)?Math.min(1,Math.max(0,t)):1;this.volume=n,this.connection instanceof td?this.connection.setAudioVolume(n):this.output.gain.gain.value=n},this.input=n,this.output=i,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await(null==(e=this.wakeLock)?void 0:e.release()),this.wakeLock=null}catch(e){}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var t,n;this.lastInterruptTimestamp<=e.audio_event.event_id&&(null==(t=(n=this.options).onAudio)||t.call(n,e.audio_event.audio_base_64),this.connection instanceof td||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof td?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return null!=this.inputFrequencyData||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof td?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(null!=this.outputFrequencyData||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice(e){let{sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:o}=e;try{if(this.connection instanceof Ju)try{return await this.input.setInputDevice(o),this.input}catch(t){console.warn("Failed to change device on existing input, recreating:",t)}this.connection instanceof td&&await this.connection.setAudioInputDevice(o||""),await this.input.close();const e=await sd.create({sampleRate:null!=t?t:this.connection.inputFormat.sampleRate,format:null!=n?n:this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:o,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=e,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(t){throw console.error("Error changing input device",t),t}}async changeOutputDevice(e){let{sampleRate:t,format:n,outputDeviceId:i}=e;try{if(this.connection instanceof Ju)try{return await this.output.setOutputDevice(i),this.output}catch(t){console.warn("Failed to change device on existing output, recreating:",t)}this.connection instanceof td&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const e=await ld.create({sampleRate:null!=t?t:this.connection.outputFormat.sampleRate,format:null!=n?n:this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=e,this.output}catch(t){throw console.error("Error changing output device",t),t}}}class dd extends Vu{static startSession(e){return e.textOnly?rd.startSession(e):ud.startSession(e)}}function hd(){return hd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hd.apply(null,arguments)}const pd=["micMuted","volume","serverLocation"];function md(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{micMuted:n,volume:i,serverLocation:o}=e,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,pd),a=(0,t.useRef)(null),s=(0,t.useRef)(null),[c,l]=(0,t.useState)("disconnected"),[u,d]=(0,t.useState)(!1),[h,p]=(0,t.useState)("listening"),m=(0,t.useRef)(n),f=(0,t.useRef)(i);return m.current=n,f.current=i,(0,t.useEffect)(()=>{var e;void 0!==n&&(null==a||null==(e=a.current)||e.setMicMuted(n))},[n]),(0,t.useEffect)(()=>{var e;void 0!==i&&(null==a||null==(e=a.current)||e.setVolume({volume:i}))},[i]),(0,t.useEffect)(()=>()=>{var e;null==(e=a.current)||e.endSession()},[]),{startSession:async e=>{var t;if(null!=(t=a.current)&&t.isOpen())return a.current.getId();if(s.current)return(await s.current).getId();try{var n,i,c,u,h,g,v,y,b,_;const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"us";switch(e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn("[ConversationalAI] Invalid server-location: ".concat(e,'. Defaulting to "us"')),"us"}}((null==e?void 0:e.serverLocation)||o),k=function(e){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[e]}(t),w=function(e){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[e]}(t);return s.current=dd.startSession(hd({},null!=r?r:{},null!=e?e:{},{origin:k,livekitUrl:w,overrides:hd({},null!=(n=null==r?void 0:r.overrides)?n:{},null!=(i=null==e?void 0:e.overrides)?i:{},{client:hd({},null!=(c=null==r||null==(u=r.overrides)?void 0:u.client)?c:{},null!=(h=null==e||null==(g=e.overrides)?void 0:g.client)?h:{},{source:(null==e||null==(v=e.overrides)||null==(v=v.client)?void 0:v.source)||(null==r||null==(y=r.overrides)||null==(y=y.client)?void 0:y.source)||"react_sdk",version:(null==e||null==(b=e.overrides)||null==(b=b.client)?void 0:b.version)||(null==r||null==(_=r.overrides)||null==(_=_.client)?void 0:_.version)||"0.8.0"})}),onConnect:(null==e?void 0:e.onConnect)||(null==r?void 0:r.onConnect),onDisconnect:(null==e?void 0:e.onDisconnect)||(null==r?void 0:r.onDisconnect),onError:(null==e?void 0:e.onError)||(null==r?void 0:r.onError),onMessage:(null==e?void 0:e.onMessage)||(null==r?void 0:r.onMessage),onAudio:(null==e?void 0:e.onAudio)||(null==r?void 0:r.onAudio),onDebug:(null==e?void 0:e.onDebug)||(null==r?void 0:r.onDebug),onUnhandledClientToolCall:(null==e?void 0:e.onUnhandledClientToolCall)||(null==r?void 0:r.onUnhandledClientToolCall),onVadScore:(null==e?void 0:e.onVadScore)||(null==r?void 0:r.onVadScore),onInterruption:(null==e?void 0:e.onInterruption)||(null==r?void 0:r.onInterruption),onAgentToolResponse:(null==e?void 0:e.onAgentToolResponse)||(null==r?void 0:r.onAgentToolResponse),onConversationMetadata:(null==e?void 0:e.onConversationMetadata)||(null==r?void 0:r.onConversationMetadata),onMCPToolCall:(null==e?void 0:e.onMCPToolCall)||(null==r?void 0:r.onMCPToolCall),onMCPConnectionStatus:(null==e?void 0:e.onMCPConnectionStatus)||(null==r?void 0:r.onMCPConnectionStatus),onAsrInitiationMetadata:(null==e?void 0:e.onAsrInitiationMetadata)||(null==r?void 0:r.onAsrInitiationMetadata),onAgentChatResponsePart:(null==e?void 0:e.onAgentChatResponsePart)||(null==r?void 0:r.onAgentChatResponsePart),onModeChange:t=>{let{mode:n}=t;var i;p(n),null==(i=(null==e?void 0:e.onModeChange)||(null==r?void 0:r.onModeChange))||i({mode:n})},onStatusChange:t=>{let{status:n}=t;var i;l(n),null==(i=(null==e?void 0:e.onStatusChange)||(null==r?void 0:r.onStatusChange))||i({status:n})},onCanSendFeedbackChange:t=>{let{canSendFeedback:n}=t;var i;d(n),null==(i=(null==e?void 0:e.onCanSendFeedbackChange)||(null==r?void 0:r.onCanSendFeedbackChange))||i({canSendFeedback:n})}})),a.current=await s.current,void 0!==m.current&&a.current.setMicMuted(m.current),void 0!==f.current&&a.current.setVolume({volume:f.current}),a.current.getId()}finally{s.current=null}},endSession:async()=>{const e=a.current;a.current=null,await(null==e?void 0:e.endSession())},setVolume:e=>{let{volume:t}=e;var n;null==(n=a.current)||n.setVolume({volume:t})},getInputByteFrequencyData:()=>{var e;return null==(e=a.current)?void 0:e.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var e;return null==(e=a.current)?void 0:e.getOutputByteFrequencyData()},getInputVolume:()=>{var e,t;return null!=(e=null==(t=a.current)?void 0:t.getInputVolume())?e:0},getOutputVolume:()=>{var e,t;return null!=(e=null==(t=a.current)?void 0:t.getOutputVolume())?e:0},sendFeedback:e=>{var t;null==(t=a.current)||t.sendFeedback(e)},getId:()=>{var e;return null==(e=a.current)?void 0:e.getId()},sendContextualUpdate:e=>{var t;null==(t=a.current)||t.sendContextualUpdate(e)},sendUserMessage:e=>{var t;null==(t=a.current)||t.sendUserMessage(e)},sendUserActivity:()=>{var e;null==(e=a.current)||e.sendUserActivity()},sendMCPToolApprovalResult:(e,t)=>{var n;null==(n=a.current)||n.sendMCPToolApprovalResult(e,t)},changeInputDevice:async e=>{if(a.current&&"changeInputDevice"in a.current)return await a.current.changeInputDevice(e);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async e=>{if(a.current&&"changeOutputDevice"in a.current)return await a.current.changeOutputDevice(e);throw new Error("Device switching is only available for voice conversations")},status:c,canSendFeedback:u,micMuted:n,isSpeaking:"speaking"===h}}const fd=e=>{let{inline:n=!1,showHeader:i=!n}=e;const[o,r]=(0,t.useState)(""),[a,s]=(0,t.useState)(!1),c=md({onError:e=>r((null===e||void 0===e?void 0:e.message)||"Conversation error"),onStatusChange:()=>{},onModeChange:()=>{}}),l=(0,t.useCallback)(async()=>{if("connected"!==c.status&&!a){r(""),s(!0);try{await navigator.mediaDevices.getUserMedia({audio:!0}),await c.startSession({agentId:"agent_4501k7xa0jn2fgkrvnrtfwwst6hq",connectionType:"webrtc"})}catch(Ut){r((null===Ut||void 0===Ut?void 0:Ut.message)||"Unable to start")}finally{s(!1)}}},[c,a]),u=(0,t.useCallback)(async()=>{r("");try{await c.endSession()}catch(Bt){}},[c]),d="connected"===c.status,h=(0,Rt.jsxs)("div",{className:"voice-button-screen".concat(n?" inline":""),children:[i&&(0,Rt.jsx)("div",{className:"ai-title",children:"AI Voice"}),i&&(0,Rt.jsx)("div",{className:"ai-subtitle",children:"Hands\u2011free assistance"}),(0,Rt.jsxs)("button",{className:"ai-voice-btn ".concat(d||a?"listening":""),onClick:d?u:l,"aria-pressed":d,"aria-label":d?"Stop call":"Start call",disabled:a,children:[(0,Rt.jsx)("span",{className:"btn-emoji",children:"\ud83c\udfa7"}),(0,Rt.jsx)("span",{className:"btn-text",children:d?"Stop":a?"Connecting\u2026":"Start"})]}),o&&(0,Rt.jsx)("div",{className:"ai-alert error",role:"alert",children:o}),(0,Rt.jsx)("div",{className:"ai-hint",children:d?"Connected":"Disconnected"})]});return n?h:(0,Rt.jsx)("div",{className:"screen-container",children:h})},gd=(e,t,n,i)=>{const o=e*Math.PI/180,r=n*Math.PI/180,a=(n-e)*Math.PI/180,s=(i-t)*Math.PI/180,c=Math.sin(a/2)**2+Math.cos(o)*Math.cos(r)*Math.sin(s/2)**2;return 12742e3*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))},vd=()=>{const[e,n]=(0,t.useState)(new Date),[i,o]=(0,t.useState)(null),[r,a]=(0,t.useState)({state:"checking",text:"Checking location..."});(0,t.useEffect)(()=>{o(Ue())},[]),(0,t.useEffect)(()=>{const e=setInterval(()=>n(new Date),6e4);return()=>clearInterval(e)},[]),(0,t.useEffect)(()=>{if(null===i||void 0===i||!i.id)return;const e="caregiver"===i.role,t=()=>{try{if(e){const e=ze(i.id),t=null===e||void 0===e?void 0:e.patientId;if(!t)return void a({state:"info",text:"Pair with a patient to begin."});const n=Ke(t),o=Qe(t);if(!n)return void a({state:"info",text:"No safe zone set yet."});if(!o)return void a({state:"warning",text:"Waiting for patient location..."});const r=gd(o.latitude,o.longitude,n.latitude,n.longitude)>n.radius;a(r?{state:"outside",text:"Outside SafeCircle"}:{state:"inside",text:"Inside SafeCircle"})}else{const e=Ke(i.id),t=Qe(i.id);if(!e)return void a({state:"info",text:"No safe zone set yet."});if(!t)return void a({state:"warning",text:"Locating you..."});const n=gd(t.latitude,t.longitude,e.latitude,e.longitude)>e.radius;a(n?{state:"outside",text:"Outside SafeCircle"}:{state:"inside",text:"Inside SafeCircle"})}}catch(t){a({state:"checking",text:"Checking location..."})}};t();const n=setInterval(t,1500);return()=>clearInterval(n)},[null===i||void 0===i?void 0:i.id,null===i||void 0===i?void 0:i.role]);const s="caregiver"===(null===i||void 0===i?void 0:i.role),c="patient"===(null===i||void 0===i?void 0:i.role),l=(0,t.useMemo)(()=>(0,Rt.jsx)(At,{hideHeader:!0,hideBanner:!0,hideErrors:!0,embed:!0}),[null===i||void 0===i?void 0:i.role]);return(0,Rt.jsx)("div",{className:"screen-container",children:(0,Rt.jsxs)("div",{className:"home-screen",children:[(0,Rt.jsxs)("div",{className:"welcome-section",children:[(0,Rt.jsxs)("h1",{className:"greeting",children:[(()=>{const t=e.getHours();return t<12?"Good Morning":t<18?"Good Afternoon":"Good Evening"})(),"!"]}),(0,Rt.jsxs)("p",{className:"current-time",children:[e.toLocaleDateString()," - ",e.toLocaleTimeString()]})]}),(0,Rt.jsxs)("div",{children:[(0,Rt.jsx)("h2",{className:"zone-status-title",children:"Safety Zone Status"}),(0,Rt.jsx)("div",{className:"zone-pill ".concat(r.state),"aria-live":"polite",children:r.text})]}),s&&(0,Rt.jsxs)("div",{style:{marginTop:16},children:[(0,Rt.jsx)("h2",{className:"recent-title",children:"Recent Activities"}),l]}),c&&(0,Rt.jsx)("div",{style:{marginTop:16},children:(0,Rt.jsx)(fd,{})})]})})},yd=()=>{const[e,n]=(0,t.useState)([{id:1,name:"John Doe",phone:"+1 (555) 123-4567",email:"john.doe@email.com",relationship:"Emergency Contact",isEmergency:!0,avatar:null},{id:2,name:"Jane Smith",phone:"+1 (555) 987-6543",email:"jane.smith@email.com",relationship:"Family",isEmergency:!0,avatar:null},{id:3,name:"Dr. Wilson",phone:"+1 (555) 456-7890",email:"dr.wilson@hospital.com",relationship:"Doctor",isEmergency:!1,avatar:null}]),[i,o]=(0,t.useState)(!1),[r,a]=(0,t.useState)({name:"",phone:"",email:"",relationship:"",isEmergency:!1}),[s,c]=(0,t.useState)(null),l=t=>{const i=e.find(e=>e.id===t);n(e.filter(e=>e.id!==t)),c({type:"info",message:'Contact "'.concat(i.name,'" removed')})},u=e=>{window.location.href="tel:".concat(e)},d=e=>{window.location.href="sms:".concat(e)},h=e=>{window.location.href="mailto:".concat(e)},p=e.filter(e=>e.isEmergency),m=e.filter(e=>!e.isEmergency),f=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,Rt.jsx)("div",{className:"screen-container",children:(0,Rt.jsxs)("div",{className:"people-screen",children:[(0,Rt.jsxs)("div",{className:"people-header",children:[(0,Rt.jsx)("h1",{children:"Emergency Contacts"}),(0,Rt.jsx)("button",{className:"btn btn-primary",onClick:()=>o(!i),children:"Add Contact"})]}),s&&(0,Rt.jsxs)("div",{className:"alert alert-".concat(s.type),children:[s.message,(0,Rt.jsx)("button",{className:"alert-close",onClick:()=>c(null),children:"\xd7"})]}),i&&(0,Rt.jsxs)("div",{className:"card add-contact-form",children:[(0,Rt.jsx)("h3",{children:"Add New Contact"}),(0,Rt.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),r.name&&r.phone){const t=Ge(Ge({id:Date.now()},r),{},{avatar:null});n([...e,t]),a({name:"",phone:"",email:"",relationship:"",isEmergency:!1}),o(!1),c({type:"success",message:'Contact "'.concat(t.name,'" added successfully')})}},children:[(0,Rt.jsxs)("div",{className:"form-group",children:[(0,Rt.jsx)("label",{children:"Full Name *"}),(0,Rt.jsx)("input",{type:"text",value:r.name,onChange:e=>a(Ge(Ge({},r),{},{name:e.target.value})),placeholder:"Enter full name",required:!0})]}),(0,Rt.jsxs)("div",{className:"form-row",children:[(0,Rt.jsxs)("div",{className:"form-group",children:[(0,Rt.jsx)("label",{children:"Phone Number *"}),(0,Rt.jsx)("input",{type:"tel",value:r.phone,onChange:e=>a(Ge(Ge({},r),{},{phone:e.target.value})),placeholder:"+1 (555) 123-4567",required:!0})]}),(0,Rt.jsxs)("div",{className:"form-group",children:[(0,Rt.jsx)("label",{children:"Email"}),(0,Rt.jsx)("input",{type:"email",value:r.email,onChange:e=>a(Ge(Ge({},r),{},{email:e.target.value})),placeholder:"email@example.com"})]})]}),(0,Rt.jsxs)("div",{className:"form-group",children:[(0,Rt.jsx)("label",{children:"Relationship"}),(0,Rt.jsxs)("select",{value:r.relationship,onChange:e=>a(Ge(Ge({},r),{},{relationship:e.target.value})),children:[(0,Rt.jsx)("option",{value:"",children:"Select relationship"}),(0,Rt.jsx)("option",{value:"Family",children:"Family"}),(0,Rt.jsx)("option",{value:"Friend",children:"Friend"}),(0,Rt.jsx)("option",{value:"Doctor",children:"Doctor"}),(0,Rt.jsx)("option",{value:"Emergency Contact",children:"Emergency Contact"}),(0,Rt.jsx)("option",{value:"Caregiver",children:"Caregiver"}),(0,Rt.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,Rt.jsx)("div",{className:"form-group checkbox-group",children:(0,Rt.jsxs)("label",{className:"checkbox-label",children:[(0,Rt.jsx)("input",{type:"checkbox",checked:r.isEmergency,onChange:e=>a(Ge(Ge({},r),{},{isEmergency:e.target.checked}))}),(0,Rt.jsx)("span",{className:"checkmark"}),"Emergency Contact"]})}),(0,Rt.jsxs)("div",{className:"form-actions",children:[(0,Rt.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Add Contact"}),(0,Rt.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!1),children:"Cancel"})]})]})]}),p.length>0&&(0,Rt.jsxs)("div",{className:"contacts-section",children:[(0,Rt.jsx)("h2",{className:"section-title",children:"Emergency Contacts"}),(0,Rt.jsx)("div",{className:"contacts-grid",children:p.map(e=>(0,Rt.jsxs)("div",{className:"contact-card emergency-contact",children:[(0,Rt.jsxs)("div",{className:"contact-avatar",children:[e.avatar?(0,Rt.jsx)("img",{src:e.avatar,alt:e.name}):(0,Rt.jsx)("div",{className:"avatar-initials",children:f(e.name)}),(0,Rt.jsx)("div",{className:"emergency-badge",children:"\u26a1"})]}),(0,Rt.jsxs)("div",{className:"contact-info",children:[(0,Rt.jsx)("h3",{className:"contact-name",children:e.name}),(0,Rt.jsx)("p",{className:"contact-relationship",children:e.relationship}),(0,Rt.jsx)("p",{className:"contact-phone",children:e.phone}),e.email&&(0,Rt.jsx)("p",{className:"contact-email",children:e.email})]}),(0,Rt.jsxs)("div",{className:"contact-actions",children:[(0,Rt.jsx)("button",{className:"action-btn call-btn",onClick:()=>u(e.phone),title:"Call",children:"\ud83d\udcde"}),(0,Rt.jsx)("button",{className:"action-btn sms-btn",onClick:()=>d(e.phone),title:"SMS",children:"\ud83d\udcac"}),e.email&&(0,Rt.jsx)("button",{className:"action-btn email-btn",onClick:()=>h(e.email),title:"Email",children:"\ud83d\udce7"}),(0,Rt.jsx)("button",{className:"action-btn delete-btn",onClick:()=>l(e.id),title:"Delete",children:"\ud83d\uddd1\ufe0f"})]})]},e.id))})]}),m.length>0&&(0,Rt.jsxs)("div",{className:"contacts-section",children:[(0,Rt.jsx)("h2",{className:"section-title",children:"Other Contacts"}),(0,Rt.jsx)("div",{className:"contacts-grid",children:m.map(e=>(0,Rt.jsxs)("div",{className:"contact-card",children:[(0,Rt.jsx)("div",{className:"contact-avatar",children:e.avatar?(0,Rt.jsx)("img",{src:e.avatar,alt:e.name}):(0,Rt.jsx)("div",{className:"avatar-initials",children:f(e.name)})}),(0,Rt.jsxs)("div",{className:"contact-info",children:[(0,Rt.jsx)("h3",{className:"contact-name",children:e.name}),(0,Rt.jsx)("p",{className:"contact-relationship",children:e.relationship}),(0,Rt.jsx)("p",{className:"contact-phone",children:e.phone}),e.email&&(0,Rt.jsx)("p",{className:"contact-email",children:e.email})]}),(0,Rt.jsxs)("div",{className:"contact-actions",children:[(0,Rt.jsx)("button",{className:"action-btn call-btn",onClick:()=>u(e.phone),title:"Call",children:"\ud83d\udcde"}),(0,Rt.jsx)("button",{className:"action-btn sms-btn",onClick:()=>d(e.phone),title:"SMS",children:"\ud83d\udcac"}),e.email&&(0,Rt.jsx)("button",{className:"action-btn email-btn",onClick:()=>h(e.email),title:"Email",children:"\ud83d\udce7"}),(0,Rt.jsx)("button",{className:"action-btn delete-btn",onClick:()=>l(e.id),title:"Delete",children:"\ud83d\uddd1\ufe0f"})]})]},e.id))})]}),0===e.length&&(0,Rt.jsxs)("div",{className:"empty-state",children:[(0,Rt.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,Rt.jsx)("h3",{children:"No contacts yet"}),(0,Rt.jsx)("p",{children:"Add emergency contacts to get started with SafeCircle"}),(0,Rt.jsx)("button",{className:"btn btn-primary",onClick:()=>o(!0),children:"Add Your First Contact"})]})]})})};function bd(){var e,n;const i=$(),[o,r]=(0,t.useState)(()=>Ue()),[a,s]=(0,t.useState)(""),[c,l]=(0,t.useState)(""),[u,d]=(0,t.useState)(""),[h,p]=(0,t.useState)(null),[m,f]=(0,t.useState)([]),g="caregiver"===(null===o||void 0===o?void 0:o.role),v="patient"===(null===o||void 0===o?void 0:o.role),y=()=>{p(ze(null===o||void 0===o?void 0:o.id)),g&&f(function(e){const t=je(),n=t.pairs.filter(t=>t.caregiverId===e).map(e=>e.patientId);return t.users.filter(e=>n.includes(e.id))}(o.id))};(0,t.useEffect)(()=>{y()},[]);const b=e=>{l(""),d("");try{if(g){var t,n;const i=null!==(t=null!==e&&void 0!==e?e:null===h||void 0===h?void 0:h.patientId)&&void 0!==t?t:null===(n=m[0])||void 0===n?void 0:n.id;if(!i)throw new Error("No patient to unpair.");Ve(o.id,i)}else if(v){if(null===h||void 0===h||!h.caregiverId)throw new Error("No caregiver to unpair.");Ve(h.caregiverId,o.id)}d("Unpaired successfully."),y()}catch(i){l((null===i||void 0===i?void 0:i.message)||"Unable to unpair.")}};return(0,Rt.jsxs)("div",{className:"screen-container",style:{maxWidth:640,margin:"0 auto"},children:[(0,Rt.jsx)("div",{className:"map-header",style:{alignItems:"center"},children:(0,Rt.jsxs)("h1",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,Rt.jsx)("img",{src:"".concat("","/icons/people.png"),alt:"",width:24,height:24,"aria-hidden":"true"}),"Pair Patient"]})}),c&&(0,Rt.jsx)("div",{className:"alert alert-error",children:c}),u&&(0,Rt.jsx)("div",{className:"alert alert-success",children:u}),g&&(0,Rt.jsxs)("div",{className:"card",style:{marginBottom:16},children:[(0,Rt.jsx)("h3",{children:"Invite or pair by email"}),(0,Rt.jsx)("p",{style:{marginTop:4,opacity:.85},children:"Your patient should sign up with this email."}),(0,Rt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(""),d("");try{if(!g)throw new Error("Only caregivers can pair.");const e=function(e){return je().users.find(t=>t.email.toLowerCase()===String(e).toLowerCase())||null}(a);if(!e)throw new Error("No user found with that email.");!function(e,t){const n=je();n.pairs.some(n=>n.caregiverId===e&&n.patientId===t)||(n.pairs.push({id:Date.now().toString(),caregiverId:e,patientId:t}),Ae(n))}(o.id,e.id),d("Paired with ".concat(e.name||e.email,".")),s(""),y()}catch(t){l((null===t||void 0===t?void 0:t.message)||"Unable to pair.")}},className:"row",style:{gap:8,marginTop:10},children:[(0,Rt.jsx)("input",{type:"email",placeholder:"patient@email.com",value:a,onChange:e=>s(e.target.value),required:!0,style:{flex:1}}),(0,Rt.jsx)("button",{className:"btn btn-primary",children:"Pair"})]})]}),(0,Rt.jsxs)("div",{className:"card",children:[(0,Rt.jsx)("h3",{children:"Current pairing"}),g&&(0===m.length?(0,Rt.jsx)("p",{children:"No patients paired yet."}):(0,Rt.jsx)("ul",{className:"list",children:m.map(e=>(0,Rt.jsxs)("li",{className:"row",style:{alignItems:"center",gap:10},children:[(0,Rt.jsx)("img",{src:"".concat("","/icons/people.png"),alt:"",width:18,height:18,"aria-hidden":"true"}),(0,Rt.jsx)("strong",{style:{flex:1},children:e.name||e.email}),(0,Rt.jsx)("button",{className:"btn btn-ghost btn-small",onClick:()=>b(e.id),children:"Unpair"})]},e.id))})),v&&(h?(0,Rt.jsxs)("div",{className:"row",style:{alignItems:"center",gap:10},children:[(0,Rt.jsx)("img",{src:"".concat("","/icons/people.png"),alt:"",width:18,height:18,"aria-hidden":"true"}),"Caregiver: ",(0,Rt.jsx)("strong",{children:(null===(e=Be(o.id))||void 0===e?void 0:e.name)||(null===(n=Be(o.id))||void 0===n?void 0:n.email)}),(0,Rt.jsx)("button",{className:"btn btn-ghost btn-small",onClick:()=>b(),children:"Unpair"})]}):(0,Rt.jsx)("p",{children:"You are not paired. Ask your caregiver to pair with your email."}))]}),(0,Rt.jsx)("div",{style:{marginTop:8},children:(0,Rt.jsx)("button",{className:"btn btn-ghost",onClick:()=>i("/map"),children:"Back to Map"})})]})}const _d=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},kd=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var wd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Sd=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],Td=(0,t.forwardRef)((e,n)=>{let{color:i="currentColor",size:o=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:s="",children:c,iconNode:l}=e,u=nt(e,Sd);return(0,t.createElement)("svg",Ge(Ge(Ge({ref:n},wd),{},{width:o,height:o,stroke:i,strokeWidth:a?24*Number(r)/Number(o):r,className:kd("lucide",s)},!c&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"}),u),[...l.map(e=>{let[n,i]=e;return(0,t.createElement)(n,i)}),...Array.isArray(c)?c:[c]])}),Cd=["className"],Ed=(e,n)=>{const i=(0,t.forwardRef)((i,o)=>{let{className:r}=i,a=nt(i,Cd);return(0,t.createElement)(Td,Ge({ref:o,iconNode:n,className:kd("lucide-".concat((s=_d(e),s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),r)},a));var s});return i.displayName=_d(e),i},xd=Ed("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),Pd=Ed("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Rd=Ed("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Id=Ed("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function Md(){const e=Q(),t=[{to:"/home",icon:xd,label:"Home"},{to:"/people",icon:Pd,label:"People"},{to:"/map",icon:Rd,label:"Map"},{to:"/settings",icon:Id,label:"Settings"}];return(0,Rt.jsx)("nav",{className:"bottom-nav",style:{position:"fixed",bottom:0,left:0,right:0,display:"flex",justifyContent:"space-around",alignItems:"center",background:"#fff",padding:"12px 16px",borderTop:"1px solid #e5e7eb",zIndex:1e3},role:"navigation","aria-label":"Bottom",children:t.map(t=>{let{to:n,icon:i,label:o}=t;const r=e.pathname===n||"/home"===n&&"/"===e.pathname;return(0,Rt.jsx)(Re,{to:n,"aria-label":o,title:o,style:{textDecoration:"none"},children:(0,Rt.jsx)(i,{size:24,color:r?"#a855f7":"#111827"})},n)})})}function Od(){const e=e=>()=>alert("".concat(e," clicked")),t=e=>{let{children:t}=e;return(0,Rt.jsx)("div",{style:{background:"#fff",color:"#111",borderRadius:12,boxShadow:"0 1px 2px rgba(0,0,0,0.06)",border:"1px solid #eee"},children:t})},n=e=>{let{children:t}=e;return(0,Rt.jsx)("div",{style:{padding:"12px 16px",color:"#9ca3af",fontWeight:600,borderTop:"1px solid #f3f4f6"},children:t})},i=e=>{let{label:t,onClick:n}=e;return(0,Rt.jsxs)("button",{onClick:n,style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",background:"transparent",border:"none",borderTop:"1px solid #f3f4f6",color:"#111",fontSize:16,textAlign:"left"},children:[(0,Rt.jsx)("span",{children:t}),(0,Rt.jsx)("span",{style:{color:"#9ca3af"},children:">"})]})};return(0,Rt.jsxs)("div",{className:"screen-container",style:{paddingBottom:72},children:[(0,Rt.jsxs)("div",{style:{maxWidth:420,margin:"0 auto",padding:16},children:[(0,Rt.jsx)("h1",{style:{color:"#111",fontSize:22,fontWeight:700,marginBottom:12},children:"Settings"}),(0,Rt.jsxs)(t,{children:[(0,Rt.jsx)("div",{style:{padding:"20px 16px",fontSize:22,fontWeight:700},children:"Example Doe"}),(0,Rt.jsx)(n,{children:"Account Settings"}),(0,Rt.jsx)(i,{label:"Edit profile",onClick:e("Edit Profile")}),(0,Rt.jsx)(n,{children:"General Settings"}),(0,Rt.jsx)(i,{label:"Speech Speed",onClick:e("Speech Speed")}),(0,Rt.jsx)(i,{label:"SOS Alerts",onClick:e("SOS Alerts")}),(0,Rt.jsx)(i,{label:"Reminders",onClick:e("Reminders")}),(0,Rt.jsx)(i,{label:"Font Size",onClick:e("Font Size")}),(0,Rt.jsx)(n,{children:"About us"})]})]}),(0,Rt.jsx)(Md,{})]})}function Ld(){const e=e=>()=>alert("".concat(e," clicked")),t=e=>{let{children:t}=e;return(0,Rt.jsx)("div",{style:{background:"#fff",color:"#111",borderRadius:12,boxShadow:"0 1px 2px rgba(0,0,0,0.06)",border:"1px solid #eee"},children:t})},n=e=>{let{children:t}=e;return(0,Rt.jsx)("div",{style:{padding:"12px 16px",color:"#9ca3af",fontWeight:600,borderTop:"1px solid #f3f4f6"},children:t})},i=e=>{let{label:t,onClick:n}=e;return(0,Rt.jsxs)("button",{onClick:n,style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",background:"transparent",border:"none",borderTop:"1px solid #f3f4f6",color:"#111",fontSize:16,textAlign:"left"},children:[(0,Rt.jsx)("span",{children:t}),(0,Rt.jsx)("span",{style:{color:"#9ca3af"},children:">"})]})};return(0,Rt.jsxs)("div",{className:"screen-container",style:{paddingBottom:72},children:[(0,Rt.jsxs)("div",{style:{maxWidth:420,margin:"0 auto",padding:16},children:[(0,Rt.jsx)("h1",{style:{color:"#111",fontSize:22,fontWeight:700,marginBottom:12},children:"Settings"}),(0,Rt.jsxs)(t,{children:[(0,Rt.jsx)("div",{style:{padding:"20px 16px",fontSize:22,fontWeight:700},children:"Example Doe"}),(0,Rt.jsx)(n,{children:"Account Settings"}),(0,Rt.jsx)(i,{label:"Edit profile",onClick:e("Edit Profile")}),(0,Rt.jsx)(n,{children:"General Settings"}),(0,Rt.jsx)(i,{label:"Speech Speed",onClick:e("Speech Speed")}),(0,Rt.jsx)(i,{label:"Font Size",onClick:e("Font Size")}),(0,Rt.jsx)(i,{label:"Low Sensory Mode",onClick:e("Low Sensory Mode")}),(0,Rt.jsx)(n,{children:"About us"})]})]}),(0,Rt.jsx)(Md,{})]})}function Nd(){const e=$(),[n,i]=(0,t.useState)(""),[o,r]=(0,t.useState)(""),[a,s]=(0,t.useState)(""),[c,l]=(0,t.useState)("patient"),[u,d]=(0,t.useState)("");return(0,Rt.jsx)("div",{className:"screen-container",style:{display:"grid",placeItems:"center"},children:(0,Rt.jsxs)("form",{onSubmit:t=>{t.preventDefault(),d("");try{!function(e){let{name:t,email:n,password:i,role:o}=e;const r=je();if(r.users.some(e=>e.email===n))throw new Error("Email already exists");const a={id:Date.now().toString(),name:t,email:n,password:i,role:o};r.users.push(a),Ae(r),localStorage.setItem(De,a.id)}({name:n,email:o,password:a,role:c}),e("/")}catch(t){d((null===t||void 0===t?void 0:t.message)||"Unable to sign up")}},className:"card form",style:{maxWidth:420,width:"100%"},children:[(0,Rt.jsx)("h2",{children:"Create Account"}),u&&(0,Rt.jsx)("div",{className:"alert alert-error",children:u}),(0,Rt.jsx)("input",{required:!0,placeholder:"Name",value:n,onChange:e=>i(e.target.value)}),(0,Rt.jsx)("input",{required:!0,type:"email",placeholder:"Email",value:o,onChange:e=>r(e.target.value)}),(0,Rt.jsx)("input",{required:!0,type:"password",placeholder:"Password",value:a,onChange:e=>s(e.target.value)}),(0,Rt.jsxs)("div",{className:"row",style:{gap:16,marginTop:8},children:[(0,Rt.jsxs)("label",{children:[(0,Rt.jsx)("input",{type:"radio",checked:"caregiver"===c,onChange:()=>l("caregiver")})," ","Caregiver"]}),(0,Rt.jsxs)("label",{children:[(0,Rt.jsx)("input",{type:"radio",checked:"patient"===c,onChange:()=>l("patient")})," ","Patient"]})]}),(0,Rt.jsx)("button",{className:"btn btn-primary",style:{marginTop:12},children:"Sign up"}),(0,Rt.jsxs)("div",{style:{marginTop:12,textAlign:"center"},children:["Already have an account?"," ",(0,Rt.jsx)(Re,{to:"/auth/login",className:"link",children:"Log in"})]})]})})}function Dd(){const e=$(),[n,i]=(0,t.useState)(""),[o,r]=(0,t.useState)(""),[a,s]=(0,t.useState)("");return(0,Rt.jsx)("div",{className:"screen-container",style:{display:"grid",placeItems:"center"},children:(0,Rt.jsxs)("form",{onSubmit:t=>{t.preventDefault(),s("");try{!function(e){let{email:t,password:n}=e;const i=je().users.find(e=>e.email===t&&e.password===n);if(!i)throw new Error("Invalid credentials");localStorage.setItem(De,i.id)}({email:n,password:o}),e("/")}catch(t){s((null===t||void 0===t?void 0:t.message)||"Invalid credentials")}},className:"card form",style:{maxWidth:420,width:"100%"},children:[(0,Rt.jsx)("h2",{children:"Log in"}),a&&(0,Rt.jsx)("div",{className:"alert alert-error",children:a}),(0,Rt.jsx)("input",{required:!0,type:"email",placeholder:"Email",value:n,onChange:e=>i(e.target.value)}),(0,Rt.jsx)("input",{required:!0,type:"password",placeholder:"Password",value:o,onChange:e=>r(e.target.value)}),(0,Rt.jsx)("button",{className:"btn btn-primary",style:{marginTop:12},children:"Log in"}),(0,Rt.jsxs)("div",{style:{marginTop:12,textAlign:"center"},children:["New here?"," ",(0,Rt.jsx)(Re,{to:"/auth/signup",className:"link",children:"Create an account"})]})]})})}function Ad(){const e=$();return(0,t.useEffect)(()=>{Fe(),e("/auth/login",{replace:!0})},[e]),null}const jd=[{path:"/home",label:"Home",icon:"icons/home.png"},{path:"/map",label:"Map",icon:"icons/map.png"},{path:"/people",label:"People",icon:"icons/people.png"},{path:"/pair",label:"Pair",icon:"icons/people.png"},{path:"/voice",label:"Voice",icon:"icons/mic.png"}];function Ud(){const[e,n]=(0,t.useState)(!1),i=Q(),o=$(),r=()=>n(!1);(0,t.useEffect)(()=>{r()},[i.pathname]),(0,t.useEffect)(()=>{const e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,t.useEffect)(()=>(e?document.body.classList.add("sidebar-open"):document.body.classList.remove("sidebar-open"),()=>document.body.classList.remove("sidebar-open")),[e]);const a=e=>{const t="".concat("","/icons/people.png");null!==e&&void 0!==e&&e.target&&e.target.src!==t&&(e.target.src=t)};return(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)("button",{className:"menu-toggle ".concat(e?"open":""),onClick:()=>n(e=>!e),"aria-label":"Toggle navigation menu","aria-expanded":e,"aria-controls":"app-sidebar",children:(0,Rt.jsx)("span",{})}),(0,Rt.jsx)("div",{className:"overlay ".concat(e?"show":""),onClick:r,"aria-hidden":!e}),(0,Rt.jsxs)("aside",{id:"app-sidebar",className:"sidebar ".concat(e?"open":""),role:"navigation","aria-label":"Main",children:[(0,Rt.jsxs)("div",{className:"sidebar-header",children:[(0,Rt.jsx)("img",{src:"".concat("","/logo.png"),alt:"SafeCircle logo",className:"sidebar-logo",onError:e=>{const t="".concat("","/icons/people.png");null!==e&&void 0!==e&&e.target&&e.target.src!==t&&(e.target.src=t)}}),(0,Rt.jsx)("h2",{className:"sidebar-title",children:"SafeCircle"}),(0,Rt.jsx)("p",{className:"sidebar-subtitle",children:"Stay Safe, Stay Connected"})]}),(0,Rt.jsx)("nav",{className:"sidebar-nav",children:jd.map(e=>(0,Rt.jsxs)(Ie,{to:e.path,className:e=>{let{isActive:t}=e;return"nav-item ".concat(t?"active":"")},onClick:r,end:"/home"===e.path||"/"===e.path,children:[(0,Rt.jsx)("img",{src:"".concat("","/").concat(e.icon),alt:"",className:"nav-icon","aria-hidden":"true",onError:a}),(0,Rt.jsx)("span",{className:"nav-label",children:e.label})]},e.path))}),(0,Rt.jsx)("div",{className:"sidebar-footer",children:(0,Rt.jsx)("button",{className:"btn btn-danger logout-btn",onClick:()=>{Fe(),o("/auth/login",{replace:!0})},"aria-label":"Sign out",children:"Sign out"})})]})]})}function Fd(e){let{children:t}=e;return Ue()?t:(0,Rt.jsx)(pe,{to:"/auth/signup",replace:!0})}function Bd(e){let{children:t}=e;return Ue()?(0,Rt.jsx)(pe,{to:"/",replace:!0}):t}function zd(e){let{children:t}=e;const{pathname:n}=Q(),i=n.startsWith("/auth/");return(0,Rt.jsxs)("div",{className:"app",children:[!i&&(0,Rt.jsx)(Ud,{}),(0,Rt.jsx)("main",{className:"main-content",children:t})]})}function Vd(){const e=Ue(),t=null===e||void 0===e?void 0:e.role;return t?"caregiver"===t?(0,Rt.jsx)(Ld,{}):(0,Rt.jsx)(Od,{}):(0,Rt.jsx)(pe,{to:"/auth/login",replace:!0})}function qd(){return(0,Rt.jsx)(Ee,{children:(0,Rt.jsx)(zd,{children:(0,Rt.jsxs)(ge,{children:[(0,Rt.jsx)(me,{path:"/auth/signup",element:(0,Rt.jsx)(Bd,{children:(0,Rt.jsx)(Nd,{})})}),(0,Rt.jsx)(me,{path:"/auth/login",element:(0,Rt.jsx)(Bd,{children:(0,Rt.jsx)(Dd,{})})}),(0,Rt.jsx)(me,{path:"/",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(vd,{})})}),(0,Rt.jsx)(me,{path:"/home",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(vd,{})})}),(0,Rt.jsx)(me,{path:"/map",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(At,{})})}),(0,Rt.jsx)(me,{path:"/pair",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(bd,{})})}),(0,Rt.jsx)(me,{path:"/people",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(yd,{})})}),(0,Rt.jsx)(me,{path:"/voice",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(fd,{})})}),(0,Rt.jsx)(me,{path:"/settings",element:(0,Rt.jsx)(Fd,{children:(0,Rt.jsx)(Vd,{})})}),(0,Rt.jsx)(me,{path:"/auth/logout",element:(0,Rt.jsx)(Ad,{})}),(0,Rt.jsx)(me,{path:"*",element:Ue()?(0,Rt.jsx)(pe,{to:"/",replace:!0}):(0,Rt.jsx)(pe,{to:"/auth/signup",replace:!0})})]})})})}const Wd=e=>{e&&e instanceof Function&&n.e(488).then(n.bind(n,488)).then(t=>{let{getCLS:n,getFID:i,getFCP:o,getLCP:r,getTTFB:a}=t;n(e),i(e),o(e),r(e),a(e)})},Hd=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Zd(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const n=e.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}o.createRoot(document.getElementById("root")).render((0,Rt.jsx)(t.StrictMode,{children:(0,Rt.jsx)(qd,{})})),Wd(),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="".concat("","/service-worker.js");Hd?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(n=>{const i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Zd(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})):Zd(t,e)})}}()})()})();
//# sourceMappingURL=main.629d4b5b.js.map